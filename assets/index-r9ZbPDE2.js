(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();let ge,Cs=[],Ss,dr,Pi={},en={},Tn={},yc,Dt=[],Xs=!1,sn="sender",Ys=null,Vt=null,Di="camera1",ir={camera1:null,camera2:null},sr={camera1:[],camera2:[]},Js={camera1:!1,camera2:!1};function Zs(n){ge=n}function _c(n){Cs=n}function eo(n){Ss=n}function to(n){dr=n}function td(n){Pi=n}function vc(n){en=n}function Ec(n){Tn=n}function nd(n){yc=n}function Tc(n){Dt=n}function wc(n){Xs=n}function rd(n){sn=n}function si(n){Ys=n}function oi(n){Vt=n}function id(n){Di=n}function Ic(n,e){ir[n]=e}function bc(n,e){sr[n]=e}function ai(n,e){Js[n]=e}const sd=document.querySelectorAll('input[name="role"]'),od=document.getElementById("senderControls"),ad=document.getElementById("receiverControls"),no=document.getElementById("callControls"),Ac=document.getElementById("statsControls"),li=document.getElementById("ptzControls"),gn=document.getElementById("cameraSelect1"),Yt=document.getElementById("cameraSelect2"),ld=document.getElementById("resolution"),cd=document.getElementById("framerate"),ud=document.getElementById("codecSelect"),fr=document.getElementById("startCamera"),ci=document.getElementById("joinCall"),hd=document.getElementById("hangUpBtn"),Cc=document.getElementById("callIdInput"),Vi=document.getElementById("callIdDisplay"),Jr=document.getElementById("copyCallId"),ui=document.getElementById("localVideo1"),hi=document.getElementById("localVideo2"),ro=document.getElementById("remoteVideo1"),io=document.getElementById("remoteVideo2"),di=document.getElementById("remoteVideoContainer1"),fi=document.getElementById("remoteVideoContainer2"),so=document.getElementById("resolutionDisplay1"),oo=document.getElementById("resolutionDisplay2"),za=document.getElementById("fullscreenBtn1"),ja=document.getElementById("fullscreenBtn2"),Bi=document.getElementById("startStatsRecording"),Ni=document.getElementById("stopStatsRecording"),Li=document.getElementById("downloadStats"),mi=document.getElementById("statsDisplay"),dd=document.getElementById("zoomInBtn"),fd=document.getElementById("zoomOutBtn"),md=document.getElementById("zoomSlider");document.getElementById("zoomValue");const pd=document.getElementById("tiltUpBtn"),gd=document.getElementById("tiltDownBtn"),yd=document.getElementById("tiltSlider");document.getElementById("tiltValue");const _d=document.getElementById("panLeftBtn"),vd=document.getElementById("panRightBtn"),Ed=document.getElementById("panSlider");document.getElementById("panValue");const Td=document.getElementById("ptzResetBtn"),wd=document.querySelectorAll('input[name="ptzTarget"]'),ao=document.getElementById("startRecording1"),lo=document.getElementById("stopRecording1"),co=document.getElementById("downloadVideo1"),Sc=document.getElementById("recordingStatus1"),uo=document.getElementById("startRecording2"),ho=document.getElementById("stopRecording2"),fo=document.getElementById("downloadVideo2"),kc=document.getElementById("recordingStatus2");function mr(){ui.srcObject=null,hi.srcObject=null,ro.srcObject=null,io.srcObject=null,ui.style.display="none",hi.style.display="none",di.style.display="none",fi.style.display="none",so.style.display="none",oo.style.display="none",li.style.display="none",no.style.display="none",Ac.style.display="none",Vi.textContent="",Cc.value="",Jr.textContent="コピー",fr.disabled=!1,ci.disabled=!1,mi.textContent="",Tc([]),si(null),Bi.disabled=!1,Ni.disabled=!0,Li.disabled=!0,["camera1","camera2"].forEach(n=>{ir[n]&&ir[n].state!=="inactive"&&ir[n].stop(),Ic(n,null),bc(n,[]),ai(n,!1)}),ao.disabled=!1,lo.disabled=!0,co.disabled=!0,Sc.textContent="",uo.disabled=!1,ho.disabled=!0,fo.disabled=!0,kc.textContent="",dr&&(dr.close(),to(null)),Vt&&(clearInterval(Vt),oi(null))}function Rc(n){rd(n),od.style.display=n==="sender"?"block":"none",ad.style.display=n==="receiver"?"block":"none",mr()}async function Id(){try{const e=(await navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="videoinput");if(gn.innerHTML="",Yt.innerHTML="",e.length===0){const t="<option>カメラが見つかりません</option>";gn.innerHTML=t,Yt.innerHTML=t,gn.disabled=!0,Yt.disabled=!0,fr.disabled=!0;return}e.forEach((t,r)=>{const i=document.createElement("option");i.value=t.deviceId,i.text=t.label||`カメラ ${r+1}`,gn.appendChild(i);const o=document.createElement("option");o.value=t.deviceId,o.text=t.label||`カメラ ${r+1}`,Yt.appendChild(o)}),e.length>1&&(Yt.selectedIndex=1),gn.disabled=!1,Yt.disabled=!1,fr.disabled=!1}catch(n){console.error("Error enumerating devices:",n),alert("カメラデバイスの取得に失敗しました。")}}const bd=()=>{};var $a={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xc=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Ad=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){const o=n[t++],a=n[t++],l=n[t++],d=((i&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Pc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const o=n[i],a=i+1<n.length,l=a?n[i+1]:0,d=i+2<n.length,m=d?n[i+2]:0,y=o>>2,A=(o&3)<<4|l>>4;let k=(l&15)<<2|m>>6,S=m&63;d||(S=64,a||(k=64)),r.push(t[y],t[A],t[k],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(xc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ad(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const o=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const m=i<n.length?t[n.charAt(i)]:64;++i;const A=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||l==null||m==null||A==null)throw new Cd;const k=o<<2|l>>4;if(r.push(k),m!==64){const S=l<<4&240|m>>2;if(r.push(S),A!==64){const P=m<<6&192|A;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Cd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Sd=function(n){const e=xc(n);return Pc.encodeByteArray(e,!0)},pi=function(n){return Sd(n).replace(/\./g,"")},kd=function(n){try{return Pc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xd=()=>Rd().__FIREBASE_DEFAULTS__,Pd=()=>{if(typeof process>"u"||typeof $a>"u")return;const n=$a.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Dd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&kd(n[1]);return e&&JSON.parse(e)},mo=()=>{try{return bd()||xd()||Pd()||Dd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Vd=n=>{var e,t;return(t=(e=mo())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Bd=n=>{const e=Vd(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Dc=()=>{var n;return(n=mo())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(n){return n.endsWith(".cloudworkstations.dev")}async function Ld(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Md(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[pi(JSON.stringify(t)),pi(JSON.stringify(a)),""].join(".")}const or={};function Od(){const n={prod:[],emulator:[]};for(const e of Object.keys(or))or[e]?n.emulator.push(e):n.prod.push(e);return n}function Fd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let qa=!1;function Ud(n,e){if(typeof window>"u"||typeof document>"u"||!po(window.location.host)||or[n]===e||or[n]||qa)return;or[n]=e;function t(k){return`__firebase__banner__${k}`}const r="__firebase__banner",o=Od().prod.length>0;function a(){const k=document.getElementById(r);k&&k.remove()}function l(k){k.style.display="flex",k.style.background="#7faaf0",k.style.position="fixed",k.style.bottom="5px",k.style.left="5px",k.style.padding=".5em",k.style.borderRadius="5px",k.style.alignItems="center"}function d(k,S){k.setAttribute("width","24"),k.setAttribute("id",S),k.setAttribute("height","24"),k.setAttribute("viewBox","0 0 24 24"),k.setAttribute("fill","none"),k.style.marginLeft="-6px"}function m(){const k=document.createElement("span");return k.style.cursor="pointer",k.style.marginLeft="16px",k.style.fontSize="24px",k.innerHTML=" &times;",k.onclick=()=>{qa=!0,a()},k}function y(k,S){k.setAttribute("id",S),k.innerText="Learn more",k.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",k.setAttribute("target","__blank"),k.style.paddingLeft="5px",k.style.textDecoration="underline"}function A(){const k=Fd(r),S=t("text"),P=document.getElementById(S)||document.createElement("span"),B=t("learnmore"),O=document.getElementById(B)||document.createElement("a"),q=t("preprendIcon"),$=document.getElementById(q)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(k.created){const G=k.element;l(G),y(O,B);const M=m();d($,q),G.append($,P,O,M),document.body.appendChild(G)}o?(P.innerText="Preview backend disconnected.",$.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):($.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",A):A()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function jd(){var n;const e=(n=mo())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function $d(){return!jd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function qd(){try{return typeof indexedDB=="object"}catch{return!1}}function Hd(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd="FirebaseError";class Bn extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Gd,Object.setPrototypeOf(this,Bn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Vc.prototype.create)}}class Vc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?Wd(o,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Bn(i,l,r)}}function Wd(n,e){return n.replace(Kd,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Kd=/\{\$([^}]+)}/g;function gi(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const o=n[i],a=e[i];if(Ha(o)&&Ha(a)){if(!gi(o,a))return!1}else if(o!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function Ha(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bn(n){return n&&n._delegate?n._delegate:n}class pr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Nd;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Yd(e))try{this.getOrInitializeService({instanceIdentifier:Jt})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Jt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Jt){return this.instances.has(e)}getOptions(e=Jt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);const a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Xd(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Jt){return this.component?this.component.multipleInstances?e:Jt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Xd(n){return n===Jt?void 0:n}function Yd(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Qd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ce;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ce||(ce={}));const Zd={debug:ce.DEBUG,verbose:ce.VERBOSE,info:ce.INFO,warn:ce.WARN,error:ce.ERROR,silent:ce.SILENT},ef=ce.INFO,tf={[ce.DEBUG]:"log",[ce.VERBOSE]:"log",[ce.INFO]:"info",[ce.WARN]:"warn",[ce.ERROR]:"error"},nf=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=tf[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Bc{constructor(e){this.name=e,this._logLevel=ef,this._logHandler=nf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ce))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Zd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ce.DEBUG,...e),this._logHandler(this,ce.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ce.VERBOSE,...e),this._logHandler(this,ce.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ce.INFO,...e),this._logHandler(this,ce.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ce.WARN,...e),this._logHandler(this,ce.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ce.ERROR,...e),this._logHandler(this,ce.ERROR,...e)}}const rf=(n,e)=>e.some(t=>n instanceof t);let Ga,Wa;function sf(){return Ga||(Ga=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function of(){return Wa||(Wa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Nc=new WeakMap,ks=new WeakMap,Lc=new WeakMap,ds=new WeakMap,go=new WeakMap;function af(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Bt(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Nc.set(t,n)}).catch(()=>{}),go.set(e,n),e}function lf(n){if(ks.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});ks.set(n,e)}let Rs={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ks.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Lc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Bt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function cf(n){Rs=n(Rs)}function uf(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(fs(this),e,...t);return Lc.set(r,e.sort?e.sort():[e]),Bt(r)}:of().includes(n)?function(...e){return n.apply(fs(this),e),Bt(Nc.get(this))}:function(...e){return Bt(n.apply(fs(this),e))}}function hf(n){return typeof n=="function"?uf(n):(n instanceof IDBTransaction&&lf(n),rf(n,sf())?new Proxy(n,Rs):n)}function Bt(n){if(n instanceof IDBRequest)return af(n);if(ds.has(n))return ds.get(n);const e=hf(n);return e!==n&&(ds.set(n,e),go.set(e,n)),e}const fs=n=>go.get(n);function df(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(n,e),l=Bt(a);return r&&a.addEventListener("upgradeneeded",d=>{r(Bt(a.result),d.oldVersion,d.newVersion,Bt(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),l.then(d=>{o&&d.addEventListener("close",()=>o()),i&&d.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),l}const ff=["get","getKey","getAll","getAllKeys","count"],mf=["put","add","delete","clear"],ms=new Map;function Ka(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ms.get(e))return ms.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=mf.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||ff.includes(t)))return;const o=async function(a,...l){const d=this.transaction(a,i?"readwrite":"readonly");let m=d.store;return r&&(m=m.index(l.shift())),(await Promise.all([m[t](...l),i&&d.done]))[0]};return ms.set(e,o),o}cf(n=>({...n,get:(e,t,r)=>Ka(e,t)||n.get(e,t,r),has:(e,t)=>!!Ka(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(gf(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function gf(n){const e=n.getComponent();return e?.type==="VERSION"}const xs="@firebase/app",Qa="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const It=new Bc("@firebase/app"),yf="@firebase/app-compat",_f="@firebase/analytics-compat",vf="@firebase/analytics",Ef="@firebase/app-check-compat",Tf="@firebase/app-check",wf="@firebase/auth",If="@firebase/auth-compat",bf="@firebase/database",Af="@firebase/data-connect",Cf="@firebase/database-compat",Sf="@firebase/functions",kf="@firebase/functions-compat",Rf="@firebase/installations",xf="@firebase/installations-compat",Pf="@firebase/messaging",Df="@firebase/messaging-compat",Vf="@firebase/performance",Bf="@firebase/performance-compat",Nf="@firebase/remote-config",Lf="@firebase/remote-config-compat",Mf="@firebase/storage",Of="@firebase/storage-compat",Ff="@firebase/firestore",Uf="@firebase/ai",zf="@firebase/firestore-compat",jf="firebase",$f="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps="[DEFAULT]",qf={[xs]:"fire-core",[yf]:"fire-core-compat",[vf]:"fire-analytics",[_f]:"fire-analytics-compat",[Tf]:"fire-app-check",[Ef]:"fire-app-check-compat",[wf]:"fire-auth",[If]:"fire-auth-compat",[bf]:"fire-rtdb",[Af]:"fire-data-connect",[Cf]:"fire-rtdb-compat",[Sf]:"fire-fn",[kf]:"fire-fn-compat",[Rf]:"fire-iid",[xf]:"fire-iid-compat",[Pf]:"fire-fcm",[Df]:"fire-fcm-compat",[Vf]:"fire-perf",[Bf]:"fire-perf-compat",[Nf]:"fire-rc",[Lf]:"fire-rc-compat",[Mf]:"fire-gcs",[Of]:"fire-gcs-compat",[Ff]:"fire-fst",[zf]:"fire-fst-compat",[Uf]:"fire-vertex","fire-js":"fire-js",[jf]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi=new Map,Hf=new Map,Ds=new Map;function Xa(n,e){try{n.container.addComponent(e)}catch(t){It.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function _i(n){const e=n.name;if(Ds.has(e))return It.debug(`There were multiple attempts to register component ${e}.`),!1;Ds.set(e,n);for(const t of yi.values())Xa(t,n);for(const t of Hf.values())Xa(t,n);return!0}function Gf(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Wf(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Nt=new Vc("app","Firebase",Kf);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new pr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf=$f;function Mc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Ps,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Nt.create("bad-app-name",{appName:String(i)});if(t||(t=Dc()),!t)throw Nt.create("no-options");const o=yi.get(i);if(o){if(gi(t,o.options)&&gi(r,o.config))return o;throw Nt.create("duplicate-app",{appName:i})}const a=new Jd(i);for(const d of Ds.values())a.addComponent(d);const l=new Qf(t,r,a);return yi.set(i,l),l}function Yf(n=Ps){const e=yi.get(n);if(!e&&n===Ps&&Dc())return Mc();if(!e)throw Nt.create("no-app",{appName:n});return e}function wn(n,e,t){var r;let i=(r=qf[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const l=[`Unable to register library "${i}" with version "${e}":`];o&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),It.warn(l.join(" "));return}_i(new pr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf="firebase-heartbeat-database",Zf=1,gr="firebase-heartbeat-store";let ps=null;function Oc(){return ps||(ps=df(Jf,Zf,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(gr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Nt.create("idb-open",{originalErrorMessage:n.message})})),ps}async function em(n){try{const t=(await Oc()).transaction(gr),r=await t.objectStore(gr).get(Fc(n));return await t.done,r}catch(e){if(e instanceof Bn)It.warn(e.message);else{const t=Nt.create("idb-get",{originalErrorMessage:e?.message});It.warn(t.message)}}}async function Ya(n,e){try{const r=(await Oc()).transaction(gr,"readwrite");await r.objectStore(gr).put(e,Fc(n)),await r.done}catch(t){if(t instanceof Bn)It.warn(t.message);else{const r=Nt.create("idb-set",{originalErrorMessage:t?.message});It.warn(r.message)}}}function Fc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm=1024,nm=30;class rm{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new sm(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ja();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>nm){const a=om(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){It.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ja(),{heartbeatsToSend:r,unsentEntries:i}=im(this._heartbeatsCache.heartbeats),o=pi(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return It.warn(t),""}}}function Ja(){return new Date().toISOString().substring(0,10)}function im(n,e=tm){const t=[];let r=n.slice();for(const i of n){const o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Za(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Za(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class sm{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return qd()?Hd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await em(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Ya(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Ya(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Za(n){return pi(JSON.stringify({version:2,heartbeats:n})).length}function om(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function am(n){_i(new pr("platform-logger",e=>new pf(e),"PRIVATE")),_i(new pr("heartbeat",e=>new rm(e),"PRIVATE")),wn(xs,Qa,n),wn(xs,Qa,"esm2017"),wn("fire-js","")}am("");var lm="firebase",cm="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wn(lm,cm,"app");var el=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Lt,Uc;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(b,g){function E(){}E.prototype=g.prototype,b.D=g.prototype,b.prototype=new E,b.prototype.constructor=b,b.C=function(_,w,C){for(var I=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)I[Y-2]=arguments[Y];return g.prototype[w].apply(_,I)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(b,g,E){E||(E=0);var _=Array(16);if(typeof g=="string")for(var w=0;16>w;++w)_[w]=g.charCodeAt(E++)|g.charCodeAt(E++)<<8|g.charCodeAt(E++)<<16|g.charCodeAt(E++)<<24;else for(w=0;16>w;++w)_[w]=g[E++]|g[E++]<<8|g[E++]<<16|g[E++]<<24;g=b.g[0],E=b.g[1],w=b.g[2];var C=b.g[3],I=g+(C^E&(w^C))+_[0]+3614090360&4294967295;g=E+(I<<7&4294967295|I>>>25),I=C+(w^g&(E^w))+_[1]+3905402710&4294967295,C=g+(I<<12&4294967295|I>>>20),I=w+(E^C&(g^E))+_[2]+606105819&4294967295,w=C+(I<<17&4294967295|I>>>15),I=E+(g^w&(C^g))+_[3]+3250441966&4294967295,E=w+(I<<22&4294967295|I>>>10),I=g+(C^E&(w^C))+_[4]+4118548399&4294967295,g=E+(I<<7&4294967295|I>>>25),I=C+(w^g&(E^w))+_[5]+1200080426&4294967295,C=g+(I<<12&4294967295|I>>>20),I=w+(E^C&(g^E))+_[6]+2821735955&4294967295,w=C+(I<<17&4294967295|I>>>15),I=E+(g^w&(C^g))+_[7]+4249261313&4294967295,E=w+(I<<22&4294967295|I>>>10),I=g+(C^E&(w^C))+_[8]+1770035416&4294967295,g=E+(I<<7&4294967295|I>>>25),I=C+(w^g&(E^w))+_[9]+2336552879&4294967295,C=g+(I<<12&4294967295|I>>>20),I=w+(E^C&(g^E))+_[10]+4294925233&4294967295,w=C+(I<<17&4294967295|I>>>15),I=E+(g^w&(C^g))+_[11]+2304563134&4294967295,E=w+(I<<22&4294967295|I>>>10),I=g+(C^E&(w^C))+_[12]+1804603682&4294967295,g=E+(I<<7&4294967295|I>>>25),I=C+(w^g&(E^w))+_[13]+4254626195&4294967295,C=g+(I<<12&4294967295|I>>>20),I=w+(E^C&(g^E))+_[14]+2792965006&4294967295,w=C+(I<<17&4294967295|I>>>15),I=E+(g^w&(C^g))+_[15]+1236535329&4294967295,E=w+(I<<22&4294967295|I>>>10),I=g+(w^C&(E^w))+_[1]+4129170786&4294967295,g=E+(I<<5&4294967295|I>>>27),I=C+(E^w&(g^E))+_[6]+3225465664&4294967295,C=g+(I<<9&4294967295|I>>>23),I=w+(g^E&(C^g))+_[11]+643717713&4294967295,w=C+(I<<14&4294967295|I>>>18),I=E+(C^g&(w^C))+_[0]+3921069994&4294967295,E=w+(I<<20&4294967295|I>>>12),I=g+(w^C&(E^w))+_[5]+3593408605&4294967295,g=E+(I<<5&4294967295|I>>>27),I=C+(E^w&(g^E))+_[10]+38016083&4294967295,C=g+(I<<9&4294967295|I>>>23),I=w+(g^E&(C^g))+_[15]+3634488961&4294967295,w=C+(I<<14&4294967295|I>>>18),I=E+(C^g&(w^C))+_[4]+3889429448&4294967295,E=w+(I<<20&4294967295|I>>>12),I=g+(w^C&(E^w))+_[9]+568446438&4294967295,g=E+(I<<5&4294967295|I>>>27),I=C+(E^w&(g^E))+_[14]+3275163606&4294967295,C=g+(I<<9&4294967295|I>>>23),I=w+(g^E&(C^g))+_[3]+4107603335&4294967295,w=C+(I<<14&4294967295|I>>>18),I=E+(C^g&(w^C))+_[8]+1163531501&4294967295,E=w+(I<<20&4294967295|I>>>12),I=g+(w^C&(E^w))+_[13]+2850285829&4294967295,g=E+(I<<5&4294967295|I>>>27),I=C+(E^w&(g^E))+_[2]+4243563512&4294967295,C=g+(I<<9&4294967295|I>>>23),I=w+(g^E&(C^g))+_[7]+1735328473&4294967295,w=C+(I<<14&4294967295|I>>>18),I=E+(C^g&(w^C))+_[12]+2368359562&4294967295,E=w+(I<<20&4294967295|I>>>12),I=g+(E^w^C)+_[5]+4294588738&4294967295,g=E+(I<<4&4294967295|I>>>28),I=C+(g^E^w)+_[8]+2272392833&4294967295,C=g+(I<<11&4294967295|I>>>21),I=w+(C^g^E)+_[11]+1839030562&4294967295,w=C+(I<<16&4294967295|I>>>16),I=E+(w^C^g)+_[14]+4259657740&4294967295,E=w+(I<<23&4294967295|I>>>9),I=g+(E^w^C)+_[1]+2763975236&4294967295,g=E+(I<<4&4294967295|I>>>28),I=C+(g^E^w)+_[4]+1272893353&4294967295,C=g+(I<<11&4294967295|I>>>21),I=w+(C^g^E)+_[7]+4139469664&4294967295,w=C+(I<<16&4294967295|I>>>16),I=E+(w^C^g)+_[10]+3200236656&4294967295,E=w+(I<<23&4294967295|I>>>9),I=g+(E^w^C)+_[13]+681279174&4294967295,g=E+(I<<4&4294967295|I>>>28),I=C+(g^E^w)+_[0]+3936430074&4294967295,C=g+(I<<11&4294967295|I>>>21),I=w+(C^g^E)+_[3]+3572445317&4294967295,w=C+(I<<16&4294967295|I>>>16),I=E+(w^C^g)+_[6]+76029189&4294967295,E=w+(I<<23&4294967295|I>>>9),I=g+(E^w^C)+_[9]+3654602809&4294967295,g=E+(I<<4&4294967295|I>>>28),I=C+(g^E^w)+_[12]+3873151461&4294967295,C=g+(I<<11&4294967295|I>>>21),I=w+(C^g^E)+_[15]+530742520&4294967295,w=C+(I<<16&4294967295|I>>>16),I=E+(w^C^g)+_[2]+3299628645&4294967295,E=w+(I<<23&4294967295|I>>>9),I=g+(w^(E|~C))+_[0]+4096336452&4294967295,g=E+(I<<6&4294967295|I>>>26),I=C+(E^(g|~w))+_[7]+1126891415&4294967295,C=g+(I<<10&4294967295|I>>>22),I=w+(g^(C|~E))+_[14]+2878612391&4294967295,w=C+(I<<15&4294967295|I>>>17),I=E+(C^(w|~g))+_[5]+4237533241&4294967295,E=w+(I<<21&4294967295|I>>>11),I=g+(w^(E|~C))+_[12]+1700485571&4294967295,g=E+(I<<6&4294967295|I>>>26),I=C+(E^(g|~w))+_[3]+2399980690&4294967295,C=g+(I<<10&4294967295|I>>>22),I=w+(g^(C|~E))+_[10]+4293915773&4294967295,w=C+(I<<15&4294967295|I>>>17),I=E+(C^(w|~g))+_[1]+2240044497&4294967295,E=w+(I<<21&4294967295|I>>>11),I=g+(w^(E|~C))+_[8]+1873313359&4294967295,g=E+(I<<6&4294967295|I>>>26),I=C+(E^(g|~w))+_[15]+4264355552&4294967295,C=g+(I<<10&4294967295|I>>>22),I=w+(g^(C|~E))+_[6]+2734768916&4294967295,w=C+(I<<15&4294967295|I>>>17),I=E+(C^(w|~g))+_[13]+1309151649&4294967295,E=w+(I<<21&4294967295|I>>>11),I=g+(w^(E|~C))+_[4]+4149444226&4294967295,g=E+(I<<6&4294967295|I>>>26),I=C+(E^(g|~w))+_[11]+3174756917&4294967295,C=g+(I<<10&4294967295|I>>>22),I=w+(g^(C|~E))+_[2]+718787259&4294967295,w=C+(I<<15&4294967295|I>>>17),I=E+(C^(w|~g))+_[9]+3951481745&4294967295,b.g[0]=b.g[0]+g&4294967295,b.g[1]=b.g[1]+(w+(I<<21&4294967295|I>>>11))&4294967295,b.g[2]=b.g[2]+w&4294967295,b.g[3]=b.g[3]+C&4294967295}r.prototype.u=function(b,g){g===void 0&&(g=b.length);for(var E=g-this.blockSize,_=this.B,w=this.h,C=0;C<g;){if(w==0)for(;C<=E;)i(this,b,C),C+=this.blockSize;if(typeof b=="string"){for(;C<g;)if(_[w++]=b.charCodeAt(C++),w==this.blockSize){i(this,_),w=0;break}}else for(;C<g;)if(_[w++]=b[C++],w==this.blockSize){i(this,_),w=0;break}}this.h=w,this.o+=g},r.prototype.v=function(){var b=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);b[0]=128;for(var g=1;g<b.length-8;++g)b[g]=0;var E=8*this.o;for(g=b.length-8;g<b.length;++g)b[g]=E&255,E/=256;for(this.u(b),b=Array(16),g=E=0;4>g;++g)for(var _=0;32>_;_+=8)b[E++]=this.g[g]>>>_&255;return b};function o(b,g){var E=l;return Object.prototype.hasOwnProperty.call(E,b)?E[b]:E[b]=g(b)}function a(b,g){this.h=g;for(var E=[],_=!0,w=b.length-1;0<=w;w--){var C=b[w]|0;_&&C==g||(E[w]=C,_=!1)}this.g=E}var l={};function d(b){return-128<=b&&128>b?o(b,function(g){return new a([g|0],0>g?-1:0)}):new a([b|0],0>b?-1:0)}function m(b){if(isNaN(b)||!isFinite(b))return A;if(0>b)return O(m(-b));for(var g=[],E=1,_=0;b>=E;_++)g[_]=b/E|0,E*=4294967296;return new a(g,0)}function y(b,g){if(b.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(b.charAt(0)=="-")return O(y(b.substring(1),g));if(0<=b.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=m(Math.pow(g,8)),_=A,w=0;w<b.length;w+=8){var C=Math.min(8,b.length-w),I=parseInt(b.substring(w,w+C),g);8>C?(C=m(Math.pow(g,C)),_=_.j(C).add(m(I))):(_=_.j(E),_=_.add(m(I)))}return _}var A=d(0),k=d(1),S=d(16777216);n=a.prototype,n.m=function(){if(B(this))return-O(this).m();for(var b=0,g=1,E=0;E<this.g.length;E++){var _=this.i(E);b+=(0<=_?_:4294967296+_)*g,g*=4294967296}return b},n.toString=function(b){if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(P(this))return"0";if(B(this))return"-"+O(this).toString(b);for(var g=m(Math.pow(b,6)),E=this,_="";;){var w=M(E,g).g;E=q(E,w.j(g));var C=((0<E.g.length?E.g[0]:E.h)>>>0).toString(b);if(E=w,P(E))return C+_;for(;6>C.length;)C="0"+C;_=C+_}},n.i=function(b){return 0>b?0:b<this.g.length?this.g[b]:this.h};function P(b){if(b.h!=0)return!1;for(var g=0;g<b.g.length;g++)if(b.g[g]!=0)return!1;return!0}function B(b){return b.h==-1}n.l=function(b){return b=q(this,b),B(b)?-1:P(b)?0:1};function O(b){for(var g=b.g.length,E=[],_=0;_<g;_++)E[_]=~b.g[_];return new a(E,~b.h).add(k)}n.abs=function(){return B(this)?O(this):this},n.add=function(b){for(var g=Math.max(this.g.length,b.g.length),E=[],_=0,w=0;w<=g;w++){var C=_+(this.i(w)&65535)+(b.i(w)&65535),I=(C>>>16)+(this.i(w)>>>16)+(b.i(w)>>>16);_=I>>>16,C&=65535,I&=65535,E[w]=I<<16|C}return new a(E,E[E.length-1]&-2147483648?-1:0)};function q(b,g){return b.add(O(g))}n.j=function(b){if(P(this)||P(b))return A;if(B(this))return B(b)?O(this).j(O(b)):O(O(this).j(b));if(B(b))return O(this.j(O(b)));if(0>this.l(S)&&0>b.l(S))return m(this.m()*b.m());for(var g=this.g.length+b.g.length,E=[],_=0;_<2*g;_++)E[_]=0;for(_=0;_<this.g.length;_++)for(var w=0;w<b.g.length;w++){var C=this.i(_)>>>16,I=this.i(_)&65535,Y=b.i(w)>>>16,ae=b.i(w)&65535;E[2*_+2*w]+=I*ae,$(E,2*_+2*w),E[2*_+2*w+1]+=C*ae,$(E,2*_+2*w+1),E[2*_+2*w+1]+=I*Y,$(E,2*_+2*w+1),E[2*_+2*w+2]+=C*Y,$(E,2*_+2*w+2)}for(_=0;_<g;_++)E[_]=E[2*_+1]<<16|E[2*_];for(_=g;_<2*g;_++)E[_]=0;return new a(E,0)};function $(b,g){for(;(b[g]&65535)!=b[g];)b[g+1]+=b[g]>>>16,b[g]&=65535,g++}function G(b,g){this.g=b,this.h=g}function M(b,g){if(P(g))throw Error("division by zero");if(P(b))return new G(A,A);if(B(b))return g=M(O(b),g),new G(O(g.g),O(g.h));if(B(g))return g=M(b,O(g)),new G(O(g.g),g.h);if(30<b.g.length){if(B(b)||B(g))throw Error("slowDivide_ only works with positive integers.");for(var E=k,_=g;0>=_.l(b);)E=N(E),_=N(_);var w=U(E,1),C=U(_,1);for(_=U(_,2),E=U(E,2);!P(_);){var I=C.add(_);0>=I.l(b)&&(w=w.add(E),C=I),_=U(_,1),E=U(E,1)}return g=q(b,w.j(g)),new G(w,g)}for(w=A;0<=b.l(g);){for(E=Math.max(1,Math.floor(b.m()/g.m())),_=Math.ceil(Math.log(E)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),C=m(E),I=C.j(g);B(I)||0<I.l(b);)E-=_,C=m(E),I=C.j(g);P(C)&&(C=k),w=w.add(C),b=q(b,I)}return new G(w,b)}n.A=function(b){return M(this,b).h},n.and=function(b){for(var g=Math.max(this.g.length,b.g.length),E=[],_=0;_<g;_++)E[_]=this.i(_)&b.i(_);return new a(E,this.h&b.h)},n.or=function(b){for(var g=Math.max(this.g.length,b.g.length),E=[],_=0;_<g;_++)E[_]=this.i(_)|b.i(_);return new a(E,this.h|b.h)},n.xor=function(b){for(var g=Math.max(this.g.length,b.g.length),E=[],_=0;_<g;_++)E[_]=this.i(_)^b.i(_);return new a(E,this.h^b.h)};function N(b){for(var g=b.g.length+1,E=[],_=0;_<g;_++)E[_]=b.i(_)<<1|b.i(_-1)>>>31;return new a(E,b.h)}function U(b,g){var E=g>>5;g%=32;for(var _=b.g.length-E,w=[],C=0;C<_;C++)w[C]=0<g?b.i(C+E)>>>g|b.i(C+E+1)<<32-g:b.i(C+E);return new a(w,b.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Uc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=y,Lt=a}).apply(typeof el<"u"?el:typeof self<"u"?self:typeof window<"u"?window:{});var jr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zc,er,jc,Zr,Vs,$c,qc,Hc;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,c,f){return s==Array.prototype||s==Object.prototype||(s[c]=f.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof jr=="object"&&jr];for(var c=0;c<s.length;++c){var f=s[c];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var f=r;s=s.split(".");for(var v=0;v<s.length-1;v++){var x=s[v];if(!(x in f))break e;f=f[x]}s=s[s.length-1],v=f[s],c=c(v),c!=v&&c!=null&&e(f,s,{configurable:!0,writable:!0,value:c})}}function o(s,c){s instanceof String&&(s+="");var f=0,v=!1,x={next:function(){if(!v&&f<s.length){var V=f++;return{value:c(V,s[V]),done:!1}}return v=!0,{done:!0,value:void 0}}};return x[Symbol.iterator]=function(){return x},x}i("Array.prototype.values",function(s){return s||function(){return o(this,function(c,f){return f})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},l=this||self;function d(s){var c=typeof s;return c=c!="object"?c:s?Array.isArray(s)?"array":c:"null",c=="array"||c=="object"&&typeof s.length=="number"}function m(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function y(s,c,f){return s.call.apply(s.bind,arguments)}function A(s,c,f){if(!s)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var x=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(x,v),s.apply(c,x)}}return function(){return s.apply(c,arguments)}}function k(s,c,f){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?y:A,k.apply(null,arguments)}function S(s,c){var f=Array.prototype.slice.call(arguments,1);return function(){var v=f.slice();return v.push.apply(v,arguments),s.apply(this,v)}}function P(s,c){function f(){}f.prototype=c.prototype,s.aa=c.prototype,s.prototype=new f,s.prototype.constructor=s,s.Qb=function(v,x,V){for(var j=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)j[pe-2]=arguments[pe];return c.prototype[x].apply(v,j)}}function B(s){const c=s.length;if(0<c){const f=Array(c);for(let v=0;v<c;v++)f[v]=s[v];return f}return[]}function O(s,c){for(let f=1;f<arguments.length;f++){const v=arguments[f];if(d(v)){const x=s.length||0,V=v.length||0;s.length=x+V;for(let j=0;j<V;j++)s[x+j]=v[j]}else s.push(v)}}class q{constructor(c,f){this.i=c,this.j=f,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function $(s){return/^[\s\xa0]*$/.test(s)}function G(){var s=l.navigator;return s&&(s=s.userAgent)?s:""}function M(s){return M[" "](s),s}M[" "]=function(){};var N=G().indexOf("Gecko")!=-1&&!(G().toLowerCase().indexOf("webkit")!=-1&&G().indexOf("Edge")==-1)&&!(G().indexOf("Trident")!=-1||G().indexOf("MSIE")!=-1)&&G().indexOf("Edge")==-1;function U(s,c,f){for(const v in s)c.call(f,s[v],v,s)}function b(s,c){for(const f in s)c.call(void 0,s[f],f,s)}function g(s){const c={};for(const f in s)c[f]=s[f];return c}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(s,c){let f,v;for(let x=1;x<arguments.length;x++){v=arguments[x];for(f in v)s[f]=v[f];for(let V=0;V<E.length;V++)f=E[V],Object.prototype.hasOwnProperty.call(v,f)&&(s[f]=v[f])}}function w(s){var c=1;s=s.split(":");const f=[];for(;0<c&&s.length;)f.push(s.shift()),c--;return s.length&&f.push(s.join(":")),f}function C(s){l.setTimeout(()=>{throw s},0)}function I(){var s=je;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class Y{constructor(){this.h=this.g=null}add(c,f){const v=ae.get();v.set(c,f),this.h?this.h.next=v:this.g=v,this.h=v}}var ae=new q(()=>new we,s=>s.reset());class we{constructor(){this.next=this.g=this.h=null}set(c,f){this.h=c,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,Ie=!1,je=new Y,st=()=>{const s=l.Promise.resolve(void 0);Ee=()=>{s.then(ue)}};var ue=()=>{for(var s;s=I();){try{s.h.call(s.g)}catch(f){C(f)}var c=ae;c.j(s),100>c.h&&(c.h++,s.next=c.g,c.g=s)}Ie=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ye(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}ye.prototype.h=function(){this.defaultPrevented=!0};var Ce=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{const f=()=>{};l.addEventListener("test",f,c),l.removeEventListener("test",f,c)}catch{}return s}();function Ve(s,c){if(ye.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var f=this.type=s.type,v=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget){if(N){e:{try{M(c.nodeName);var x=!0;break e}catch{}x=!1}x||(c=null)}}else f=="mouseover"?c=s.fromElement:f=="mouseout"&&(c=s.toElement);this.relatedTarget=c,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:ot[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Ve.aa.h.call(this)}}P(Ve,ye);var ot={2:"touch",3:"pen",4:"mouse"};Ve.prototype.h=function(){Ve.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var We="closure_listenable_"+(1e6*Math.random()|0),Be=0;function te(s,c,f,v,x){this.listener=s,this.proxy=null,this.src=c,this.type=f,this.capture=!!v,this.ha=x,this.key=++Be,this.da=this.fa=!1}function Q(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function J(s){this.src=s,this.g={},this.h=0}J.prototype.add=function(s,c,f,v,x){var V=s.toString();s=this.g[V],s||(s=this.g[V]=[],this.h++);var j=de(s,c,v,x);return-1<j?(c=s[j],f||(c.fa=!1)):(c=new te(c,this.src,V,!!v,x),c.fa=f,s.push(c)),c};function re(s,c){var f=c.type;if(f in s.g){var v=s.g[f],x=Array.prototype.indexOf.call(v,c,void 0),V;(V=0<=x)&&Array.prototype.splice.call(v,x,1),V&&(Q(c),s.g[f].length==0&&(delete s.g[f],s.h--))}}function de(s,c,f,v){for(var x=0;x<s.length;++x){var V=s[x];if(!V.da&&V.listener==c&&V.capture==!!f&&V.ha==v)return x}return-1}var ke="closure_lm_"+(1e6*Math.random()|0),Oe={};function Fe(s,c,f,v,x){if(Array.isArray(c)){for(var V=0;V<c.length;V++)Fe(s,c[V],f,v,x);return null}return f=lt(f),s&&s[We]?s.K(c,f,m(v)?!!v.capture:!1,x):at(s,c,f,!1,v,x)}function at(s,c,f,v,x,V){if(!c)throw Error("Invalid event type");var j=m(x)?!!x.capture:!!x,pe=Ht(s);if(pe||(s[ke]=pe=new J(s)),f=pe.add(c,f,v,j,V),f.proxy)return f;if(v=ht(),f.proxy=v,v.src=s,v.listener=f,s.addEventListener)Ce||(x=j),x===void 0&&(x=!1),s.addEventListener(c.toString(),v,x);else if(s.attachEvent)s.attachEvent(vt(c.toString()),v);else if(s.addListener&&s.removeListener)s.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return f}function ht(){function s(f){return c.call(s.src,s.listener,f)}const c=rt;return s}function un(s,c,f,v,x){if(Array.isArray(c))for(var V=0;V<c.length;V++)un(s,c[V],f,v,x);else v=m(v)?!!v.capture:!!v,f=lt(f),s&&s[We]?(s=s.i,c=String(c).toString(),c in s.g&&(V=s.g[c],f=de(V,f,v,x),-1<f&&(Q(V[f]),Array.prototype.splice.call(V,f,1),V.length==0&&(delete s.g[c],s.h--)))):s&&(s=Ht(s))&&(c=s.g[c.toString()],s=-1,c&&(s=de(c,f,v,x)),(f=-1<s?c[s]:null)&&dt(f))}function dt(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[We])re(c.i,s);else{var f=s.type,v=s.proxy;c.removeEventListener?c.removeEventListener(f,v,s.capture):c.detachEvent?c.detachEvent(vt(f),v):c.addListener&&c.removeListener&&c.removeListener(v),(f=Ht(c))?(re(f,s),f.h==0&&(f.src=null,c[ke]=null)):Q(s)}}}function vt(s){return s in Oe?Oe[s]:Oe[s]="on"+s}function rt(s,c){if(s.da)s=!0;else{c=new Ve(c,this);var f=s.listener,v=s.ha||s.src;s.fa&&dt(s),s=f.call(v,c)}return s}function Ht(s){return s=s[ke],s instanceof J?s:null}var Fn="__closure_events_fn_"+(1e9*Math.random()>>>0);function lt(s){return typeof s=="function"?s:(s[Fn]||(s[Fn]=function(c){return s.handleEvent(c)}),s[Fn])}function Ue(){Z.call(this),this.i=new J(this),this.M=this,this.F=null}P(Ue,Z),Ue.prototype[We]=!0,Ue.prototype.removeEventListener=function(s,c,f,v){un(this,s,c,f,v)};function p(s,c){var f,v=s.F;if(v)for(f=[];v;v=v.F)f.push(v);if(s=s.M,v=c.type||c,typeof c=="string")c=new ye(c,s);else if(c instanceof ye)c.target=c.target||s;else{var x=c;c=new ye(v,s),_(c,x)}if(x=!0,f)for(var V=f.length-1;0<=V;V--){var j=c.g=f[V];x=u(j,v,!0,c)&&x}if(j=c.g=s,x=u(j,v,!0,c)&&x,x=u(j,v,!1,c)&&x,f)for(V=0;V<f.length;V++)j=c.g=f[V],x=u(j,v,!1,c)&&x}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var s=this.i,c;for(c in s.g){for(var f=s.g[c],v=0;v<f.length;v++)Q(f[v]);delete s.g[c],s.h--}}this.F=null},Ue.prototype.K=function(s,c,f,v){return this.i.add(String(s),c,!1,f,v)},Ue.prototype.L=function(s,c,f,v){return this.i.add(String(s),c,!0,f,v)};function u(s,c,f,v){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();for(var x=!0,V=0;V<c.length;++V){var j=c[V];if(j&&!j.da&&j.capture==f){var pe=j.listener,$e=j.ha||j.src;j.fa&&re(s.i,j),x=pe.call($e,v)!==!1&&x}}return x&&!v.defaultPrevented}function h(s,c,f){if(typeof s=="function")f&&(s=k(s,f));else if(s&&typeof s.handleEvent=="function")s=k(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:l.setTimeout(s,c||0)}function T(s){s.g=h(()=>{s.g=null,s.i&&(s.i=!1,T(s))},s.l);const c=s.h;s.h=null,s.m.apply(null,c)}class R extends Z{constructor(c,f){super(),this.m=c,this.l=f,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:T(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function D(s){Z.call(this),this.h=s,this.g={}}P(D,Z);var L=[];function ie(s){U(s.g,function(c,f){this.g.hasOwnProperty(f)&&dt(c)},s),s.g={}}D.prototype.N=function(){D.aa.N.call(this),ie(this)},D.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _e=l.JSON.stringify,ve=l.JSON.parse,be=class{stringify(s){return l.JSON.stringify(s,void 0)}parse(s){return l.JSON.parse(s,void 0)}};function fe(){}fe.prototype.h=null;function Xo(s){return s.h||(s.h=s.i())}function Yo(){}var Un={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ji(){ye.call(this,"d")}P(Ji,ye);function Zi(){ye.call(this,"c")}P(Zi,ye);var Gt={},Jo=null;function Sr(){return Jo=Jo||new Ue}Gt.La="serverreachability";function Zo(s){ye.call(this,Gt.La,s)}P(Zo,ye);function zn(s){const c=Sr();p(c,new Zo(c))}Gt.STAT_EVENT="statevent";function ea(s,c){ye.call(this,Gt.STAT_EVENT,s),this.stat=c}P(ea,ye);function Ze(s){const c=Sr();p(c,new ea(c,s))}Gt.Ma="timingevent";function ta(s,c){ye.call(this,Gt.Ma,s),this.size=c}P(ta,ye);function jn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){s()},c)}function $n(){this.g=!0}$n.prototype.xa=function(){this.g=!1};function Dh(s,c,f,v,x,V){s.info(function(){if(s.g)if(V)for(var j="",pe=V.split("&"),$e=0;$e<pe.length;$e++){var he=pe[$e].split("=");if(1<he.length){var Ke=he[0];he=he[1];var Qe=Ke.split("_");j=2<=Qe.length&&Qe[1]=="type"?j+(Ke+"="+he+"&"):j+(Ke+"=redacted&")}}else j=null;else j=V;return"XMLHTTP REQ ("+v+") [attempt "+x+"]: "+c+`
`+f+`
`+j})}function Vh(s,c,f,v,x,V,j){s.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+x+"]: "+c+`
`+f+`
`+V+" "+j})}function hn(s,c,f,v){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Nh(s,f)+(v?" "+v:"")})}function Bh(s,c){s.info(function(){return"TIMEOUT: "+c})}$n.prototype.info=function(){};function Nh(s,c){if(!s.g)return c;if(!c)return null;try{var f=JSON.parse(c);if(f){for(s=0;s<f.length;s++)if(Array.isArray(f[s])){var v=f[s];if(!(2>v.length)){var x=v[1];if(Array.isArray(x)&&!(1>x.length)){var V=x[0];if(V!="noop"&&V!="stop"&&V!="close")for(var j=1;j<x.length;j++)x[j]=""}}}}return _e(f)}catch{return c}}var kr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},na={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},es;function Rr(){}P(Rr,fe),Rr.prototype.g=function(){return new XMLHttpRequest},Rr.prototype.i=function(){return{}},es=new Rr;function Ct(s,c,f,v){this.j=s,this.i=c,this.l=f,this.R=v||1,this.U=new D(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ra}function ra(){this.i=null,this.g="",this.h=!1}var ia={},ts={};function ns(s,c,f){s.L=1,s.v=Vr(Et(c)),s.m=f,s.P=!0,sa(s,null)}function sa(s,c){s.F=Date.now(),xr(s),s.A=Et(s.v);var f=s.A,v=s.R;Array.isArray(v)||(v=[String(v)]),va(f.i,"t",v),s.C=0,f=s.j.J,s.h=new ra,s.g=Ma(s.j,f?c:null,!s.m),0<s.O&&(s.M=new R(k(s.Y,s,s.g),s.O)),c=s.U,f=s.g,v=s.ca;var x="readystatechange";Array.isArray(x)||(x&&(L[0]=x.toString()),x=L);for(var V=0;V<x.length;V++){var j=Fe(f,x[V],v||c.handleEvent,!1,c.h||c);if(!j)break;c.g[j.key]=j}c=s.H?g(s.H):{},s.m?(s.u||(s.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,c)):(s.u="GET",s.g.ea(s.A,s.u,null,c)),zn(),Dh(s.i,s.u,s.A,s.l,s.R,s.m)}Ct.prototype.ca=function(s){s=s.target;const c=this.M;c&&Tt(s)==3?c.j():this.Y(s)},Ct.prototype.Y=function(s){try{if(s==this.g)e:{const Qe=Tt(this.g);var c=this.g.Ba();const mn=this.g.Z();if(!(3>Qe)&&(Qe!=3||this.g&&(this.h.h||this.g.oa()||Ca(this.g)))){this.J||Qe!=4||c==7||(c==8||0>=mn?zn(3):zn(2)),rs(this);var f=this.g.Z();this.X=f;t:if(oa(this)){var v=Ca(this.g);s="";var x=v.length,V=Tt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wt(this),qn(this);var j="";break t}this.h.i=new l.TextDecoder}for(c=0;c<x;c++)this.h.h=!0,s+=this.h.i.decode(v[c],{stream:!(V&&c==x-1)});v.length=0,this.h.g+=s,this.C=0,j=this.h.g}else j=this.g.oa();if(this.o=f==200,Vh(this.i,this.u,this.A,this.l,this.R,Qe,f),this.o){if(this.T&&!this.K){t:{if(this.g){var pe,$e=this.g;if((pe=$e.g?$e.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(pe)){var he=pe;break t}}he=null}if(f=he)hn(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,is(this,f);else{this.o=!1,this.s=3,Ze(12),Wt(this),qn(this);break e}}if(this.P){f=!0;let ct;for(;!this.J&&this.C<j.length;)if(ct=Lh(this,j),ct==ts){Qe==4&&(this.s=4,Ze(14),f=!1),hn(this.i,this.l,null,"[Incomplete Response]");break}else if(ct==ia){this.s=4,Ze(15),hn(this.i,this.l,j,"[Invalid Chunk]"),f=!1;break}else hn(this.i,this.l,ct,null),is(this,ct);if(oa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Qe!=4||j.length!=0||this.h.h||(this.s=1,Ze(16),f=!1),this.o=this.o&&f,!f)hn(this.i,this.l,j,"[Invalid Chunked Response]"),Wt(this),qn(this);else if(0<j.length&&!this.W){this.W=!0;var Ke=this.j;Ke.g==this&&Ke.ba&&!Ke.M&&(Ke.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),us(Ke),Ke.M=!0,Ze(11))}}else hn(this.i,this.l,j,null),is(this,j);Qe==4&&Wt(this),this.o&&!this.J&&(Qe==4?Va(this.j,this):(this.o=!1,xr(this)))}else Zh(this.g),f==400&&0<j.indexOf("Unknown SID")?(this.s=3,Ze(12)):(this.s=0,Ze(13)),Wt(this),qn(this)}}}catch{}finally{}};function oa(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function Lh(s,c){var f=s.C,v=c.indexOf(`
`,f);return v==-1?ts:(f=Number(c.substring(f,v)),isNaN(f)?ia:(v+=1,v+f>c.length?ts:(c=c.slice(v,v+f),s.C=v+f,c)))}Ct.prototype.cancel=function(){this.J=!0,Wt(this)};function xr(s){s.S=Date.now()+s.I,aa(s,s.I)}function aa(s,c){if(s.B!=null)throw Error("WatchDog timer not null");s.B=jn(k(s.ba,s),c)}function rs(s){s.B&&(l.clearTimeout(s.B),s.B=null)}Ct.prototype.ba=function(){this.B=null;const s=Date.now();0<=s-this.S?(Bh(this.i,this.A),this.L!=2&&(zn(),Ze(17)),Wt(this),this.s=2,qn(this)):aa(this,this.S-s)};function qn(s){s.j.G==0||s.J||Va(s.j,s)}function Wt(s){rs(s);var c=s.M;c&&typeof c.ma=="function"&&c.ma(),s.M=null,ie(s.U),s.g&&(c=s.g,s.g=null,c.abort(),c.ma())}function is(s,c){try{var f=s.j;if(f.G!=0&&(f.g==s||ss(f.h,s))){if(!s.K&&ss(f.h,s)&&f.G==3){try{var v=f.Da.g.parse(c)}catch{v=null}if(Array.isArray(v)&&v.length==3){var x=v;if(x[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<s.F)Fr(f),Mr(f);else break e;cs(f),Ze(18)}}else f.za=x[1],0<f.za-f.T&&37500>x[2]&&f.F&&f.v==0&&!f.C&&(f.C=jn(k(f.Za,f),6e3));if(1>=ua(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Qt(f,11)}else if((s.K||f.g==s)&&Fr(f),!$(c))for(x=f.Da.g.parse(c),c=0;c<x.length;c++){let he=x[c];if(f.T=he[0],he=he[1],f.G==2)if(he[0]=="c"){f.K=he[1],f.ia=he[2];const Ke=he[3];Ke!=null&&(f.la=Ke,f.j.info("VER="+f.la));const Qe=he[4];Qe!=null&&(f.Aa=Qe,f.j.info("SVER="+f.Aa));const mn=he[5];mn!=null&&typeof mn=="number"&&0<mn&&(v=1.5*mn,f.L=v,f.j.info("backChannelRequestTimeoutMs_="+v)),v=f;const ct=s.g;if(ct){const zr=ct.g?ct.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(zr){var V=v.h;V.g||zr.indexOf("spdy")==-1&&zr.indexOf("quic")==-1&&zr.indexOf("h2")==-1||(V.j=V.l,V.g=new Set,V.h&&(os(V,V.h),V.h=null))}if(v.D){const hs=ct.g?ct.g.getResponseHeader("X-HTTP-Session-Id"):null;hs&&(v.ya=hs,Te(v.I,v.D,hs))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-s.F,f.j.info("Handshake RTT: "+f.R+"ms")),v=f;var j=s;if(v.qa=La(v,v.J?v.ia:null,v.W),j.K){ha(v.h,j);var pe=j,$e=v.L;$e&&(pe.I=$e),pe.B&&(rs(pe),xr(pe)),v.g=j}else Pa(v);0<f.i.length&&Or(f)}else he[0]!="stop"&&he[0]!="close"||Qt(f,7);else f.G==3&&(he[0]=="stop"||he[0]=="close"?he[0]=="stop"?Qt(f,7):ls(f):he[0]!="noop"&&f.l&&f.l.ta(he),f.v=0)}}zn(4)}catch{}}var Mh=class{constructor(s,c){this.g=s,this.map=c}};function la(s){this.l=s||10,l.PerformanceNavigationTiming?(s=l.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ca(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function ua(s){return s.h?1:s.g?s.g.size:0}function ss(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function os(s,c){s.g?s.g.add(c):s.h=c}function ha(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}la.prototype.cancel=function(){if(this.i=da(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const s of this.g.values())s.cancel();this.g.clear()}};function da(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let c=s.i;for(const f of s.g.values())c=c.concat(f.D);return c}return B(s.i)}function Oh(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(d(s)){for(var c=[],f=s.length,v=0;v<f;v++)c.push(s[v]);return c}c=[],f=0;for(v in s)c[f++]=s[v];return c}function Fh(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(d(s)||typeof s=="string"){var c=[];s=s.length;for(var f=0;f<s;f++)c.push(f);return c}c=[],f=0;for(const v in s)c[f++]=v;return c}}}function fa(s,c){if(s.forEach&&typeof s.forEach=="function")s.forEach(c,void 0);else if(d(s)||typeof s=="string")Array.prototype.forEach.call(s,c,void 0);else for(var f=Fh(s),v=Oh(s),x=v.length,V=0;V<x;V++)c.call(void 0,v[V],f&&f[V],s)}var ma=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Uh(s,c){if(s){s=s.split("&");for(var f=0;f<s.length;f++){var v=s[f].indexOf("="),x=null;if(0<=v){var V=s[f].substring(0,v);x=s[f].substring(v+1)}else V=s[f];c(V,x?decodeURIComponent(x.replace(/\+/g," ")):"")}}}function Kt(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof Kt){this.h=s.h,Pr(this,s.j),this.o=s.o,this.g=s.g,Dr(this,s.s),this.l=s.l;var c=s.i,f=new Wn;f.i=c.i,c.g&&(f.g=new Map(c.g),f.h=c.h),pa(this,f),this.m=s.m}else s&&(c=String(s).match(ma))?(this.h=!1,Pr(this,c[1]||"",!0),this.o=Hn(c[2]||""),this.g=Hn(c[3]||"",!0),Dr(this,c[4]),this.l=Hn(c[5]||"",!0),pa(this,c[6]||"",!0),this.m=Hn(c[7]||"")):(this.h=!1,this.i=new Wn(null,this.h))}Kt.prototype.toString=function(){var s=[],c=this.j;c&&s.push(Gn(c,ga,!0),":");var f=this.g;return(f||c=="file")&&(s.push("//"),(c=this.o)&&s.push(Gn(c,ga,!0),"@"),s.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&s.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&s.push("/"),s.push(Gn(f,f.charAt(0)=="/"?$h:jh,!0))),(f=this.i.toString())&&s.push("?",f),(f=this.m)&&s.push("#",Gn(f,Hh)),s.join("")};function Et(s){return new Kt(s)}function Pr(s,c,f){s.j=f?Hn(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function Dr(s,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);s.s=c}else s.s=null}function pa(s,c,f){c instanceof Wn?(s.i=c,Gh(s.i,s.h)):(f||(c=Gn(c,qh)),s.i=new Wn(c,s.h))}function Te(s,c,f){s.i.set(c,f)}function Vr(s){return Te(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function Hn(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Gn(s,c,f){return typeof s=="string"?(s=encodeURI(s).replace(c,zh),f&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function zh(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var ga=/[#\/\?@]/g,jh=/[#\?:]/g,$h=/[#\?]/g,qh=/[#\?@]/g,Hh=/#/g;function Wn(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function St(s){s.g||(s.g=new Map,s.h=0,s.i&&Uh(s.i,function(c,f){s.add(decodeURIComponent(c.replace(/\+/g," ")),f)}))}n=Wn.prototype,n.add=function(s,c){St(this),this.i=null,s=dn(this,s);var f=this.g.get(s);return f||this.g.set(s,f=[]),f.push(c),this.h+=1,this};function ya(s,c){St(s),c=dn(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function _a(s,c){return St(s),c=dn(s,c),s.g.has(c)}n.forEach=function(s,c){St(this),this.g.forEach(function(f,v){f.forEach(function(x){s.call(c,x,v,this)},this)},this)},n.na=function(){St(this);const s=Array.from(this.g.values()),c=Array.from(this.g.keys()),f=[];for(let v=0;v<c.length;v++){const x=s[v];for(let V=0;V<x.length;V++)f.push(c[v])}return f},n.V=function(s){St(this);let c=[];if(typeof s=="string")_a(this,s)&&(c=c.concat(this.g.get(dn(this,s))));else{s=Array.from(this.g.values());for(let f=0;f<s.length;f++)c=c.concat(s[f])}return c},n.set=function(s,c){return St(this),this.i=null,s=dn(this,s),_a(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=this.V(s),0<s.length?String(s[0]):c):c};function va(s,c,f){ya(s,c),0<f.length&&(s.i=null,s.g.set(dn(s,c),B(f)),s.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const s=[],c=Array.from(this.g.keys());for(var f=0;f<c.length;f++){var v=c[f];const V=encodeURIComponent(String(v)),j=this.V(v);for(v=0;v<j.length;v++){var x=V;j[v]!==""&&(x+="="+encodeURIComponent(String(j[v]))),s.push(x)}}return this.i=s.join("&")};function dn(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Gh(s,c){c&&!s.j&&(St(s),s.i=null,s.g.forEach(function(f,v){var x=v.toLowerCase();v!=x&&(ya(this,v),va(this,x,f))},s)),s.j=c}function Wh(s,c){const f=new $n;if(l.Image){const v=new Image;v.onload=S(kt,f,"TestLoadImage: loaded",!0,c,v),v.onerror=S(kt,f,"TestLoadImage: error",!1,c,v),v.onabort=S(kt,f,"TestLoadImage: abort",!1,c,v),v.ontimeout=S(kt,f,"TestLoadImage: timeout",!1,c,v),l.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=s}else c(!1)}function Kh(s,c){const f=new $n,v=new AbortController,x=setTimeout(()=>{v.abort(),kt(f,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:v.signal}).then(V=>{clearTimeout(x),V.ok?kt(f,"TestPingServer: ok",!0,c):kt(f,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(x),kt(f,"TestPingServer: error",!1,c)})}function kt(s,c,f,v,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),v(f)}catch{}}function Qh(){this.g=new be}function Xh(s,c,f){const v=f||"";try{fa(s,function(x,V){let j=x;m(x)&&(j=_e(x)),c.push(v+V+"="+encodeURIComponent(j))})}catch(x){throw c.push(v+"type="+encodeURIComponent("_badmap")),x}}function Br(s){this.l=s.Ub||null,this.j=s.eb||!1}P(Br,fe),Br.prototype.g=function(){return new Nr(this.l,this.j)},Br.prototype.i=function(s){return function(){return s}}({});function Nr(s,c){Ue.call(this),this.D=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}P(Nr,Ue),n=Nr.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=c,this.readyState=1,Qn(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(c.body=s),(this.D||l).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Kn(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Qn(this)),this.g&&(this.readyState=3,Qn(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ea(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ea(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?Kn(this):Qn(this),this.readyState==3&&Ea(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,Kn(this))},n.Qa=function(s){this.g&&(this.response=s,Kn(this))},n.ga=function(){this.g&&Kn(this)};function Kn(s){s.readyState=4,s.l=null,s.j=null,s.v=null,Qn(s)}n.setRequestHeader=function(s,c){this.u.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const s=[],c=this.h.entries();for(var f=c.next();!f.done;)f=f.value,s.push(f[0]+": "+f[1]),f=c.next();return s.join(`\r
`)};function Qn(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Nr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Ta(s){let c="";return U(s,function(f,v){c+=v,c+=":",c+=f,c+=`\r
`}),c}function as(s,c,f){e:{for(v in f){var v=!1;break e}v=!0}v||(f=Ta(f),typeof s=="string"?f!=null&&encodeURIComponent(String(f)):Te(s,c,f))}function Re(s){Ue.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}P(Re,Ue);var Yh=/^https?$/i,Jh=["POST","PUT"];n=Re.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,c,f,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():es.g(),this.v=this.o?Xo(this.o):Xo(es),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(V){wa(this,V);return}if(s=f||"",f=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var x in v)f.set(x,v[x]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(const V of v.keys())f.set(V,v.get(V));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(f.keys()).find(V=>V.toLowerCase()=="content-type"),x=l.FormData&&s instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Jh,c,void 0))||v||x||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[V,j]of f)this.g.setRequestHeader(V,j);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Aa(this),this.u=!0,this.g.send(s),this.u=!1}catch(V){wa(this,V)}};function wa(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.m=5,Ia(s),Lr(s)}function Ia(s){s.A||(s.A=!0,p(s,"complete"),p(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,p(this,"complete"),p(this,"abort"),Lr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Lr(this,!0)),Re.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ba(this):this.bb())},n.bb=function(){ba(this)};function ba(s){if(s.h&&typeof a<"u"&&(!s.v[1]||Tt(s)!=4||s.Z()!=2)){if(s.u&&Tt(s)==4)h(s.Ea,0,s);else if(p(s,"readystatechange"),Tt(s)==4){s.h=!1;try{const j=s.Z();e:switch(j){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var f;if(!(f=c)){var v;if(v=j===0){var x=String(s.D).match(ma)[1]||null;!x&&l.self&&l.self.location&&(x=l.self.location.protocol.slice(0,-1)),v=!Yh.test(x?x.toLowerCase():"")}f=v}if(f)p(s,"complete"),p(s,"success");else{s.m=6;try{var V=2<Tt(s)?s.g.statusText:""}catch{V=""}s.l=V+" ["+s.Z()+"]",Ia(s)}}finally{Lr(s)}}}}function Lr(s,c){if(s.g){Aa(s);const f=s.g,v=s.v[0]?()=>{}:null;s.g=null,s.v=null,c||p(s,"ready");try{f.onreadystatechange=v}catch{}}}function Aa(s){s.I&&(l.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function Tt(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<Tt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),ve(c)}};function Ca(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Zh(s){const c={};s=(s.g&&2<=Tt(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<s.length;v++){if($(s[v]))continue;var f=w(s[v]);const x=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const V=c[x]||[];c[x]=V,V.push(f)}b(c,function(v){return v.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xn(s,c,f){return f&&f.internalChannelParams&&f.internalChannelParams[s]||c}function Sa(s){this.Aa=0,this.i=[],this.j=new $n,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xn("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xn("baseRetryDelayMs",5e3,s),this.cb=Xn("retryDelaySeedMs",1e4,s),this.Wa=Xn("forwardChannelMaxRetries",2,s),this.wa=Xn("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new la(s&&s.concurrentRequestLimit),this.Da=new Qh,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Sa.prototype,n.la=8,n.G=1,n.connect=function(s,c,f,v){Ze(0),this.W=s,this.H=c||{},f&&v!==void 0&&(this.H.OSID=f,this.H.OAID=v),this.F=this.X,this.I=La(this,null,this.W),Or(this)};function ls(s){if(ka(s),s.G==3){var c=s.U++,f=Et(s.I);if(Te(f,"SID",s.K),Te(f,"RID",c),Te(f,"TYPE","terminate"),Yn(s,f),c=new Ct(s,s.j,c),c.L=2,c.v=Vr(Et(f)),f=!1,l.navigator&&l.navigator.sendBeacon)try{f=l.navigator.sendBeacon(c.v.toString(),"")}catch{}!f&&l.Image&&(new Image().src=c.v,f=!0),f||(c.g=Ma(c.j,null),c.g.ea(c.v)),c.F=Date.now(),xr(c)}Na(s)}function Mr(s){s.g&&(us(s),s.g.cancel(),s.g=null)}function ka(s){Mr(s),s.u&&(l.clearTimeout(s.u),s.u=null),Fr(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&l.clearTimeout(s.s),s.s=null)}function Or(s){if(!ca(s.h)&&!s.s){s.s=!0;var c=s.Ga;Ee||st(),Ie||(Ee(),Ie=!0),je.add(c,s),s.B=0}}function ed(s,c){return ua(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=c.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=jn(k(s.Ga,s,c),Ba(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;const x=new Ct(this,this.j,s);let V=this.o;if(this.S&&(V?(V=g(V),_(V,this.S)):V=this.S),this.m!==null||this.O||(x.H=V,V=null),this.P)e:{for(var c=0,f=0;f<this.i.length;f++){t:{var v=this.i[f];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(c+=v,4096<c){c=f;break e}if(c===4096||f===this.i.length-1){c=f+1;break e}}c=1e3}else c=1e3;c=xa(this,x,c),f=Et(this.I),Te(f,"RID",s),Te(f,"CVER",22),this.D&&Te(f,"X-HTTP-Session-Id",this.D),Yn(this,f),V&&(this.O?c="headers="+encodeURIComponent(String(Ta(V)))+"&"+c:this.m&&as(f,this.m,V)),os(this.h,x),this.Ua&&Te(f,"TYPE","init"),this.P?(Te(f,"$req",c),Te(f,"SID","null"),x.T=!0,ns(x,f,null)):ns(x,f,c),this.G=2}}else this.G==3&&(s?Ra(this,s):this.i.length==0||ca(this.h)||Ra(this))};function Ra(s,c){var f;c?f=c.l:f=s.U++;const v=Et(s.I);Te(v,"SID",s.K),Te(v,"RID",f),Te(v,"AID",s.T),Yn(s,v),s.m&&s.o&&as(v,s.m,s.o),f=new Ct(s,s.j,f,s.B+1),s.m===null&&(f.H=s.o),c&&(s.i=c.D.concat(s.i)),c=xa(s,f,1e3),f.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),os(s.h,f),ns(f,v,c)}function Yn(s,c){s.H&&U(s.H,function(f,v){Te(c,v,f)}),s.l&&fa({},function(f,v){Te(c,v,f)})}function xa(s,c,f){f=Math.min(s.i.length,f);var v=s.l?k(s.l.Na,s.l,s):null;e:{var x=s.i;let V=-1;for(;;){const j=["count="+f];V==-1?0<f?(V=x[0].g,j.push("ofs="+V)):V=0:j.push("ofs="+V);let pe=!0;for(let $e=0;$e<f;$e++){let he=x[$e].g;const Ke=x[$e].map;if(he-=V,0>he)V=Math.max(0,x[$e].g-100),pe=!1;else try{Xh(Ke,j,"req"+he+"_")}catch{v&&v(Ke)}}if(pe){v=j.join("&");break e}}}return s=s.i.splice(0,f),c.D=s,v}function Pa(s){if(!s.g&&!s.u){s.Y=1;var c=s.Fa;Ee||st(),Ie||(Ee(),Ie=!0),je.add(c,s),s.v=0}}function cs(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=jn(k(s.Fa,s),Ba(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,Da(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=jn(k(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ze(10),Mr(this),Da(this))};function us(s){s.A!=null&&(l.clearTimeout(s.A),s.A=null)}function Da(s){s.g=new Ct(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var c=Et(s.qa);Te(c,"RID","rpc"),Te(c,"SID",s.K),Te(c,"AID",s.T),Te(c,"CI",s.F?"0":"1"),!s.F&&s.ja&&Te(c,"TO",s.ja),Te(c,"TYPE","xmlhttp"),Yn(s,c),s.m&&s.o&&as(c,s.m,s.o),s.L&&(s.g.I=s.L);var f=s.g;s=s.ia,f.L=1,f.v=Vr(Et(c)),f.m=null,f.P=!0,sa(f,s)}n.Za=function(){this.C!=null&&(this.C=null,Mr(this),cs(this),Ze(19))};function Fr(s){s.C!=null&&(l.clearTimeout(s.C),s.C=null)}function Va(s,c){var f=null;if(s.g==c){Fr(s),us(s),s.g=null;var v=2}else if(ss(s.h,c))f=c.D,ha(s.h,c),v=1;else return;if(s.G!=0){if(c.o)if(v==1){f=c.m?c.m.length:0,c=Date.now()-c.F;var x=s.B;v=Sr(),p(v,new ta(v,f)),Or(s)}else Pa(s);else if(x=c.s,x==3||x==0&&0<c.X||!(v==1&&ed(s,c)||v==2&&cs(s)))switch(f&&0<f.length&&(c=s.h,c.i=c.i.concat(f)),x){case 1:Qt(s,5);break;case 4:Qt(s,10);break;case 3:Qt(s,6);break;default:Qt(s,2)}}}function Ba(s,c){let f=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(f*=2),f*c}function Qt(s,c){if(s.j.info("Error code "+c),c==2){var f=k(s.fb,s),v=s.Xa;const x=!v;v=new Kt(v||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Pr(v,"https"),Vr(v),x?Wh(v.toString(),f):Kh(v.toString(),f)}else Ze(2);s.G=0,s.l&&s.l.sa(c),Na(s),ka(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))};function Na(s){if(s.G=0,s.ka=[],s.l){const c=da(s.h);(c.length!=0||s.i.length!=0)&&(O(s.ka,c),O(s.ka,s.i),s.h.i.length=0,B(s.i),s.i.length=0),s.l.ra()}}function La(s,c,f){var v=f instanceof Kt?Et(f):new Kt(f);if(v.g!="")c&&(v.g=c+"."+v.g),Dr(v,v.s);else{var x=l.location;v=x.protocol,c=c?c+"."+x.hostname:x.hostname,x=+x.port;var V=new Kt(null);v&&Pr(V,v),c&&(V.g=c),x&&Dr(V,x),f&&(V.l=f),v=V}return f=s.D,c=s.ya,f&&c&&Te(v,f,c),Te(v,"VER",s.la),Yn(s,v),v}function Ma(s,c,f){if(c&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Ca&&!s.pa?new Re(new Br({eb:f})):new Re(s.pa),c.Ha(s.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Oa(){}n=Oa.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ur(){}Ur.prototype.g=function(s,c){return new nt(s,c)};function nt(s,c){Ue.call(this),this.g=new Sa(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(s?s["X-WebChannel-Client-Profile"]=c.va:s={"X-WebChannel-Client-Profile":c.va}),this.g.S=s,(s=c&&c.Sb)&&!$(s)&&(this.g.m=s),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!$(c)&&(this.g.D=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new fn(this)}P(nt,Ue),nt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},nt.prototype.close=function(){ls(this.g)},nt.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var f={};f.__data__=s,s=f}else this.u&&(f={},f.__data__=_e(s),s=f);c.i.push(new Mh(c.Ya++,s)),c.G==3&&Or(c)},nt.prototype.N=function(){this.g.l=null,delete this.j,ls(this.g),delete this.g,nt.aa.N.call(this)};function Fa(s){Ji.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(const f in c){s=f;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}P(Fa,Ji);function Ua(){Zi.call(this),this.status=1}P(Ua,Zi);function fn(s){this.g=s}P(fn,Oa),fn.prototype.ua=function(){p(this.g,"a")},fn.prototype.ta=function(s){p(this.g,new Fa(s))},fn.prototype.sa=function(s){p(this.g,new Ua)},fn.prototype.ra=function(){p(this.g,"b")},Ur.prototype.createWebChannel=Ur.prototype.g,nt.prototype.send=nt.prototype.o,nt.prototype.open=nt.prototype.m,nt.prototype.close=nt.prototype.close,Hc=function(){return new Ur},qc=function(){return Sr()},$c=Gt,Vs={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},kr.NO_ERROR=0,kr.TIMEOUT=8,kr.HTTP_ERROR=6,Zr=kr,na.COMPLETE="complete",jc=na,Yo.EventType=Un,Un.OPEN="a",Un.CLOSE="b",Un.ERROR="c",Un.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,er=Yo,Re.prototype.listenOnce=Re.prototype.L,Re.prototype.getLastError=Re.prototype.Ka,Re.prototype.getLastErrorCode=Re.prototype.Ba,Re.prototype.getStatus=Re.prototype.Z,Re.prototype.getResponseJson=Re.prototype.Oa,Re.prototype.getResponseText=Re.prototype.oa,Re.prototype.send=Re.prototype.ea,Re.prototype.setWithCredentials=Re.prototype.Ha,zc=Re}).apply(typeof jr<"u"?jr:typeof self<"u"?self:typeof window<"u"?window:{});const tl="@firebase/firestore",nl="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ye.UNAUTHENTICATED=new Ye(null),Ye.GOOGLE_CREDENTIALS=new Ye("google-credentials-uid"),Ye.FIRST_PARTY=new Ye("first-party-uid"),Ye.MOCK_USER=new Ye("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nn="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tn=new Bc("@firebase/firestore");function yn(){return tn.logLevel}function H(n,...e){if(tn.logLevel<=ce.DEBUG){const t=e.map(yo);tn.debug(`Firestore (${Nn}): ${n}`,...t)}}function bt(n,...e){if(tn.logLevel<=ce.ERROR){const t=e.map(yo);tn.error(`Firestore (${Nn}): ${n}`,...t)}}function An(n,...e){if(tn.logLevel<=ce.WARN){const t=e.map(yo);tn.warn(`Firestore (${Nn}): ${n}`,...t)}}function yo(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Gc(n,r,t)}function Gc(n,e,t){let r=`FIRESTORE (${Nn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw bt(r),new Error(r)}function me(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Gc(e,i,r)}function ne(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends Bn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class um{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ye.UNAUTHENTICATED))}shutdown(){}}class hm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class dm{constructor(e){this.t=e,this.currentUser=Ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){me(this.o===void 0,42304);let r=this.i;const i=d=>this.i!==r?(r=this.i,t(d)):Promise.resolve();let o=new Mt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Mt,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const d=o;e.enqueueRetryable(async()=>{await d.promise,await i(this.currentUser)})},l=d=>{H("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(d=>l(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?l(d):(H("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Mt)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(H("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(me(typeof r.accessToken=="string",31837,{l:r}),new Wc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return me(e===null||typeof e=="string",2055,{h:e}),new Ye(e)}}class fm{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Ye.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class mm{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new fm(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class pm{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Wf(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){me(this.o===void 0,3512);const r=o=>{o.error!=null&&H("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,H("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const i=o=>{H("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?i(o):H("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new rl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new rl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gm(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kc(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=gm(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}}function se(n,e){return n<e?-1:n>e?1:0}function Bs(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return se(r,i);{const o=Kc(),a=ym(o.encode(il(n,t)),o.encode(il(e,t)));return a!==0?a:se(r,i)}}t+=r>65535?2:1}return se(n.length,e.length)}function il(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function ym(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return se(n[t],e[t]);return se(n.length,e.length)}function Cn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl=-62135596800,ol=1e6;class Le{static now(){return Le.fromMillis(Date.now())}static fromDate(e){return Le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ol);return new Le(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new W(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new W(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<sl)throw new W(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new W(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ol}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-sl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{static fromTimestamp(e){return new ee(e)}static min(){return new ee(new Le(0,0))}static max(){return new ee(new Le(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al="__name__";class ft{constructor(e,t,r){t===void 0?t=0:t>e.length&&X(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&X(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ft.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ft?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=ft.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return se(e.length,t.length)}static compareSegments(e,t){const r=ft.isNumericId(e),i=ft.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?ft.extractNumericId(e).compare(ft.extractNumericId(t)):Bs(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Lt.fromString(e.substring(4,e.length-2))}}class Ae extends ft{construct(e,t,r){return new Ae(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new W(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Ae(t)}static emptyPath(){return new Ae([])}}const _m=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class He extends ft{construct(e,t,r){return new He(e,t,r)}static isValidIdentifier(e){return _m.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),He.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===al}static keyField(){return new He([al])}static fromServerFormat(e){const t=[];let r="",i=0;const o=()=>{if(r.length===0)throw new W(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new W(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new W(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(o(),i++)}if(o(),a)throw new W(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new He(t)}static emptyPath(){return new He([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.path=e}static fromPath(e){return new K(Ae.fromString(e))}static fromName(e){return new K(Ae.fromString(e).popFirst(5))}static empty(){return new K(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new Ae(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yr=-1;function vm(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ee.fromTimestamp(r===1e9?new Le(t+1,0):new Le(t,r));return new Ft(i,K.empty(),e)}function Em(n){return new Ft(n.readTime,n.key,yr)}class Ft{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ft(ee.min(),K.empty(),yr)}static max(){return new Ft(ee.max(),K.empty(),yr)}}function Tm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=K.comparator(n.documentKey,e.documentKey),t!==0?t:se(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Im{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ln(n){if(n.code!==z.FAILED_PRECONDITION||n.message!==wm)throw n;H("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new F((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof F?t:F.resolve(t)}catch(t){return F.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):F.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):F.reject(t)}static resolve(e){return new F((t,r)=>{t(e)})}static reject(e){return new F((t,r)=>{r(e)})}static waitFor(e){return new F((t,r)=>{let i=0,o=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++o,a&&o===i&&t()},d=>r(d))}),a=!0,o===i&&t()})}static or(e){let t=F.resolve(!1);for(const r of e)t=t.next(i=>i?F.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new F((r,i)=>{const o=e.length,a=new Array(o);let l=0;for(let d=0;d<o;d++){const m=d;t(e[m]).next(y=>{a[m]=y,++l,l===o&&r(a)},y=>i(y))}})}static doWhile(e,t){return new F((r,i)=>{const o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}}function bm(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Mn(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ue(r),this.ce=r=>t.writeSequenceNumber(r))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Mi.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _o=-1;function Oi(n){return n==null}function vi(n){return n===0&&1/n==-1/0}function Am(n){return typeof n=="number"&&Number.isInteger(n)&&!vi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xc="";function Cm(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ll(e)),e=Sm(n.get(t),e);return ll(e)}function Sm(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const o=n.charAt(i);switch(o){case"\0":t+="";break;case Xc:t+="";break;default:t+=o}}return t}function ll(n){return n+Xc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function on(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Yc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e,t){this.comparator=e,this.root=t||qe.EMPTY}insert(e,t){return new Se(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qe.BLACK,null,null))}remove(e){return new Se(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $r(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $r(this.root,e,this.comparator,!1)}getReverseIterator(){return new $r(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $r(this.root,e,this.comparator,!0)}}class $r{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qe{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??qe.RED,this.left=i??qe.EMPTY,this.right=o??qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new qe(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return qe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return qe.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw X(43730,{key:this.key,value:this.value});if(this.right.isRed())throw X(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw X(27949);return e+(this.isRed()?0:1)}}qe.EMPTY=null,qe.RED=!0,qe.BLACK=!1;qe.EMPTY=new class{constructor(){this.size=0}get key(){throw X(57766)}get value(){throw X(16141)}get color(){throw X(16727)}get left(){throw X(29726)}get right(){throw X(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.comparator=e,this.data=new Se(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ul(this.data.getIterator())}getIteratorFrom(e){return new ul(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Me)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Me(this.comparator);return t.data=e,t}}class ul{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{constructor(e){this.fields=e,e.sort(He.comparator)}static empty(){return new ut([])}unionWith(e){let t=new Me(He.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ut(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Cn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ge{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Jc("Invalid base64 string: "+o):o}}(e);return new Ge(t)}static fromUint8Array(e){const t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new Ge(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ge.EMPTY_BYTE_STRING=new Ge("");const km=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ut(n){if(me(!!n,39018),typeof n=="string"){let e=0;const t=km.exec(n);if(me(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Pe(n.seconds),nanos:Pe(n.nanos)}}function Pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function zt(n){return typeof n=="string"?Ge.fromBase64String(n):Ge.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc="server_timestamp",eu="__type__",tu="__previous_value__",nu="__local_write_time__";function vo(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[eu])===null||t===void 0?void 0:t.stringValue)===Zc}function Fi(n){const e=n.mapValue.fields[tu];return vo(e)?Fi(e):e}function _r(n){const e=Ut(n.mapValue.fields[nu].timestampValue);return new Le(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,t,r,i,o,a,l,d,m,y){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=m,this.isUsingEmulator=y}}const Ei="(default)";class vr{constructor(e,t){this.projectId=e,this.database=t||Ei}static empty(){return new vr("","")}get isDefaultDatabase(){return this.database===Ei}isEqual(e){return e instanceof vr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru="__type__",xm="__max__",qr={mapValue:{}},iu="__vector__",Ti="value";function jt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vo(n)?4:Dm(n)?9007199254740991:Pm(n)?10:11:X(28295,{value:n})}function yt(n,e){if(n===e)return!0;const t=jt(n);if(t!==jt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return _r(n).isEqual(_r(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;const a=Ut(i.timestampValue),l=Ut(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return zt(i.bytesValue).isEqual(zt(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return Pe(i.geoPointValue.latitude)===Pe(o.geoPointValue.latitude)&&Pe(i.geoPointValue.longitude)===Pe(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Pe(i.integerValue)===Pe(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){const a=Pe(i.doubleValue),l=Pe(o.doubleValue);return a===l?vi(a)===vi(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return Cn(n.arrayValue.values||[],e.arrayValue.values||[],yt);case 10:case 11:return function(i,o){const a=i.mapValue.fields||{},l=o.mapValue.fields||{};if(cl(a)!==cl(l))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(l[d]===void 0||!yt(a[d],l[d])))return!1;return!0}(n,e);default:return X(52216,{left:n})}}function Er(n,e){return(n.values||[]).find(t=>yt(t,e))!==void 0}function Sn(n,e){if(n===e)return 0;const t=jt(n),r=jt(e);if(t!==r)return se(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return function(o,a){const l=Pe(o.integerValue||o.doubleValue),d=Pe(a.integerValue||a.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1}(n,e);case 3:return hl(n.timestampValue,e.timestampValue);case 4:return hl(_r(n),_r(e));case 5:return Bs(n.stringValue,e.stringValue);case 6:return function(o,a){const l=zt(o),d=zt(a);return l.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){const l=o.split("/"),d=a.split("/");for(let m=0;m<l.length&&m<d.length;m++){const y=se(l[m],d[m]);if(y!==0)return y}return se(l.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){const l=se(Pe(o.latitude),Pe(a.latitude));return l!==0?l:se(Pe(o.longitude),Pe(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return dl(n.arrayValue,e.arrayValue);case 10:return function(o,a){var l,d,m,y;const A=o.fields||{},k=a.fields||{},S=(l=A[Ti])===null||l===void 0?void 0:l.arrayValue,P=(d=k[Ti])===null||d===void 0?void 0:d.arrayValue,B=se(((m=S?.values)===null||m===void 0?void 0:m.length)||0,((y=P?.values)===null||y===void 0?void 0:y.length)||0);return B!==0?B:dl(S,P)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===qr.mapValue&&a===qr.mapValue)return 0;if(o===qr.mapValue)return 1;if(a===qr.mapValue)return-1;const l=o.fields||{},d=Object.keys(l),m=a.fields||{},y=Object.keys(m);d.sort(),y.sort();for(let A=0;A<d.length&&A<y.length;++A){const k=Bs(d[A],y[A]);if(k!==0)return k;const S=Sn(l[d[A]],m[y[A]]);if(S!==0)return S}return se(d.length,y.length)}(n.mapValue,e.mapValue);default:throw X(23264,{Pe:t})}}function hl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return se(n,e);const t=Ut(n),r=Ut(e),i=se(t.seconds,r.seconds);return i!==0?i:se(t.nanos,r.nanos)}function dl(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const o=Sn(t[i],r[i]);if(o)return o}return se(t.length,r.length)}function kn(n){return Ns(n)}function Ns(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ut(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return zt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return K.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const o of t.values||[])i?i=!1:r+=",",r+=Ns(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",o=!0;for(const a of r)o?o=!1:i+=",",i+=`${a}:${Ns(t.fields[a])}`;return i+"}"}(n.mapValue):X(61005,{value:n})}function ei(n){switch(jt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Fi(n);return e?16+ei(e):16;case 5:return 2*n.stringValue.length;case 6:return zt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+ei(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return on(r.fields,(o,a)=>{i+=o.length+ei(a)}),i}(n.mapValue);default:throw X(13486,{value:n})}}function Ls(n){return!!n&&"integerValue"in n}function Eo(n){return!!n&&"arrayValue"in n}function fl(n){return!!n&&"nullValue"in n}function ml(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ti(n){return!!n&&"mapValue"in n}function Pm(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[ru])===null||t===void 0?void 0:t.stringValue)===iu}function ar(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return on(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ar(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ar(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Dm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===xm}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.value=e}static empty(){return new it({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ti(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ar(t)}setAll(e){let t=He.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=ar(a):i.push(l.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){const t=this.field(e.popLast());ti(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return yt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ti(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){on(t,(i,o)=>e[i]=o);for(const i of r)delete e[i]}clone(){return new it(ar(this.value))}}function su(n){const e=[];return on(n.fields,(t,r)=>{const i=new He([t]);if(ti(r)){const o=su(r.mapValue).fields;if(o.length===0)e.push(i);else for(const a of o)e.push(i.child(a))}else e.push(i)}),new ut(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Je{constructor(e,t,r,i,o,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Je(e,0,ee.min(),ee.min(),ee.min(),it.empty(),0)}static newFoundDocument(e,t,r,i){return new Je(e,1,t,ee.min(),r,i,0)}static newNoDocument(e,t){return new Je(e,2,t,ee.min(),ee.min(),it.empty(),0)}static newUnknownDocument(e,t){return new Je(e,3,t,ee.min(),ee.min(),it.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ee.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=it.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=it.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Je&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Je(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,t){this.position=e,this.inclusive=t}}function pl(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const o=e[i],a=n.position[i];if(o.field.isKeyField()?r=K.comparator(K.fromName(a.referenceValue),t.key):r=Sn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function gl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!yt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e,t="asc"){this.field=e,this.dir=t}}function Vm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{}class Ne extends ou{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Nm(e,t,r):t==="array-contains"?new Om(e,r):t==="in"?new Fm(e,r):t==="not-in"?new Um(e,r):t==="array-contains-any"?new zm(e,r):new Ne(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Lm(e,r):new Mm(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Sn(t,this.value)):t!==null&&jt(this.value)===jt(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return X(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class _t extends ou{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new _t(e,t)}matches(e){return au(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function au(n){return n.op==="and"}function lu(n){return Bm(n)&&au(n)}function Bm(n){for(const e of n.filters)if(e instanceof _t)return!1;return!0}function Ms(n){if(n instanceof Ne)return n.field.canonicalString()+n.op.toString()+kn(n.value);if(lu(n))return n.filters.map(e=>Ms(e)).join(",");{const e=n.filters.map(t=>Ms(t)).join(",");return`${n.op}(${e})`}}function cu(n,e){return n instanceof Ne?function(r,i){return i instanceof Ne&&r.op===i.op&&r.field.isEqual(i.field)&&yt(r.value,i.value)}(n,e):n instanceof _t?function(r,i){return i instanceof _t&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,l)=>o&&cu(a,i.filters[l]),!0):!1}(n,e):void X(19439)}function uu(n){return n instanceof Ne?function(t){return`${t.field.canonicalString()} ${t.op} ${kn(t.value)}`}(n):n instanceof _t?function(t){return t.op.toString()+" {"+t.getFilters().map(uu).join(" ,")+"}"}(n):"Filter"}class Nm extends Ne{constructor(e,t,r){super(e,t,r),this.key=K.fromName(r.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class Lm extends Ne{constructor(e,t){super(e,"in",t),this.keys=hu("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Mm extends Ne{constructor(e,t){super(e,"not-in",t),this.keys=hu("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function hu(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>K.fromName(r.referenceValue))}class Om extends Ne{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Eo(t)&&Er(t.arrayValue,this.value)}}class Fm extends Ne{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Er(this.value.arrayValue,t)}}class Um extends Ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(Er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Er(this.value.arrayValue,t)}}class zm extends Ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Eo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Er(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e,t=null,r=[],i=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=l,this.Ie=null}}function yl(n,e=null,t=[],r=[],i=null,o=null,a=null){return new jm(n,e,t,r,i,o,a)}function To(n){const e=ne(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ms(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),Oi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>kn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>kn(r)).join(",")),e.Ie=t}return e.Ie}function wo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Vm(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!cu(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!gl(n.startAt,e.startAt)&&gl(n.endAt,e.endAt)}function Os(n){return K.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(e,t=null,r=[],i=[],o=null,a="F",l=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=d,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function $m(n,e,t,r,i,o,a,l){return new Ui(n,e,t,r,i,o,a,l)}function zi(n){return new Ui(n)}function _l(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function qm(n){return n.collectionGroup!==null}function lr(n){const e=ne(n);if(e.Ee===null){e.Ee=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ee.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Me(He.comparator);return a.filters.forEach(d=>{d.getFlattenedFilters().forEach(m=>{m.isInequality()&&(l=l.add(m.field))})}),l})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ee.push(new Ii(o,r))}),t.has(He.keyField().canonicalString())||e.Ee.push(new Ii(He.keyField(),r))}return e.Ee}function mt(n){const e=ne(n);return e.de||(e.de=Hm(e,lr(n))),e.de}function Hm(n,e){if(n.limitType==="F")return yl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const o=i.dir==="desc"?"asc":"desc";return new Ii(i.field,o)});const t=n.endAt?new wi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new wi(n.startAt.position,n.startAt.inclusive):null;return yl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Fs(n,e,t){return new Ui(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ji(n,e){return wo(mt(n),mt(e))&&n.limitType===e.limitType}function du(n){return`${To(mt(n))}|lt:${n.limitType}`}function _n(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>uu(i)).join(", ")}]`),Oi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>kn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>kn(i)).join(",")),`Target(${r})`}(mt(n))}; limitType=${n.limitType})`}function $i(n,e){return e.isFoundDocument()&&function(r,i){const o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):K.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(const o of lr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,l,d){const m=pl(a,l,d);return a.inclusive?m<=0:m<0}(r.startAt,lr(r),i)||r.endAt&&!function(a,l,d){const m=pl(a,l,d);return a.inclusive?m>=0:m>0}(r.endAt,lr(r),i))}(n,e)}function Gm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fu(n){return(e,t)=>{let r=!1;for(const i of lr(n)){const o=Wm(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function Wm(n,e,t){const r=n.field.isKeyField()?K.comparator(e.key,t.key):function(o,a,l){const d=a.data.field(o),m=l.data.field(o);return d!==null&&m!==null?Sn(d,m):X(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return X(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){on(this.inner,(t,r)=>{for(const[i,o]of r)e(i,o)})}isEmpty(){return Yc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km=new Se(K.comparator);function At(){return Km}const mu=new Se(K.comparator);function tr(...n){let e=mu;for(const t of n)e=e.insert(t.key,t);return e}function pu(n){let e=mu;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Zt(){return cr()}function gu(){return cr()}function cr(){return new an(n=>n.toString(),(n,e)=>n.isEqual(e))}const Qm=new Se(K.comparator),Xm=new Me(K.comparator);function oe(...n){let e=Xm;for(const t of n)e=e.add(t);return e}const Ym=new Me(se);function Jm(){return Ym}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(e)?"-0":e}}function yu(n){return{integerValue:""+n}}function Zm(n,e){return Am(e)?yu(e):Io(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(){this._=void 0}}function ep(n,e,t){return n instanceof bi?function(i,o){const a={fields:{[eu]:{stringValue:Zc},[nu]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&vo(o)&&(o=Fi(o)),o&&(a.fields[tu]=o),{mapValue:a}}(t,e):n instanceof Tr?vu(n,e):n instanceof wr?Eu(n,e):function(i,o){const a=_u(i,o),l=vl(a)+vl(i.Re);return Ls(a)&&Ls(i.Re)?yu(l):Io(i.serializer,l)}(n,e)}function tp(n,e,t){return n instanceof Tr?vu(n,e):n instanceof wr?Eu(n,e):t}function _u(n,e){return n instanceof Ai?function(r){return Ls(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class bi extends qi{}class Tr extends qi{constructor(e){super(),this.elements=e}}function vu(n,e){const t=Tu(e);for(const r of n.elements)t.some(i=>yt(i,r))||t.push(r);return{arrayValue:{values:t}}}class wr extends qi{constructor(e){super(),this.elements=e}}function Eu(n,e){let t=Tu(e);for(const r of n.elements)t=t.filter(i=>!yt(i,r));return{arrayValue:{values:t}}}class Ai extends qi{constructor(e,t){super(),this.serializer=e,this.Re=t}}function vl(n){return Pe(n.integerValue||n.doubleValue)}function Tu(n){return Eo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function np(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Tr&&i instanceof Tr||r instanceof wr&&i instanceof wr?Cn(r.elements,i.elements,yt):r instanceof Ai&&i instanceof Ai?yt(r.Re,i.Re):r instanceof bi&&i instanceof bi}(n.transform,e.transform)}class rp{constructor(e,t){this.version=e,this.transformResults=t}}class pt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new pt}static exists(e){return new pt(void 0,e)}static updateTime(e){return new pt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ni(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Hi{}function wu(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new bo(n.key,pt.none()):new Ir(n.key,n.data,pt.none());{const t=n.data,r=it.empty();let i=new Me(He.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new ln(n.key,r,new ut(i.toArray()),pt.none())}}function ip(n,e,t){n instanceof Ir?function(i,o,a){const l=i.value.clone(),d=Tl(i.fieldTransforms,o,a.transformResults);l.setAll(d),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof ln?function(i,o,a){if(!ni(i.precondition,o))return void o.convertToUnknownDocument(a.version);const l=Tl(i.fieldTransforms,o,a.transformResults),d=o.data;d.setAll(Iu(i)),d.setAll(l),o.convertToFoundDocument(a.version,d).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function ur(n,e,t,r){return n instanceof Ir?function(o,a,l,d){if(!ni(o.precondition,a))return l;const m=o.value.clone(),y=wl(o.fieldTransforms,d,a);return m.setAll(y),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null}(n,e,t,r):n instanceof ln?function(o,a,l,d){if(!ni(o.precondition,a))return l;const m=wl(o.fieldTransforms,d,a),y=a.data;return y.setAll(Iu(o)),y.setAll(m),a.convertToFoundDocument(a.version,y).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(A=>A.field))}(n,e,t,r):function(o,a,l){return ni(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function sp(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),o=_u(r.transform,i||null);o!=null&&(t===null&&(t=it.empty()),t.set(r.field,o))}return t||null}function El(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Cn(r,i,(o,a)=>np(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ir extends Hi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ln extends Hi{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Iu(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Tl(n,e,t){const r=new Map;me(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let i=0;i<t.length;i++){const o=n[i],a=o.transform,l=e.data.field(o.field);r.set(o.field,tp(a,l,t[i]))}return r}function wl(n,e,t){const r=new Map;for(const i of n){const o=i.transform,a=t.data.field(i.field);r.set(i.field,ep(o,a,e))}return r}class bo extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class op extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const o=this.mutations[i];o.key.isEqual(e.key)&&ip(o,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ur(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ur(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=gu();return this.mutations.forEach(i=>{const o=e.get(i.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=t.has(i.key)?null:l;const d=wu(a,l);d!==null&&r.set(i.key,d),a.isValidDocument()||a.convertToNoDocument(ee.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oe())}isEqual(e){return this.batchId===e.batchId&&Cn(this.mutations,e.mutations,(t,r)=>El(t,r))&&Cn(this.baseMutations,e.baseMutations,(t,r)=>El(t,r))}}class Ao{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){me(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let i=function(){return Qm}();const o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new Ao(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var De,le;function up(n){switch(n){case z.OK:return X(64938);case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0;default:return X(15467,{code:n})}}function bu(n){if(n===void 0)return bt("GRPC error has no .code"),z.UNKNOWN;switch(n){case De.OK:return z.OK;case De.CANCELLED:return z.CANCELLED;case De.UNKNOWN:return z.UNKNOWN;case De.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case De.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case De.INTERNAL:return z.INTERNAL;case De.UNAVAILABLE:return z.UNAVAILABLE;case De.UNAUTHENTICATED:return z.UNAUTHENTICATED;case De.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case De.NOT_FOUND:return z.NOT_FOUND;case De.ALREADY_EXISTS:return z.ALREADY_EXISTS;case De.PERMISSION_DENIED:return z.PERMISSION_DENIED;case De.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case De.ABORTED:return z.ABORTED;case De.OUT_OF_RANGE:return z.OUT_OF_RANGE;case De.UNIMPLEMENTED:return z.UNIMPLEMENTED;case De.DATA_LOSS:return z.DATA_LOSS;default:return X(39323,{code:n})}}(le=De||(De={}))[le.OK=0]="OK",le[le.CANCELLED=1]="CANCELLED",le[le.UNKNOWN=2]="UNKNOWN",le[le.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",le[le.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",le[le.NOT_FOUND=5]="NOT_FOUND",le[le.ALREADY_EXISTS=6]="ALREADY_EXISTS",le[le.PERMISSION_DENIED=7]="PERMISSION_DENIED",le[le.UNAUTHENTICATED=16]="UNAUTHENTICATED",le[le.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",le[le.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",le[le.ABORTED=10]="ABORTED",le[le.OUT_OF_RANGE=11]="OUT_OF_RANGE",le[le.UNIMPLEMENTED=12]="UNIMPLEMENTED",le[le.INTERNAL=13]="INTERNAL",le[le.UNAVAILABLE=14]="UNAVAILABLE",le[le.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hp=new Lt([4294967295,4294967295],0);function Il(n){const e=Kc().encode(n),t=new Uc;return t.update(e),new Uint8Array(t.digest())}function bl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Lt([t,r],0),new Lt([i,o],0)]}class Co{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new nr(`Invalid padding: ${t}`);if(r<0)throw new nr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new nr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new nr(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Lt.fromNumber(this.pe)}we(e,t,r){let i=e.add(t.multiply(Lt.fromNumber(r)));return i.compare(hp)===1&&(i=new Lt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const t=Il(e),[r,i]=bl(t);for(let o=0;o<this.hashCount;o++){const a=this.we(r,i,o);if(!this.be(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Co(o,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.pe===0)return;const t=Il(e),[r,i]=bl(t);for(let o=0;o<this.hashCount;o++){const a=this.we(r,i,o);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class nr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,br.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Gi(ee.min(),i,new Se(se),At(),oe())}}class br{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new br(r,t,oe(),oe(),oe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e,t,r,i){this.De=e,this.removedTargetIds=t,this.key=r,this.ve=i}}class Au{constructor(e,t){this.targetId=e,this.Ce=t}}class Cu{constructor(e,t,r=Ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Al{constructor(){this.Fe=0,this.Me=Cl(),this.xe=Ge.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=oe(),t=oe(),r=oe();return this.Me.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:X(38017,{changeType:o})}}),new br(this.xe,this.Oe,e,t,r)}Qe(){this.Ne=!1,this.Me=Cl()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,me(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class dp{constructor(e){this.ze=e,this.je=new Map,this.He=At(),this.Je=Hr(),this.Ye=Hr(),this.Ze=new Se(se)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{const r=this.rt(t);switch(e.state){case 0:this.it(t)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(t);break;case 3:this.it(t)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),r.ke(e.resumeToken));break;default:X(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((r,i)=>{this.it(i)&&t(i)})}ot(e){const t=e.targetId,r=e.Ce.count,i=this._t(t);if(i){const o=i.target;if(Os(o))if(r===0){const a=new K(o.path);this.tt(t,a,Je.newNoDocument(a,ee.min()))}else me(r===1,20013,{expectedCount:r});else{const a=this.ut(t);if(a!==r){const l=this.ct(e),d=l?this.lt(l,e,a):1;if(d!==0){this.st(t);const m=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,m)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t;let a,l;try{a=zt(r).toUint8Array()}catch(d){if(d instanceof Jc)return An("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new Co(a,i,o)}catch(d){return An(d instanceof nr?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.pe===0?null:l}lt(e,t,r){return t.Ce.count===r-this.Tt(e,t.targetId)?0:2}Tt(e,t){const r=this.ze.getRemoteKeysForTarget(t);let i=0;return r.forEach(o=>{const a=this.ze.Pt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.tt(t,o,null),i++)}),i}It(e){const t=new Map;this.je.forEach((o,a)=>{const l=this._t(a);if(l){if(o.current&&Os(l.target)){const d=new K(l.target.path);this.Et(d).has(a)||this.dt(a,d)||this.tt(a,d,Je.newNoDocument(d,e))}o.Le&&(t.set(a,o.qe()),o.Qe())}});let r=oe();this.Ye.forEach((o,a)=>{let l=!0;a.forEachWhile(d=>{const m=this._t(d);return!m||m.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.He.forEach((o,a)=>a.setReadTime(e));const i=new Gi(e,t,this.Ze,this.He,r);return this.He=At(),this.Je=Hr(),this.Ye=Hr(),this.Ze=new Se(se),i}et(e,t){if(!this.it(e))return;const r=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,r),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,r){if(!this.it(e))return;const i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),r&&(this.He=this.He.insert(t,r))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Al,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new Me(se),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new Me(se),this.Je=this.Je.insert(e,t)),t}it(e){const t=this._t(e)!==null;return t||H("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new Al),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Hr(){return new Se(K.comparator)}function Cl(){return new Se(K.comparator)}const fp={asc:"ASCENDING",desc:"DESCENDING"},mp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pp={and:"AND",or:"OR"};class gp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Us(n,e){return n.useProto3Json||Oi(e)?e:{value:e}}function Ci(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Su(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function yp(n,e){return Ci(n,e.toTimestamp())}function gt(n){return me(!!n,49232),ee.fromTimestamp(function(t){const r=Ut(t);return new Le(r.seconds,r.nanos)}(n))}function So(n,e){return zs(n,e).canonicalString()}function zs(n,e){const t=function(i){return new Ae(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function ku(n){const e=Ae.fromString(n);return me(Vu(e),10190,{key:e.toString()}),e}function js(n,e){return So(n.databaseId,e.path)}function gs(n,e){const t=ku(e);if(t.get(1)!==n.databaseId.projectId)throw new W(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new W(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new K(xu(t))}function Ru(n,e){return So(n.databaseId,e)}function _p(n){const e=ku(n);return e.length===4?Ae.emptyPath():xu(e)}function $s(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xu(n){return me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Sl(n,e,t){return{name:js(n,e),fields:t.value.mapValue.fields}}function vp(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:X(39313,{state:m})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(m,y){return m.useProto3Json?(me(y===void 0||typeof y=="string",58123),Ge.fromBase64String(y||"")):(me(y===void 0||y instanceof Buffer||y instanceof Uint8Array,16193),Ge.fromUint8Array(y||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(m){const y=m.code===void 0?z.UNKNOWN:bu(m.code);return new W(y,m.message||"")}(a);t=new Cu(r,i,o,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=gs(n,r.document.name),o=gt(r.document.updateTime),a=r.document.createTime?gt(r.document.createTime):ee.min(),l=new it({mapValue:{fields:r.document.fields}}),d=Je.newFoundDocument(i,o,a,l),m=r.targetIds||[],y=r.removedTargetIds||[];t=new ri(m,y,d.key,d)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=gs(n,r.document),o=r.readTime?gt(r.readTime):ee.min(),a=Je.newNoDocument(i,o),l=r.removedTargetIds||[];t=new ri([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=gs(n,r.document),o=r.removedTargetIds||[];t=new ri([],o,i,null)}else{if(!("filter"in e))return X(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:o}=r,a=new cp(i,o),l=r.targetId;t=new Au(l,a)}}return t}function Ep(n,e){let t;if(e instanceof Ir)t={update:Sl(n,e.key,e.value)};else if(e instanceof bo)t={delete:js(n,e.key)};else if(e instanceof ln)t={update:Sl(n,e.key,e.data),updateMask:Rp(e.fieldMask)};else{if(!(e instanceof op))return X(16599,{ft:e.type});t={verify:js(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){const l=a.transform;if(l instanceof bi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Tr)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof wr)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ai)return{fieldPath:a.field.canonicalString(),increment:l.Re};throw X(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:yp(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:X(27497)}(n,e.precondition)),t}function Tp(n,e){return n&&n.length>0?(me(e!==void 0,14353),n.map(t=>function(i,o){let a=i.updateTime?gt(i.updateTime):gt(o);return a.isEqual(ee.min())&&(a=gt(o)),new rp(a,i.transformResults||[])}(t,e))):[]}function wp(n,e){return{documents:[Ru(n,e.path)]}}function Ip(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Ru(n,i);const o=function(m){if(m.length!==0)return Du(_t.create(m,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(m){if(m.length!==0)return m.map(y=>function(k){return{field:vn(k.field),direction:Cp(k.dir)}}(y))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=Us(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{gt:t,parent:i}}function bp(n){let e=_p(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){me(r===1,65062);const y=t.from[0];y.allDescendants?i=y.collectionId:e=e.child(y.collectionId)}let o=[];t.where&&(o=function(A){const k=Pu(A);return k instanceof _t&&lu(k)?k.getFilters():[k]}(t.where));let a=[];t.orderBy&&(a=function(A){return A.map(k=>function(P){return new Ii(En(P.field),function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(k))}(t.orderBy));let l=null;t.limit&&(l=function(A){let k;return k=typeof A=="object"?A.value:A,Oi(k)?null:k}(t.limit));let d=null;t.startAt&&(d=function(A){const k=!!A.before,S=A.values||[];return new wi(S,k)}(t.startAt));let m=null;return t.endAt&&(m=function(A){const k=!A.before,S=A.values||[];return new wi(S,k)}(t.endAt)),$m(e,i,a,o,l,"F",d,m)}function Ap(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Pu(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=En(t.unaryFilter.field);return Ne.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=En(t.unaryFilter.field);return Ne.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=En(t.unaryFilter.field);return Ne.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=En(t.unaryFilter.field);return Ne.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return X(61313);default:return X(60726)}}(n):n.fieldFilter!==void 0?function(t){return Ne.create(En(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return X(58110);default:return X(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return _t.create(t.compositeFilter.filters.map(r=>Pu(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return X(1026)}}(t.compositeFilter.op))}(n):X(30097,{filter:n})}function Cp(n){return fp[n]}function Sp(n){return mp[n]}function kp(n){return pp[n]}function vn(n){return{fieldPath:n.canonicalString()}}function En(n){return He.fromServerFormat(n.fieldPath)}function Du(n){return n instanceof Ne?function(t){if(t.op==="=="){if(ml(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NAN"}};if(fl(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ml(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NOT_NAN"}};if(fl(t.value))return{unaryFilter:{field:vn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vn(t.field),op:Sp(t.op),value:t.value}}}(n):n instanceof _t?function(t){const r=t.getFilters().map(i=>Du(i));return r.length===1?r[0]:{compositeFilter:{op:kp(t.op),filters:r}}}(n):X(54877,{filter:n})}function Rp(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Vu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e,t,r,i,o=ee.min(),a=ee.min(),l=Ge.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new Pt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Pt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Pt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Pt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xp{constructor(e){this.wt=e}}function Pp(n){const e=bp({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fs(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(){this.Cn=new Vp}addToCollectionParentIndex(e,t){return this.Cn.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(Ft.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(Ft.min())}updateCollectionGroup(e,t,r){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}}class Vp{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Me(Ae.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Me(Ae.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bu=41943040;class et{static withCacheSize(e){return new et(e,et.DEFAULT_COLLECTION_PERCENTILE,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */et.DEFAULT_COLLECTION_PERCENTILE=10,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,et.DEFAULT=new et(Bu,et.DEFAULT_COLLECTION_PERCENTILE,et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),et.DISABLED=new et(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new Rn(0)}static lr(){return new Rn(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl="LruGarbageCollector",Bp=1048576;function xl([n,e],[t,r]){const i=se(n,t);return i===0?se(e,r):i}class Np{constructor(e){this.Er=e,this.buffer=new Me(xl),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();xl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Lp{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){H(Rl,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Mn(t)?H(Rl,"Ignoring IndexedDB error during garbage collection: ",t):await Ln(t)}await this.mr(3e5)})}}class Mp{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return F.resolve(Mi.le);const r=new Np(t);return this.gr.forEachTarget(e,i=>r.Rr(i.sequenceNumber)).next(()=>this.gr.yr(e,i=>r.Rr(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.gr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(H("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(kl)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(H("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kl):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let r,i,o,a,l,d,m;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(H("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),i=this.params.maximumSequenceNumbersToCollect):i=A,a=Date.now(),this.nthSequenceNumber(e,i))).next(A=>(r=A,l=Date.now(),this.removeTargets(e,r,t))).next(A=>(o=A,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(A=>(m=Date.now(),yn()<=ce.DEBUG&&H("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-y}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${o} targets in `+(d-l)+`ms
	Removed ${A} documents in `+(m-d)+`ms
Total Duration: ${m-y}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:A})))}}function Op(n,e){return new Mp(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(){this.changes=new an(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Je.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?F.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ur(r.mutation,i,ut.empty(),Le.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=oe()){const i=Zt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=tr();return o.forEach((l,d)=>{a=a.insert(l,d.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Zt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oe()))}populateOverlays(e,t,r){const i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let o=At();const a=cr(),l=function(){return cr()}();return t.forEach((d,m)=>{const y=r.get(m.key);i.has(m.key)&&(y===void 0||y.mutation instanceof ln)?o=o.insert(m.key,m):y!==void 0?(a.set(m.key,y.mutation.getFieldMask()),ur(y.mutation,m,y.mutation.getFieldMask(),Le.now())):a.set(m.key,ut.empty())}),this.recalculateAndSaveOverlays(e,o).next(d=>(d.forEach((m,y)=>a.set(m,y)),t.forEach((m,y)=>{var A;return l.set(m,new Up(y,(A=a.get(m))!==null&&A!==void 0?A:null))}),l))}recalculateAndSaveOverlays(e,t){const r=cr();let i=new Se((a,l)=>a-l),o=oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(d=>{const m=t.get(d);if(m===null)return;let y=r.get(d)||ut.empty();y=l.applyToLocalView(m,y),r.set(d,y);const A=(i.get(l.batchId)||oe()).add(d);i=i.insert(l.batchId,A)})}).next(()=>{const a=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),m=d.key,y=d.value,A=gu();y.forEach(k=>{if(!o.has(k)){const S=wu(t.get(k),r.get(k));S!==null&&A.set(k,S),o=o.add(k)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,A))}return F.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return K.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):qm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{const a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):F.resolve(Zt());let l=yr,d=o;return a.next(m=>F.forEach(m,(y,A)=>(l<A.largestBatchId&&(l=A.largestBatchId),o.get(y)?F.resolve():this.remoteDocumentCache.getEntry(e,y).next(k=>{d=d.insert(y,k)}))).next(()=>this.populateOverlays(e,m,o)).next(()=>this.computeViews(e,d,m,oe())).next(y=>({batchId:l,changes:pu(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next(r=>{let i=tr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const o=t.collectionGroup;let a=tr();return this.indexManager.getCollectionParents(e,o).next(l=>F.forEach(l,d=>{const m=function(A,k){return new Ui(k,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(t,d.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next(y=>{y.forEach((A,k)=>{a=a.insert(A,k)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((d,m)=>{const y=m.getKey();a.get(y)===null&&(a=a.insert(y,Je.newInvalidDocument(y)))});let l=tr();return a.forEach((d,m)=>{const y=o.get(d);y!==void 0&&ur(y.mutation,m,ut.empty(),Le.now()),$i(t,m)&&(l=l.insert(d,m))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return F.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:gt(i.createTime)}}(t)),F.resolve()}getNamedQuery(e,t){return F.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(i){return{name:i.name,query:Pp(i.bundledQuery),readTime:gt(i.readTime)}}(t)),F.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(){this.overlays=new Se(K.comparator),this.Qr=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Zt();return F.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.St(e,t,o)}),F.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Qr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Qr.delete(r)),F.resolve()}getOverlaysForCollection(e,t,r){const i=Zt(),o=t.length+1,a=new K(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const d=l.getNext().value,m=d.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===o&&d.largestBatchId>r&&i.set(d.getKey(),d)}return F.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new Se((m,y)=>m-y);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let y=o.get(m.largestBatchId);y===null&&(y=Zt(),o=o.insert(m.largestBatchId,y)),y.set(m.getKey(),m)}}const l=Zt(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((m,y)=>l.set(m,y)),!(l.size()>=i)););return F.resolve(l)}St(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Qr.get(i.largestBatchId).delete(r.key);this.Qr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new lp(t,r));let o=this.Qr.get(t);o===void 0&&(o=oe(),this.Qr.set(t,o)),this.Qr.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(){this.sessionToken=Ge.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,F.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(){this.$r=new Me(ze.Ur),this.Kr=new Me(ze.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const r=new ze(e,t);this.$r=this.$r.add(r),this.Kr=this.Kr.add(r)}Gr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.zr(new ze(e,t))}jr(e,t){e.forEach(r=>this.removeReference(r,t))}Hr(e){const t=new K(new Ae([])),r=new ze(t,e),i=new ze(t,e+1),o=[];return this.Kr.forEachInRange([r,i],a=>{this.zr(a),o.push(a.key)}),o}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new K(new Ae([])),r=new ze(t,e),i=new ze(t,e+1);let o=oe();return this.Kr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new ze(e,0),r=this.$r.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ze{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return K.comparator(e.key,t.key)||se(e.Zr,t.Zr)}static Wr(e,t){return se(e.Zr,t.Zr)||K.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new Me(ze.Ur)}checkEmpty(e){return F.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const o=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new ap(o,t,r,i);this.mutationQueue.push(a);for(const l of i)this.Xr=this.Xr.add(new ze(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return F.resolve(a)}lookupMutationBatch(e,t){return F.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.ti(r),o=i<0?0:i;return F.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(this.mutationQueue.length===0?_o:this.nr-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ze(t,0),i=new ze(t,Number.POSITIVE_INFINITY),o=[];return this.Xr.forEachInRange([r,i],a=>{const l=this.ei(a.Zr);o.push(l)}),F.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Me(se);return t.forEach(i=>{const o=new ze(i,0),a=new ze(i,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([o,a],l=>{r=r.add(l.Zr)})}),F.resolve(this.ni(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let o=r;K.isDocumentKey(o)||(o=o.child(""));const a=new ze(new K(o),0);let l=new Me(se);return this.Xr.forEachWhile(d=>{const m=d.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(l=l.add(d.Zr)),!0)},a),F.resolve(this.ni(l))}ni(e){const t=[];return e.forEach(r=>{const i=this.ei(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){me(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Xr;return F.forEach(t.mutations,i=>{const o=new ze(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Xr=r})}sr(e){}containsKey(e,t){const r=new ze(t,0),i=this.Xr.firstAfterOrEqual(r);return F.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e){this.ii=e,this.docs=function(){return new Se(K.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ii(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return F.resolve(r?r.document.mutableCopy():Je.newInvalidDocument(t))}getEntries(e,t){let r=At();return t.forEach(i=>{const o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Je.newInvalidDocument(i))}),F.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=At();const a=t.path,l=new K(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:m,value:{document:y}}=d.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||Tm(Em(y),r)<=0||(i.has(y.key)||$i(t,y))&&(o=o.insert(y.key,y.mutableCopy()))}return F.resolve(o)}getAllFromCollectionGroup(e,t,r,i){X(9500)}si(e,t){return F.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Wp(this)}getSize(e){return F.resolve(this.size)}}class Wp extends Fp{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Br.addEntry(e,i)):this.Br.removeEntry(r)}),F.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e){this.persistence=e,this.oi=new an(t=>To(t),wo),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this._i=0,this.ai=new ko,this.targetCount=0,this.ui=Rn.cr()}forEachTarget(e,t){return this.oi.forEach((r,i)=>t(i)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this._i&&(this._i=t),F.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new Rn(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.Tr(t),F.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,t,r){let i=0;const o=[];return this.oi.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.oi.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),F.waitFor(o).next(()=>i)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){const r=this.oi.get(t)||null;return F.resolve(r)}addMatchingKeys(e,t,r){return this.ai.Gr(t,r),F.resolve()}removeMatchingKeys(e,t,r){this.ai.jr(t,r);const i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),F.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),F.resolve()}getMatchingKeysForTargetId(e,t){const r=this.ai.Yr(t);return F.resolve(r)}containsKey(e,t){return F.resolve(this.ai.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(e,t){this.ci={},this.overlays={},this.li=new Mi(0),this.hi=!1,this.hi=!0,this.Pi=new qp,this.referenceDelegate=e(this),this.Ti=new Kp(this),this.indexManager=new Dp,this.remoteDocumentCache=function(i){return new Gp(i)}(r=>this.referenceDelegate.Ii(r)),this.serializer=new xp(t),this.Ei=new jp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $p,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ci[e.toKey()];return r||(r=new Hp(t,this.referenceDelegate),this.ci[e.toKey()]=r),r}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,r){H("MemoryPersistence","Starting transaction:",e);const i=new Qp(this.li.next());return this.referenceDelegate.di(),r(i).next(o=>this.referenceDelegate.Ai(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ri(e,t){return F.or(Object.values(this.ci).map(r=>()=>r.containsKey(e,t)))}}class Qp extends Im{constructor(e){super(),this.currentSequenceNumber=e}}class Ro{constructor(e){this.persistence=e,this.Vi=new ko,this.mi=null}static fi(e){return new Ro(e)}get gi(){if(this.mi)return this.mi;throw X(60996)}addReference(e,t,r){return this.Vi.addReference(r,t),this.gi.delete(r.toString()),F.resolve()}removeReference(e,t,r){return this.Vi.removeReference(r,t),this.gi.add(r.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),F.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(i=>this.gi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.gi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.gi,r=>{const i=K.fromPath(r);return this.pi(e,i).next(o=>{o||t.removeEntry(i,ee.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(r=>{r?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return F.or([()=>F.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class Si{constructor(e,t){this.persistence=e,this.yi=new an(r=>Cm(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Op(this,t)}static fi(e,t){return new Si(e,t)}di(){}Ai(e){return F.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}br(e){let t=0;return this.yr(e,r=>{t++}).next(()=>t)}yr(e,t){return F.forEach(this.yi,(r,i)=>this.Dr(e,r,i).next(o=>o?F.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.si(e,a=>this.Dr(e,a,t).next(l=>{l||(r++,o.removeEntry(a,ee.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),F.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),F.resolve()}removeReference(e,t,r){return this.yi.set(r,e.currentSequenceNumber),F.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),F.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ei(e.data.value)),t}Dr(e,t,r){return F.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.yi.get(t);return F.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ds=r,this.As=i}static Rs(e,t){let r=oe(),i=oe();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new xo(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return $d()?8:bm(zd())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,r,i){const o={result:null};return this.ws(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.bs(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new Xp;return this.Ss(e,t,a).next(l=>{if(o.result=l,this.fs)return this.Ds(e,t,a,l.size)})}).next(()=>o.result)}Ds(e,t,r,i){return r.documentReadCount<this.gs?(yn()<=ce.DEBUG&&H("QueryEngine","SDK will not create cache indexes for query:",_n(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),F.resolve()):(yn()<=ce.DEBUG&&H("QueryEngine","Query:",_n(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ps*i?(yn()<=ce.DEBUG&&H("QueryEngine","The SDK decides to create cache indexes for query:",_n(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mt(t))):F.resolve())}ws(e,t){if(_l(t))return F.resolve(null);let r=mt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Fs(t,null,"F"),r=mt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const a=oe(...o);return this.ys.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(d=>{const m=this.vs(t,l);return this.Cs(t,m,a,d.readTime)?this.ws(e,Fs(t,null,"F")):this.Fs(e,m,t,d)}))})))}bs(e,t,r,i){return _l(t)||i.isEqual(ee.min())?F.resolve(null):this.ys.getDocuments(e,r).next(o=>{const a=this.vs(t,o);return this.Cs(t,a,r,i)?F.resolve(null):(yn()<=ce.DEBUG&&H("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),_n(t)),this.Fs(e,a,t,vm(i,yr)).next(l=>l))})}vs(e,t){let r=new Me(fu(e));return t.forEach((i,o)=>{$i(e,o)&&(r=r.add(o))}),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}Ss(e,t,r){return yn()<=ce.DEBUG&&H("QueryEngine","Using full collection scan to execute query:",_n(t)),this.ys.getDocumentsMatchingQuery(e,t,Ft.min(),r)}Fs(e,t,r,i){return this.ys.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po="LocalStore",Jp=3e8;class Zp{constructor(e,t,r,i){this.persistence=e,this.Ms=t,this.serializer=i,this.xs=new Se(se),this.Os=new an(o=>To(o),wo),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(r)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zp(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}function eg(n,e,t,r){return new Zp(n,e,t,r)}async function Lu(n,e){const t=ne(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Ls(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const a=[],l=[];let d=oe();for(const m of i){a.push(m.batchId);for(const y of m.mutations)d=d.add(y.key)}for(const m of o){l.push(m.batchId);for(const y of m.mutations)d=d.add(y.key)}return t.localDocuments.getDocuments(r,d).next(m=>({ks:m,removedBatchIds:a,addedBatchIds:l}))})})}function tg(n,e){const t=ne(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),o=t.Bs.newChangeBuffer({trackRemovals:!0});return function(l,d,m,y){const A=m.batch,k=A.keys();let S=F.resolve();return k.forEach(P=>{S=S.next(()=>y.getEntry(d,P)).next(B=>{const O=m.docVersions.get(P);me(O!==null,48541),B.version.compareTo(O)<0&&(A.applyToRemoteDocument(B,m),B.isValidDocument()&&(B.setReadTime(m.commitVersion),y.addEntry(B)))})}),S.next(()=>l.mutationQueue.removeMutationBatch(d,A))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let d=oe();for(let m=0;m<l.mutationResults.length;++m)l.mutationResults[m].transformResults.length>0&&(d=d.add(l.batch.mutations[m].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Mu(n){const e=ne(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function ng(n,e){const t=ne(n),r=e.snapshotVersion;let i=t.xs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.Bs.newChangeBuffer({trackRemovals:!0});i=t.xs;const l=[];e.targetChanges.forEach((y,A)=>{const k=i.get(A);if(!k)return;l.push(t.Ti.removeMatchingKeys(o,y.removedDocuments,A).next(()=>t.Ti.addMatchingKeys(o,y.addedDocuments,A)));let S=k.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(A)!==null?S=S.withResumeToken(Ge.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):y.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(y.resumeToken,r)),i=i.insert(A,S),function(B,O,q){return B.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=Jp?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(k,S,y)&&l.push(t.Ti.updateTargetData(o,S))});let d=At(),m=oe();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,y))}),l.push(rg(o,a,e.documentUpdates).next(y=>{d=y.qs,m=y.Qs})),!r.isEqual(ee.min())){const y=t.Ti.getLastRemoteSnapshotVersion(o).next(A=>t.Ti.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(y)}return F.waitFor(l).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,d,m)).next(()=>d)}).then(o=>(t.xs=i,o))}function rg(n,e,t){let r=oe(),i=oe();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=At();return t.forEach((l,d)=>{const m=o.get(l);d.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(ee.min())?(e.removeEntry(l,d.readTime),a=a.insert(l,d)):!m.isValidDocument()||d.version.compareTo(m.version)>0||d.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(d),a=a.insert(l,d)):H(Po,"Ignoring outdated watch update for ",l,". Current version:",m.version," Watch version:",d.version)}),{qs:a,Qs:i}})}function ig(n,e){const t=ne(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=_o),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function sg(n,e){const t=ne(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ti.getTargetData(r,e).next(o=>o?(i=o,F.resolve(i)):t.Ti.allocateTargetId(r).next(a=>(i=new Pt(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ti.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.xs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.xs=t.xs.insert(r.targetId,r),t.Os.set(e,r.targetId)),r})}async function qs(n,e,t){const r=ne(n),i=r.xs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Mn(a))throw a;H(Po,`Failed to update sequence numbers for target ${e}: ${a}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)}function Pl(n,e,t){const r=ne(n);let i=ee.min(),o=oe();return r.persistence.runTransaction("Execute query","readwrite",a=>function(d,m,y){const A=ne(d),k=A.Os.get(y);return k!==void 0?F.resolve(A.xs.get(k)):A.Ti.getTargetData(m,y)}(r,a,mt(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(a,l.targetId).next(d=>{o=d})}).next(()=>r.Ms.getDocumentsMatchingQuery(a,e,t?i:ee.min(),t?o:oe())).next(l=>(og(r,Gm(e),l),{documents:l,$s:o})))}function og(n,e,t){let r=n.Ns.get(e)||ee.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ns.set(e,r)}class Dl{constructor(){this.activeTargetIds=Jm()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ag{constructor(){this.xo=new Dl,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,r){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new Dl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vl="ConnectivityMonitor";class Bl{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){H(Vl,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){H(Vl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gr=null;function Hs(){return Gr===null?Gr=function(){return 268435456+Math.round(2147483648*Math.random())}():Gr++,"0x"+Gr.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys="RestConnection",cg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ug{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${r}/databases/${i}`,this.Go=this.databaseId.database===Ei?`project_id=${r}`:`project_id=${r}&database_id=${i}`}zo(e,t,r,i,o){const a=Hs(),l=this.jo(e,t.toUriEncodedString());H(ys,`Sending RPC '${e}' ${a}:`,l,r);const d={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(d,i,o);const{host:m}=new URL(l),y=po(m);return this.Jo(e,l,d,r,y).then(A=>(H(ys,`Received RPC '${e}' ${a}: `,A),A),A=>{throw An(ys,`RPC '${e}' ${a} failed with error: `,A,"url: ",l,"request:",r),A})}Yo(e,t,r,i,o,a){return this.zo(e,t,r,i,o)}Ho(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Nn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}jo(e,t){const r=cg[e];return`${this.Ko}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xe="WebChannelConnection";class dg extends ug{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,o){const a=Hs();return new Promise((l,d)=>{const m=new zc;m.setWithCredentials(!0),m.listenOnce(jc.COMPLETE,()=>{try{switch(m.getLastErrorCode()){case Zr.NO_ERROR:const A=m.getResponseJson();H(Xe,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(A)),l(A);break;case Zr.TIMEOUT:H(Xe,`RPC '${e}' ${a} timed out`),d(new W(z.DEADLINE_EXCEEDED,"Request time out"));break;case Zr.HTTP_ERROR:const k=m.getStatus();if(H(Xe,`RPC '${e}' ${a} failed with status:`,k,"response text:",m.getResponseText()),k>0){let S=m.getResponseJson();Array.isArray(S)&&(S=S[0]);const P=S?.error;if(P&&P.status&&P.message){const B=function(q){const $=q.toLowerCase().replace(/_/g,"-");return Object.values(z).indexOf($)>=0?$:z.UNKNOWN}(P.status);d(new W(B,P.message))}else d(new W(z.UNKNOWN,"Server responded with status "+m.getStatus()))}else d(new W(z.UNAVAILABLE,"Connection failed."));break;default:X(9055,{h_:e,streamId:a,P_:m.getLastErrorCode(),T_:m.getLastError()})}}finally{H(Xe,`RPC '${e}' ${a} completed.`)}});const y=JSON.stringify(i);H(Xe,`RPC '${e}' ${a} sending request:`,i),m.send(t,"POST",y,r,15)})}I_(e,t,r){const i=Hs(),o=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Hc(),l=qc(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(d.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Ho(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const y=o.join("");H(Xe,`Creating RPC '${e}' stream ${i}: ${y}`,d);const A=a.createWebChannel(y,d);this.E_(A);let k=!1,S=!1;const P=new hg({Zo:O=>{S?H(Xe,`Not sending because RPC '${e}' stream ${i} is closed:`,O):(k||(H(Xe,`Opening RPC '${e}' stream ${i} transport.`),A.open(),k=!0),H(Xe,`RPC '${e}' stream ${i} sending:`,O),A.send(O))},Xo:()=>A.close()}),B=(O,q,$)=>{O.listen(q,G=>{try{$(G)}catch(M){setTimeout(()=>{throw M},0)}})};return B(A,er.EventType.OPEN,()=>{S||(H(Xe,`RPC '${e}' stream ${i} transport opened.`),P.__())}),B(A,er.EventType.CLOSE,()=>{S||(S=!0,H(Xe,`RPC '${e}' stream ${i} transport closed`),P.u_(),this.d_(A))}),B(A,er.EventType.ERROR,O=>{S||(S=!0,An(Xe,`RPC '${e}' stream ${i} transport errored. Name:`,O.name,"Message:",O.message),P.u_(new W(z.UNAVAILABLE,"The operation could not be completed")))}),B(A,er.EventType.MESSAGE,O=>{var q;if(!S){const $=O.data[0];me(!!$,16349);const G=$,M=G?.error||((q=G[0])===null||q===void 0?void 0:q.error);if(M){H(Xe,`RPC '${e}' stream ${i} received error:`,M);const N=M.status;let U=function(E){const _=De[E];if(_!==void 0)return bu(_)}(N),b=M.message;U===void 0&&(U=z.INTERNAL,b="Unknown error status: "+N+" with message "+M.message),S=!0,P.u_(new W(U,b)),A.close()}else H(Xe,`RPC '${e}' stream ${i} received:`,$),P.c_($)}}),B(l,$c.STAT_EVENT,O=>{O.stat===Vs.PROXY?H(Xe,`RPC '${e}' stream ${i} detected buffering proxy`):O.stat===Vs.NOPROXY&&H(Xe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{P.a_()},0),P}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function _s(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(n){return new gp(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e,t,r=1e3,i=1.5,o=6e4){this.xi=e,this.timerId=t,this.A_=r,this.R_=i,this.V_=o,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),r=Math.max(0,Date.now()-this.g_),i=Math.max(0,t-r);i>0&&H("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,i,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nl="PersistentStream";class Fu{constructor(e,t,r,i,o,a,l,d){this.xi=e,this.S_=r,this.D_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new Ou(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===z.RESOURCE_EXHAUSTED?(bt(t.toString()),bt("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.v_===t&&this.z_(r,i)},r=>{e(()=>{const i=new W(z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.j_(i)})})}z_(e,t){const r=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{r(()=>this.listener.e_())}),this.stream.n_(()=>{r(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(i=>{r(()=>this.j_(i))}),this.stream.onMessage(i=>{r(()=>++this.M_==1?this.J_(i):this.onNext(i))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return H(Nl,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(H(Nl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class fg extends Fu{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=vp(this.serializer,e),r=function(o){if(!("targetChange"in o))return ee.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?ee.min():a.readTime?gt(a.readTime):ee.min()}(e);return this.listener.Y_(t,r)}Z_(e){const t={};t.database=$s(this.serializer),t.addTarget=function(o,a){let l;const d=a.target;if(l=Os(d)?{documents:wp(o,d)}:{query:Ip(o,d).gt},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Su(o,a.resumeToken);const m=Us(o,a.expectedCount);m!==null&&(l.expectedCount=m)}else if(a.snapshotVersion.compareTo(ee.min())>0){l.readTime=Ci(o,a.snapshotVersion.toTimestamp());const m=Us(o,a.expectedCount);m!==null&&(l.expectedCount=m)}return l}(this.serializer,e);const r=Ap(this.serializer,e);r&&(t.labels=r),this.Q_(t)}X_(e){const t={};t.database=$s(this.serializer),t.removeTarget=e,this.Q_(t)}}class mg extends Fu{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,me(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=Tp(e.writeResults,e.commitTime),r=gt(e.commitTime);return this.listener.ra(r,t)}ia(){const e={};e.database=$s(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Ep(this.serializer,r))};this.Q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg{}class gg extends pg{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.sa=!1}oa(){if(this.sa)throw new W(z.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.zo(e,zs(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new W(z.UNKNOWN,o.toString())})}Yo(e,t,r,i,o){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Yo(e,zs(t,r),i,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new W(z.UNKNOWN,a.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class yg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(bt(t),this.ua=!1):H("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nn="RemoteStore";class _g{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=o,this.Ra.No(a=>{r.enqueueAndForget(async()=>{cn(this)&&(H(nn,"Restarting streams for network reachability change."),await async function(d){const m=ne(d);m.da.add(4),await Ar(m),m.Va.set("Unknown"),m.da.delete(4),await Ki(m)}(this))})}),this.Va=new yg(r,i)}}async function Ki(n){if(cn(n))for(const e of n.Aa)await e(!0)}async function Ar(n){for(const e of n.Aa)await e(!1)}function Uu(n,e){const t=ne(n);t.Ea.has(e.targetId)||(t.Ea.set(e.targetId,e),No(t)?Bo(t):On(t).N_()&&Vo(t,e))}function Do(n,e){const t=ne(n),r=On(t);t.Ea.delete(e),r.N_()&&zu(t,e),t.Ea.size===0&&(r.N_()?r.k_():cn(t)&&t.Va.set("Unknown"))}function Vo(n,e){if(n.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ee.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}On(n).Z_(e)}function zu(n,e){n.ma.Ke(e),On(n).X_(e)}function Bo(n){n.ma=new dp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n.Ea.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),On(n).start(),n.Va.ca()}function No(n){return cn(n)&&!On(n).O_()&&n.Ea.size>0}function cn(n){return ne(n).da.size===0}function ju(n){n.ma=void 0}async function vg(n){n.Va.set("Online")}async function Eg(n){n.Ea.forEach((e,t)=>{Vo(n,e)})}async function Tg(n,e){ju(n),No(n)?(n.Va.Pa(e),Bo(n)):n.Va.set("Unknown")}async function wg(n,e,t){if(n.Va.set("Online"),e instanceof Cu&&e.state===2&&e.cause)try{await async function(i,o){const a=o.cause;for(const l of o.targetIds)i.Ea.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.Ea.delete(l),i.ma.removeTarget(l))}(n,e)}catch(r){H(nn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ki(n,r)}else if(e instanceof ri?n.ma.Xe(e):e instanceof Au?n.ma.ot(e):n.ma.nt(e),!t.isEqual(ee.min()))try{const r=await Mu(n.localStore);t.compareTo(r)>=0&&await function(o,a){const l=o.ma.It(a);return l.targetChanges.forEach((d,m)=>{if(d.resumeToken.approximateByteSize()>0){const y=o.Ea.get(m);y&&o.Ea.set(m,y.withResumeToken(d.resumeToken,a))}}),l.targetMismatches.forEach((d,m)=>{const y=o.Ea.get(d);if(!y)return;o.Ea.set(d,y.withResumeToken(Ge.EMPTY_BYTE_STRING,y.snapshotVersion)),zu(o,d);const A=new Pt(y.target,d,m,y.sequenceNumber);Vo(o,A)}),o.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){H(nn,"Failed to raise snapshot:",r),await ki(n,r)}}async function ki(n,e,t){if(!Mn(e))throw e;n.da.add(1),await Ar(n),n.Va.set("Offline"),t||(t=()=>Mu(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{H(nn,"Retrying IndexedDB access"),await t(),n.da.delete(1),await Ki(n)})}function $u(n,e){return e().catch(t=>ki(n,t,e))}async function Qi(n){const e=ne(n),t=$t(e);let r=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:_o;for(;Ig(e);)try{const i=await ig(e.localStore,r);if(i===null){e.Ia.length===0&&t.k_();break}r=i.batchId,bg(e,i)}catch(i){await ki(e,i)}qu(e)&&Hu(e)}function Ig(n){return cn(n)&&n.Ia.length<10}function bg(n,e){n.Ia.push(e);const t=$t(n);t.N_()&&t.ea&&t.ta(e.mutations)}function qu(n){return cn(n)&&!$t(n).O_()&&n.Ia.length>0}function Hu(n){$t(n).start()}async function Ag(n){$t(n).ia()}async function Cg(n){const e=$t(n);for(const t of n.Ia)e.ta(t.mutations)}async function Sg(n,e,t){const r=n.Ia.shift(),i=Ao.from(r,e,t);await $u(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await Qi(n)}async function kg(n,e){e&&$t(n).ea&&await async function(r,i){if(function(a){return up(a)&&a!==z.ABORTED}(i.code)){const o=r.Ia.shift();$t(r).L_(),await $u(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),await Qi(r)}}(n,e),qu(n)&&Hu(n)}async function Ll(n,e){const t=ne(n);t.asyncQueue.verifyOperationInProgress(),H(nn,"RemoteStore received new credentials");const r=cn(t);t.da.add(3),await Ar(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.da.delete(3),await Ki(t)}async function Rg(n,e){const t=ne(n);e?(t.da.delete(2),await Ki(t)):e||(t.da.add(2),await Ar(t),t.Va.set("Unknown"))}function On(n){return n.fa||(n.fa=function(t,r,i){const o=ne(t);return o.oa(),new fg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{e_:vg.bind(null,n),n_:Eg.bind(null,n),i_:Tg.bind(null,n),Y_:wg.bind(null,n)}),n.Aa.push(async e=>{e?(n.fa.L_(),No(n)?Bo(n):n.Va.set("Unknown")):(await n.fa.stop(),ju(n))})),n.fa}function $t(n){return n.ga||(n.ga=function(t,r,i){const o=ne(t);return o.oa(),new mg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:Ag.bind(null,n),i_:kg.bind(null,n),na:Cg.bind(null,n),ra:Sg.bind(null,n)}),n.Aa.push(async e=>{e?(n.ga.L_(),await Qi(n)):(await n.ga.stop(),n.Ia.length>0&&(H(nn,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))})),n.ga}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Mt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){const a=Date.now()+r,l=new Lo(e,t,a,i,o);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new W(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mo(n,e){if(bt("AsyncQueue",`${e}: ${n}`),Mn(n))return new W(z.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{static emptySet(e){return new In(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||K.comparator(t.key,r.key):(t,r)=>K.comparator(t.key,r.key),this.keyedMap=tr(),this.sortedSet=new Se(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof In)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new In;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(){this.pa=new Se(K.comparator)}track(e){const t=e.doc.key,r=this.pa.get(t);r?e.type!==0&&r.type===3?this.pa=this.pa.insert(t,e):e.type===3&&r.type!==1?this.pa=this.pa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.pa=this.pa.remove(t):e.type===1&&r.type===2?this.pa=this.pa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):X(63341,{Vt:e,ya:r}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal((t,r)=>{e.push(r)}),e}}class xn{constructor(e,t,r,i,o,a,l,d,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,i,o){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new xn(e,t,In.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ji(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class Pg{constructor(){this.queries=Ol(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const i=ne(t),o=i.queries;i.queries=Ol(),o.forEach((a,l)=>{for(const d of l.Sa)d.onError(r)})})(this,new W(z.ABORTED,"Firestore shutting down"))}}function Ol(){return new an(n=>du(n),ji)}async function Gu(n,e){const t=ne(n);let r=3;const i=e.query;let o=t.queries.get(i);o?!o.Da()&&e.va()&&(r=2):(o=new xg,r=e.va()?0:1);try{switch(r){case 0:o.ba=await t.onListen(i,!0);break;case 1:o.ba=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(a){const l=Mo(a,`Initialization of query '${_n(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,o),o.Sa.push(e),e.Fa(t.onlineState),o.ba&&e.Ma(o.ba)&&Oo(t)}async function Wu(n,e){const t=ne(n),r=e.query;let i=3;const o=t.queries.get(r);if(o){const a=o.Sa.indexOf(e);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?i=e.va()?0:1:!o.Da()&&e.va()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Dg(n,e){const t=ne(n);let r=!1;for(const i of e){const o=i.query,a=t.queries.get(o);if(a){for(const l of a.Sa)l.Ma(i)&&(r=!0);a.ba=i}}r&&Oo(t)}function Vg(n,e,t){const r=ne(n),i=r.queries.get(e);if(i)for(const o of i.Sa)o.onError(t);r.queries.delete(e)}function Oo(n){n.Ca.forEach(e=>{e.next()})}var Gs,Fl;(Fl=Gs||(Gs={})).xa="default",Fl.Cache="cache";class Ku{constructor(e,t,r){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=r||{}}Ma(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new xn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache||!this.va())return!0;const r=t!=="Offline";return(!this.options.Qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}qa(e){e=xn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==Gs.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(e){this.key=e}}class Xu{constructor(e){this.key=e}}class Bg{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=oe(),this.mutatedKeys=oe(),this.Za=fu(e),this.Xa=new In(this.Za)}get eu(){return this.Ha}tu(e,t){const r=t?t.nu:new Ml,i=t?t.Xa:this.Xa;let o=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1;const d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((y,A)=>{const k=i.get(y),S=$i(this.query,A)?A:null,P=!!k&&this.mutatedKeys.has(k.key),B=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let O=!1;k&&S?k.data.isEqual(S.data)?P!==B&&(r.track({type:3,doc:S}),O=!0):this.ru(k,S)||(r.track({type:2,doc:S}),O=!0,(d&&this.Za(S,d)>0||m&&this.Za(S,m)<0)&&(l=!0)):!k&&S?(r.track({type:0,doc:S}),O=!0):k&&!S&&(r.track({type:1,doc:k}),O=!0,(d||m)&&(l=!0)),O&&(S?(a=a.add(S),o=B?o.add(y):o.delete(y)):(a=a.delete(y),o=o.delete(y)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const y=this.query.limitType==="F"?a.last():a.first();a=a.delete(y.key),o=o.delete(y.key),r.track({type:1,doc:y})}return{Xa:a,nu:r,Cs:l,mutatedKeys:o}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const o=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const a=e.nu.wa();a.sort((y,A)=>function(S,P){const B=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X(20277,{Vt:O})}};return B(S)-B(P)}(y.type,A.type)||this.Za(y.doc,A.doc)),this.iu(r),i=i!=null&&i;const l=t&&!i?this.su():[],d=this.Ya.size===0&&this.current&&!i?1:0,m=d!==this.Ja;return this.Ja=d,a.length!==0||m?{snapshot:new xn(this.query,e.Xa,o,a,e.mutatedKeys,d===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),ou:l}:{ou:l}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Ml,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=oe(),this.Xa.forEach(r=>{this._u(r.key)&&(this.Ya=this.Ya.add(r.key))});const t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new Xu(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Qu(r))}),t}au(e){this.Ha=e.$s,this.Ya=oe();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return xn.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}}const Fo="SyncEngine";class Ng{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Lg{constructor(e){this.key=e,this.cu=!1}}class Mg{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.lu={},this.hu=new an(l=>du(l),ji),this.Pu=new Map,this.Tu=new Set,this.Iu=new Se(K.comparator),this.Eu=new Map,this.du=new ko,this.Au={},this.Ru=new Map,this.Vu=Rn.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}async function Og(n,e,t=!0){const r=nh(n);let i;const o=r.hu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.uu()):i=await Yu(r,e,t,!0),i}async function Fg(n,e){const t=nh(n);await Yu(t,e,!0,!1)}async function Yu(n,e,t,r){const i=await sg(n.localStore,mt(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let l;return r&&(l=await Ug(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Uu(n.remoteStore,i),l}async function Ug(n,e,t,r,i){n.fu=(A,k,S)=>async function(B,O,q,$){let G=O.view.tu(q);G.Cs&&(G=await Pl(B.localStore,O.query,!1).then(({documents:b})=>O.view.tu(b,G)));const M=$&&$.targetChanges.get(O.targetId),N=$&&$.targetMismatches.get(O.targetId)!=null,U=O.view.applyChanges(G,B.isPrimaryClient,M,N);return zl(B,O.targetId,U.ou),U.snapshot}(n,A,k,S);const o=await Pl(n.localStore,e,!0),a=new Bg(e,o.$s),l=a.tu(o.documents),d=br.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),m=a.applyChanges(l,n.isPrimaryClient,d);zl(n,t,m.ou);const y=new Ng(e,t,a);return n.hu.set(e,y),n.Pu.has(t)?n.Pu.get(t).push(e):n.Pu.set(t,[e]),m.snapshot}async function zg(n,e,t){const r=ne(n),i=r.hu.get(e),o=r.Pu.get(i.targetId);if(o.length>1)return r.Pu.set(i.targetId,o.filter(a=>!ji(a,e))),void r.hu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await qs(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Do(r.remoteStore,i.targetId),Ws(r,i.targetId)}).catch(Ln)):(Ws(r,i.targetId),await qs(r.localStore,i.targetId,!0))}async function jg(n,e){const t=ne(n),r=t.hu.get(e),i=t.Pu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Do(t.remoteStore,r.targetId))}async function $g(n,e,t){const r=Xg(n);try{const i=await function(a,l){const d=ne(a),m=Le.now(),y=l.reduce((S,P)=>S.add(P.key),oe());let A,k;return d.persistence.runTransaction("Locally write mutations","readwrite",S=>{let P=At(),B=oe();return d.Bs.getEntries(S,y).next(O=>{P=O,P.forEach((q,$)=>{$.isValidDocument()||(B=B.add(q))})}).next(()=>d.localDocuments.getOverlayedDocuments(S,P)).next(O=>{A=O;const q=[];for(const $ of l){const G=sp($,A.get($.key).overlayedDocument);G!=null&&q.push(new ln($.key,G,su(G.value.mapValue),pt.exists(!0)))}return d.mutationQueue.addMutationBatch(S,m,q,l)}).next(O=>{k=O;const q=O.applyToLocalDocumentSet(A,B);return d.documentOverlayCache.saveOverlays(S,O.batchId,q)})}).then(()=>({batchId:k.batchId,changes:pu(A)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,d){let m=a.Au[a.currentUser.toKey()];m||(m=new Se(se)),m=m.insert(l,d),a.Au[a.currentUser.toKey()]=m}(r,i.batchId,t),await Cr(r,i.changes),await Qi(r.remoteStore)}catch(i){const o=Mo(i,"Failed to persist write");t.reject(o)}}async function Ju(n,e){const t=ne(n);try{const r=await ng(t.localStore,e);e.targetChanges.forEach((i,o)=>{const a=t.Eu.get(o);a&&(me(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.cu=!0:i.modifiedDocuments.size>0?me(a.cu,14607):i.removedDocuments.size>0&&(me(a.cu,42227),a.cu=!1))}),await Cr(t,r,e)}catch(r){await Ln(r)}}function Ul(n,e,t){const r=ne(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.hu.forEach((o,a)=>{const l=a.view.Fa(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){const d=ne(a);d.onlineState=l;let m=!1;d.queries.forEach((y,A)=>{for(const k of A.Sa)k.Fa(l)&&(m=!0)}),m&&Oo(d)}(r.eventManager,e),i.length&&r.lu.Y_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function qg(n,e,t){const r=ne(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Eu.get(e),o=i&&i.key;if(o){let a=new Se(K.comparator);a=a.insert(o,Je.newNoDocument(o,ee.min()));const l=oe().add(o),d=new Gi(ee.min(),new Map,new Se(se),a,l);await Ju(r,d),r.Iu=r.Iu.remove(o),r.Eu.delete(e),Uo(r)}else await qs(r.localStore,e,!1).then(()=>Ws(r,e,t)).catch(Ln)}async function Hg(n,e){const t=ne(n),r=e.batch.batchId;try{const i=await tg(t.localStore,e);eh(t,r,null),Zu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Cr(t,i)}catch(i){await Ln(i)}}async function Gg(n,e,t){const r=ne(n);try{const i=await function(a,l){const d=ne(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let y;return d.mutationQueue.lookupMutationBatch(m,l).next(A=>(me(A!==null,37113),y=A.keys(),d.mutationQueue.removeMutationBatch(m,A))).next(()=>d.mutationQueue.performConsistencyCheck(m)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(m,y,l)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,y)).next(()=>d.localDocuments.getDocuments(m,y))})}(r.localStore,e);eh(r,e,t),Zu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Cr(r,i)}catch(i){await Ln(i)}}function Zu(n,e){(n.Ru.get(e)||[]).forEach(t=>{t.resolve()}),n.Ru.delete(e)}function eh(n,e,t){const r=ne(n);let i=r.Au[r.currentUser.toKey()];if(i){const o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Au[r.currentUser.toKey()]=i}}function Ws(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Pu.get(e))n.hu.delete(r),t&&n.lu.gu(r,t);n.Pu.delete(e),n.isPrimaryClient&&n.du.Hr(e).forEach(r=>{n.du.containsKey(r)||th(n,r)})}function th(n,e){n.Tu.delete(e.path.canonicalString());const t=n.Iu.get(e);t!==null&&(Do(n.remoteStore,t),n.Iu=n.Iu.remove(e),n.Eu.delete(t),Uo(n))}function zl(n,e,t){for(const r of t)r instanceof Qu?(n.du.addReference(r.key,e),Wg(n,r)):r instanceof Xu?(H(Fo,"Document no longer in limbo: "+r.key),n.du.removeReference(r.key,e),n.du.containsKey(r.key)||th(n,r.key)):X(19791,{pu:r})}function Wg(n,e){const t=e.key,r=t.path.canonicalString();n.Iu.get(t)||n.Tu.has(r)||(H(Fo,"New document in limbo: "+t),n.Tu.add(r),Uo(n))}function Uo(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){const e=n.Tu.values().next().value;n.Tu.delete(e);const t=new K(Ae.fromString(e)),r=n.Vu.next();n.Eu.set(r,new Lg(t)),n.Iu=n.Iu.insert(t,r),Uu(n.remoteStore,new Pt(mt(zi(t.path)),r,"TargetPurposeLimboResolution",Mi.le))}}async function Cr(n,e,t){const r=ne(n),i=[],o=[],a=[];r.hu.isEmpty()||(r.hu.forEach((l,d)=>{a.push(r.fu(d,e,t).then(m=>{var y;if((m||t)&&r.isPrimaryClient){const A=m?!m.fromCache:(y=t?.targetChanges.get(d.targetId))===null||y===void 0?void 0:y.current;r.sharedClientState.updateQueryState(d.targetId,A?"current":"not-current")}if(m){i.push(m);const A=xo.Rs(d.targetId,m);o.push(A)}}))}),await Promise.all(a),r.lu.Y_(i),await async function(d,m){const y=ne(d);try{await y.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>F.forEach(m,k=>F.forEach(k.ds,S=>y.persistence.referenceDelegate.addReference(A,k.targetId,S)).next(()=>F.forEach(k.As,S=>y.persistence.referenceDelegate.removeReference(A,k.targetId,S)))))}catch(A){if(!Mn(A))throw A;H(Po,"Failed to update sequence numbers: "+A)}for(const A of m){const k=A.targetId;if(!A.fromCache){const S=y.xs.get(k),P=S.snapshotVersion,B=S.withLastLimboFreeSnapshotVersion(P);y.xs=y.xs.insert(k,B)}}}(r.localStore,o))}async function Kg(n,e){const t=ne(n);if(!t.currentUser.isEqual(e)){H(Fo,"User change. New user:",e.toKey());const r=await Lu(t.localStore,e);t.currentUser=e,function(o,a){o.Ru.forEach(l=>{l.forEach(d=>{d.reject(new W(z.CANCELLED,a))})}),o.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Cr(t,r.ks)}}function Qg(n,e){const t=ne(n),r=t.Eu.get(e);if(r&&r.cu)return oe().add(r.key);{let i=oe();const o=t.Pu.get(e);if(!o)return i;for(const a of o){const l=t.hu.get(a);i=i.unionWith(l.view.eu)}return i}}function nh(n){const e=ne(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ju.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=qg.bind(null,e),e.lu.Y_=Dg.bind(null,e.eventManager),e.lu.gu=Vg.bind(null,e.eventManager),e}function Xg(n){const e=ne(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Hg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Gg.bind(null,e),e}class Ri{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Wi(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return eg(this.persistence,new Yp,e.initialUser,this.serializer)}Su(e){return new Nu(Ro.fi,this.serializer)}bu(e){return new ag}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ri.provider={build:()=>new Ri};class Yg extends Ri{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){me(this.persistence.referenceDelegate instanceof Si,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Lp(r,e.asyncQueue,t)}Su(e){const t=this.cacheSizeBytes!==void 0?et.withCacheSize(this.cacheSizeBytes):et.DEFAULT;return new Nu(r=>Si.fi(r,t),this.serializer)}}class Ks{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ul(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Kg.bind(null,this.syncEngine),await Rg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Pg}()}createDatastore(e){const t=Wi(e.databaseInfo.databaseId),r=function(o){return new dg(o)}(e.databaseInfo);return function(o,a,l,d){return new gg(o,a,l,d)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,o,a,l){return new _g(r,i,o,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>Ul(this.syncEngine,t,0),function(){return Bl.C()?new Bl:new lg}())}createSyncEngine(e,t){return function(i,o,a,l,d,m,y){const A=new Mg(i,o,a,l,d,m);return y&&(A.mu=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const o=ne(i);H(nn,"RemoteStore shutting down."),o.da.add(5),await Ar(o),o.Ra.shutdown(),o.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ks.provider={build:()=>new Ks};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):bt("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qt="FirestoreClient";class Jg{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ye.UNAUTHENTICATED,this.clientId=Qc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{H(qt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(H(qt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Mt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Mo(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function vs(n,e){n.asyncQueue.verifyOperationInProgress(),H(qt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Lu(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function jl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Zg(n);H(qt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Ll(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Ll(e.remoteStore,i)),n._onlineComponents=e}async function Zg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){H(qt,"Using user provided OfflineComponentProvider");try{await vs(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===z.FAILED_PRECONDITION||i.code===z.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;An("Error using user provided cache. Falling back to memory cache: "+t),await vs(n,new Ri)}}else H(qt,"Using default OfflineComponentProvider"),await vs(n,new Yg(void 0));return n._offlineComponents}async function ih(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(H(qt,"Using user provided OnlineComponentProvider"),await jl(n,n._uninitializedComponentsProvider._online)):(H(qt,"Using default OnlineComponentProvider"),await jl(n,new Ks))),n._onlineComponents}function ey(n){return ih(n).then(e=>e.syncEngine)}async function Qs(n){const e=await ih(n),t=e.eventManager;return t.onListen=Og.bind(null,e.syncEngine),t.onUnlisten=zg.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Fg.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=jg.bind(null,e.syncEngine),t}function ty(n,e,t={}){const r=new Mt;return n.asyncQueue.enqueueAndForget(async()=>function(o,a,l,d,m){const y=new rh({next:k=>{y.xu(),a.enqueueAndForget(()=>Wu(o,A));const S=k.docs.has(l);!S&&k.fromCache?m.reject(new W(z.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&k.fromCache&&d&&d.source==="server"?m.reject(new W(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(k)},error:k=>m.reject(k)}),A=new Ku(zi(l.path),y,{includeMetadataChanges:!0,Qa:!0});return Gu(o,A)}(await Qs(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $l=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oh(n,e,t){if(!t)throw new W(z.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ny(n,e,t,r){if(e===!0&&r===!0)throw new W(z.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ql(n){if(!K.isDocumentKey(n))throw new W(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Hl(n){if(K.isDocumentKey(n))throw new W(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function zo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":X(12329,{type:typeof n})}function wt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new W(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=zo(n);throw new W(z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah="firestore.googleapis.com",Gl=!0;class Wl{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new W(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ah,this.ssl=Gl}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Gl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Bu;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Bp)throw new W(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ny("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=sh((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new W(z.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new W(z.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new W(z.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xi{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new W(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new um;switch(r.type){case"firstParty":return new mm(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=$l.get(t);r&&(H("ComponentProvider","Removing Datastore"),$l.delete(t),r.terminate())}(this),Promise.resolve()}}function ry(n,e,t,r={}){var i;n=wt(n,Xi);const o=po(e),a=n._getSettings(),l=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),d=`${e}:${t}`;o&&(Ld(`https://${d}`),Ud("Firestore",!0)),a.host!==ah&&a.host!==d&&An("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const m=Object.assign(Object.assign({},a),{host:d,ssl:o,emulatorOptions:r});if(!gi(m,l)&&(n._setSettings(m),r.mockUserToken)){let y,A;if(typeof r.mockUserToken=="string")y=r.mockUserToken,A=Ye.MOCK_USER;else{y=Md(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const k=r.mockUserToken.sub||r.mockUserToken.user_id;if(!k)throw new W(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");A=new Ye(k)}n._authCredentials=new hm(new Wc(y,A))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Yi(this.firestore,e,this._query)}}class tt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tt(this.firestore,e,this._key)}}class Ot extends Yi{constructor(e,t,r){super(e,t,zi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tt(this.firestore,null,new K(e))}withConverter(e){return new Ot(this.firestore,e,this._path)}}function hr(n,e,...t){if(n=bn(n),oh("collection","path",e),n instanceof Xi){const r=Ae.fromString(e,...t);return Hl(r),new Ot(n,null,r)}{if(!(n instanceof tt||n instanceof Ot))throw new W(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return Hl(r),new Ot(n.firestore,null,r)}}function jo(n,e,...t){if(n=bn(n),arguments.length===1&&(e=Qc.newId()),oh("doc","path",e),n instanceof Xi){const r=Ae.fromString(e,...t);return ql(r),new tt(n,null,new K(r))}{if(!(n instanceof tt||n instanceof Ot))throw new W(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return ql(r),new tt(n.firestore,n instanceof Ot?n.converter:null,new K(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kl="AsyncQueue";class Ql{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new Ou(this,"async_queue_retry"),this.rc=()=>{const r=_s();r&&H(Kl,"Visibility state changed to "+r.visibilityState),this.x_.b_()},this.sc=e;const t=_s();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=_s();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const t=new Mt;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!Mn(e))throw e;H(Kl,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const t=this.sc.then(()=>(this.ec=!0,e().catch(r=>{throw this.Xu=r,this.ec=!1,bt("INTERNAL UNHANDLED ERROR: ",Xl(r)),r}).then(r=>(this.ec=!1,r))));return this.sc=t,t}enqueueAfterDelay(e,t,r){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const i=Lo.createAndSchedule(this,e,t,r,o=>this.uc(o));return this.Zu.push(i),i}oc(){this.Xu&&X(47125,{cc:Xl(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function Xl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}class Pn extends Xi{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Ql,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ql(e),this._firestoreClient=void 0,await e}}}function iy(n,e){const t=typeof n=="object"?n:Yf(),r=typeof n=="string"?n:Ei,i=Gf(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const o=Bd("firestore");o&&ry(i,...o)}return i}function $o(n){if(n._terminated)throw new W(z.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||sy(n),n._firestoreClient}function sy(n){var e,t,r;const i=n._freezeSettings(),o=function(l,d,m,y){return new Rm(l,d,m,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,sh(y.experimentalLongPollingOptions),y.useFetchStreams,y.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Jg(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(l){const d=l?._online.build();return{_offline:l?._offline.build(d),_online:d}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Dn(Ge.fromBase64String(e))}catch(t){throw new W(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Dn(Ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new W(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new He(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new W(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new W(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy=/^__.*__$/;class ay{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ln(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ir(e,this.data,t,this.fieldTransforms)}}function ch(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw X(40011,{Ic:n})}}class Wo{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Ec(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new Wo(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:r,Rc:!1});return i.Vc(e),i}mc(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.dc({path:r,Rc:!1});return i.Ec(),i}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return xi(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(ch(this.Ic)&&oy.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class ly{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Wi(e)}bc(e,t,r,i=!1){return new Wo({Ic:e,methodName:t,wc:r,path:He.emptyPath(),Rc:!1,yc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cy(n){const e=n._freezeSettings(),t=Wi(n._databaseId);return new ly(n._databaseId,!!e.ignoreUndefinedProperties,t)}function uy(n,e,t,r,i,o={}){const a=n.bc(o.merge||o.mergeFields?2:0,e,t,i);fh("Data must be an object, but it was:",a,r);const l=hh(r,a);let d,m;if(o.merge)d=new ut(a.fieldMask),m=a.fieldTransforms;else if(o.mergeFields){const y=[];for(const A of o.mergeFields){const k=hy(e,A,t);if(!a.contains(k))throw new W(z.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);fy(y,k)||y.push(k)}d=new ut(y),m=a.fieldTransforms.filter(A=>d.covers(A.field))}else d=null,m=a.fieldTransforms;return new ay(new it(l),d,m)}function uh(n,e){if(dh(n=bn(n)))return fh("Unsupported field value:",e,n),hh(n,e);if(n instanceof lh)return function(r,i){if(!ch(i.Ic))throw i.gc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.gc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(r,i){const o=[];let a=0;for(const l of r){let d=uh(l,i.fc(a));d==null&&(d={nullValue:"NULL_VALUE"}),o.push(d),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=bn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Zm(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Le.fromDate(r);return{timestampValue:Ci(i.serializer,o)}}if(r instanceof Le){const o=new Le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ci(i.serializer,o)}}if(r instanceof Ho)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Dn)return{bytesValue:Su(i.serializer,r._byteString)};if(r instanceof tt){const o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.gc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:So(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Go)return function(a,l){return{mapValue:{fields:{[ru]:{stringValue:iu},[Ti]:{arrayValue:{values:a.toArray().map(m=>{if(typeof m!="number")throw l.gc("VectorValues must only contain numeric values.");return Io(l.serializer,m)})}}}}}}(r,i);throw i.gc(`Unsupported field value: ${zo(r)}`)}(n,e)}function hh(n,e){const t={};return Yc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):on(n,(r,i)=>{const o=uh(i,e.Ac(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function dh(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Le||n instanceof Ho||n instanceof Dn||n instanceof tt||n instanceof lh||n instanceof Go)}function fh(n,e,t){if(!dh(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=zo(t);throw r==="an object"?e.gc(n+" a custom object"):e.gc(n+" "+r)}}function hy(n,e,t){if((e=bn(e))instanceof qo)return e._internalPath;if(typeof e=="string")return mh(n,e);throw xi("Field path arguments must be of type string or ",n,!1,void 0,t)}const dy=new RegExp("[~\\*/\\[\\]]");function mh(n,e,t){if(e.search(dy)>=0)throw xi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qo(...e.split("."))._internalPath}catch{throw xi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xi(n,e,t,r,i){const o=r&&!r.isEmpty(),a=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(o||a)&&(d+=" (found",o&&(d+=` in field ${r}`),a&&(d+=` in document ${i}`),d+=")"),new W(z.INVALID_ARGUMENT,l+n+d)}function fy(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new tt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new my(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(gh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class my extends ph{data(){return super.data()}}function gh(n,e){return typeof e=="string"?mh(n,e):e instanceof qo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function py(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new W(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class gy{convertValue(e,t="none"){switch(jt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(zt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return on(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;const o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Ti].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>Pe(a.doubleValue));return new Go(o)}convertGeoPoint(e){return new Ho(Pe(e.latitude),Pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Fi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(_r(e));default:return null}}convertTimestamp(e){const t=Ut(e);return new Le(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ae.fromString(e);me(Vu(r),9688,{name:e});const i=new vr(r.get(1),r.get(3)),o=new K(r.popFirst(5));return i.isEqual(t)||bt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yy(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yh extends ph{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ii(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(gh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ii extends yh{data(e={}){return super.data(e)}}class _y{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new rr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ii(this._firestore,this._userDataWriter,r.key,r,new rr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{const d=new ii(i._firestore,i._userDataWriter,l.doc.key,l.doc,new rr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{const d=new ii(i._firestore,i._userDataWriter,l.doc.key,l.doc,new rr(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,y=-1;return l.type!==0&&(m=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),y=a.indexOf(l.doc.key)),{type:vy(l.type),doc:d,oldIndex:m,newIndex:y}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function vy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ey(n){n=wt(n,tt);const e=wt(n.firestore,Pn);return ty($o(e),n._key).then(t=>Th(e,n,t))}class _h extends gy{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tt(this.firestore,null,t)}}function Ko(n,e,t){n=wt(n,tt);const r=wt(n.firestore,Pn),i=yy(n.converter,e,t);return Eh(r,[uy(cy(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,pt.none())])}function Ty(n){return Eh(wt(n.firestore,Pn),[new bo(n._key,pt.none())])}function vh(n,...e){var t,r,i;n=bn(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Yl(e[a])||(o=e[a],a++);const l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Yl(e[a])){const A=e[a];e[a]=(t=A.next)===null||t===void 0?void 0:t.bind(A),e[a+1]=(r=A.error)===null||r===void 0?void 0:r.bind(A),e[a+2]=(i=A.complete)===null||i===void 0?void 0:i.bind(A)}let d,m,y;if(n instanceof tt)m=wt(n.firestore,Pn),y=zi(n._key.path),d={next:A=>{e[a]&&e[a](Th(m,n,A))},error:e[a+1],complete:e[a+2]};else{const A=wt(n,Yi);m=wt(A.firestore,Pn),y=A._query;const k=new _h(m);d={next:S=>{e[a]&&e[a](new _y(m,k,A,S))},error:e[a+1],complete:e[a+2]},py(n._query)}return function(k,S,P,B){const O=new rh(B),q=new Ku(S,O,P);return k.asyncQueue.enqueueAndForget(async()=>Gu(await Qs(k),q)),()=>{O.xu(),k.asyncQueue.enqueueAndForget(async()=>Wu(await Qs(k),q))}}($o(m),y,l,d)}function Eh(n,e){return function(r,i){const o=new Mt;return r.asyncQueue.enqueueAndForget(async()=>$g(await ey(r),i,o)),o.promise}($o(n),e)}function Th(n,e,t){const r=t.docs.get(e._key),i=new _h(n);return new yh(n,i,e._key,r,new rr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Nn=i})(Xf),_i(new pr("firestore",(r,{instanceIdentifier:i,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new Pn(new dm(r.getProvider("auth-internal")),new pm(a,r.getProvider("app-check-internal")),function(m,y){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new W(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vr(m.options.projectId,y)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),wn(tl,nl,e),wn(tl,nl,"esm2017")})();const wy={apiKey:"AIzaSyAURA1Os8rPj_ov0ofDs-BCyO3aKhibhtw",authDomain:"webrtc-tutorial-81613.firebaseapp.com",projectId:"webrtc-tutorial-81613",storageBucket:"webrtc-tutorial-81613.firebasestorage.app",messagingSenderId:"911640820129",appId:"1:911640820129:web:b7102245c80e146013b3e0",measurementId:"G-68WFGEKPQB"},Iy=Mc(wy),wh=iy(Iy),by={hd:{width:1280,height:720},fhd:{width:1920,height:1080},fourK:{width:3840,height:2160}},Ay={iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:a.relay.metered.ca:80",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:80?transport=tcp",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:443",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"},{urls:"turn:a.relay.metered.ca:443?transport=tcp",username:"3c2899b6892a0dd428438fa2",credential:"UjVDP6QSI1bu0yiq"}],iceCandidatePoolSize:10};async function Cy(n,e,t){const r=en[n];if(document.visibilityState!=="visible"||!r||r.readyState!=="live"){console.warn(`SENDER: Cannot apply PTZ to ${n}. Page not visible or track not live.`);return}console.log(`SENDER: Applying to ${n} - type: ${e}, value: ${t}`);try{await r.applyConstraints({advanced:[{[e]:t}]})}catch(i){console.error(`SENDER: Error applying ${e} constraint to ${n}:`,i)}}function Ih(n){console.log(`RECEIVER: Updating PTZ controls for ${n}`),id(n);const e=Pi[n];["zoom","pan","tilt"].forEach(t=>{const r=!!(e&&e[t]),i=document.getElementById(`${t}Slider`),o=document.getElementById(`${t}Value`);if(document.querySelectorAll(`button[id$="${t.charAt(0).toUpperCase()+t.slice(1)}Btn"]`).forEach(a=>a.disabled=!r),i&&(i.disabled=!r),r){const{min:a,max:l,step:d}=e[t];i.min=a,i.max=l,i.step=d;const m=parseFloat(i.value);i.value=Math.max(a,Math.min(l,m)),o.textContent=parseFloat(i.value).toFixed(2)}else o&&(o.textContent="N/A")})}function xe(n,e){const t=Di,r=Pi[t];if(ge?.connectionState!=="connected"||dr?.readyState!=="open"){console.warn("RECEIVER: Cannot send command. Connection not ready.");return}if(!r||!r[n]){console.warn(`RECEIVER: PTZ type '${n}' is not supported for ${t}.`);return}const{min:i,max:o}=r[n],a=Math.max(i,Math.min(o,e)),l={type:"command",target:t,command:n,value:a};try{dr.send(JSON.stringify(l)),document.getElementById(`${n}Slider`).value=a,document.getElementById(`${n}Value`).textContent=a.toFixed(2)}catch(d){console.error("RECEIVER: Error sending command via DataChannel:",d)}}function Sy(){const n=ge.createDataChannel("ptz");to(n),n.onopen=()=>{console.log("SENDER: DataChannel is open. Sending capabilities...");const e={camera1:en.camera1.getCapabilities(),camera2:en.camera2.getCapabilities()},t={camera1:{zoom:e.camera1.zoom,pan:e.camera1.pan,tilt:e.camera1.tilt},camera2:{zoom:e.camera2.zoom,pan:e.camera2.pan,tilt:e.camera2.tilt}};n.send(JSON.stringify({type:"capabilities",data:t}))},n.onmessage=e=>{const t=JSON.parse(e.data);t.type==="command"&&en[t.target]&&Cy(t.target,t.command,t.value)},n.onclose=()=>console.log("SENDER: DataChannel is closed."),n.onerror=e=>console.error("SENDER: DataChannel error:",e)}function ky(n){if(n.channel.label!=="ptz")return;const e=n.channel;to(e),e.onopen=()=>console.log("RECEIVER: DataChannel is open."),e.onmessage=t=>{const r=JSON.parse(t.data);r.type==="capabilities"&&(td(r.data),li.style.display="block",Ih(Di))},e.onclose=()=>{li.style.display="none"},e.onerror=t=>console.error("RECEIVER: DataChannel error:",t)}async function Ry(){if(!(!ge||sn!=="receiver"||ge.connectionState!=="connected"))try{const n=await ge.getStats();Tn&&Object.values(Tn).forEach(e=>{e&&e.displayElement&&(e.displayElement.style.display="none")}),n.forEach(e=>{if(e.type==="inbound-rtp"&&e.mediaType==="video"&&Tn){const t=Tn[e.trackIdentifier];t&&t.displayElement&&e.frameWidth&&e.frameHeight&&(t.displayElement.textContent=`${e.frameWidth} x ${e.frameHeight}`,t.displayElement.style.display="block")}})}catch(n){console.error("Error getting stats for resolution display:",n)}}function xy(n,e){const t=en.camera1?.id,r=en.camera2?.id,i=new Map;n.forEach(o=>{o.type==="media-source"&&i.set(o.id,o.trackIdentifier)}),n.forEach(o=>{if(o.type==="outbound-rtp"&&o.mediaType==="video"){const a=i.get(o.mediaSourceId);if(!a)return;let l;if(a===t?l="camera1":a===r&&(l="camera2"),l){const d=Ys?.get(o.id),m=o.bytesSent-(d?.bytesSent??0),y=o.packetsSent-(d?.packetsSent??0);e[`${l}_sent_resolution`]=`${o.frameWidth}x${o.frameHeight}`,e[`${l}_sent_fps`]=o.framesPerSecond,e[`${l}_sent_bitrate_kbps`]=Math.round(Math.max(0,m)*8/1e3),e[`${l}_packets_sent_per_second`]=Math.max(0,y),e[`${l}_total_encode_time_s`]=o.totalEncodeTime,e[`${l}_keyframes_encoded`]=o.keyFramesEncoded,e[`${l}_quality_limitation_reason`]=o.qualityLimitationReason,e[`${l}_quality_limitation_resolution_changes`]=o.qualityLimitationResolutionChanges,e[`${l}_retransmitted_packets_sent`]=o.retransmittedPacketsSent,e[`${l}_nack_count`]=o.nackCount}}if(o.type==="remote-inbound-rtp"&&o.mediaType==="video"&&(e.receiver_jitter_ms=(o.jitter*1e3).toFixed(4)??"N/A",e.receiver_packets_lost=o.packetsLost,e.receiver_fraction_lost=o.fractionLost,e.rtt_rtcp_ms=(o.roundTripTime*1e3).toFixed(4)??"N/A"),o.type==="candidate-pair"&&o.nominated&&o.state==="succeeded"){e.available_outgoing_bitrate_kbps=o.availableOutgoingBitrate?Math.round(o.availableOutgoingBitrate/1e3):"N/A",e.rtt_ice_ms=(o.currentRoundTripTime*1e3).toFixed(4)??"N/A";const a=n.get(o.remoteCandidateId);a&&a.candidateType&&(e.connection_type=a.candidateType)}})}function Py(n,e){n.forEach(t=>{if(t.type==="inbound-rtp"&&t.mediaType==="video"){const r=Tn[t.trackIdentifier],i=r?r.name:null;if(i){const o=Ys?.get(t.id),a=t.bytesReceived-(o?.bytesReceived??0),l=t.packetsReceived-(o?.packetsReceived??0);e[`${i}_received_resolution`]=`${t.frameWidth}x${t.frameHeight}`,e[`${i}_received_fps`]=t.framesPerSecond,e[`${i}_received_bitrate_kbps`]=Math.round(Math.max(0,a)*8/1e3),e[`${i}_packets_received_per_second`]=Math.max(0,l),e[`${i}_jitter_ms`]=(t.jitter*1e3).toFixed(4)??"N/A",e[`${i}_packets_lost`]=t.packetsLost,e[`${i}_frames_dropped`]=t.framesDropped,e[`${i}_total_decode_time_s`]=t.totalDecodeTime,e[`${i}_keyframes_decoded`]=t.keyFramesDecoded,e[`${i}_jitter_buffer_delay_s`]=t.jitterBufferDelay,e[`${i}_fir_count`]=t.firCount,e[`${i}_pli_count`]=t.pliCount,e[`${i}_jitter_buffer_emitted_count`]=t.jitterBufferEmittedCount}}if(t.type==="candidate-pair"&&t.nominated&&t.state==="succeeded"){const r=n.get(t.remoteCandidateId);r&&r.candidateType&&(e.connection_type=r.candidateType)}})}function bh(){if(!ge||Xs)return;wc(!0),Tc([]),si(null),Bi.disabled=!0,Ni.disabled=!1,Li.disabled=!0,mi.textContent="記録中...";const n=setInterval(async()=>{if(!ge)return;const e=await ge.getStats(),t={timestamp:new Date().toISOString()};sn==="sender"?xy(e,t):Py(e,t),Object.keys(t).length>1&&(Dt.push(t),mi.textContent=`記録中... ${Dt.length} 個`),si(e)},1e3);nd(n)}function Qo(){Xs&&(clearInterval(yc),wc(!1),si(null),Bi.disabled=!1,Ni.disabled=!0,Li.disabled=Dt.length===0,mi.textContent=`記録停止。${Dt.length} 個`)}function Dy(){if(Dt.length===0){alert("ダウンロードするデータがありません");return}const n=new Set;Dt.forEach(l=>Object.keys(l).forEach(d=>n.add(d)));const e=Array.from(n),r=[e.join(","),...Dt.map(l=>e.map(d=>{const m=l[d]??"";return typeof m=="string"&&m.includes(",")?`"${m.replace(/"/g,'""')}"`:m}).join(","))].join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download=`webrtc_stats_${sn}_${new Date().toISOString().replace(/[:.]/g,"-")}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function Vy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Rt={},Xt={},Es={},Jl;function By(){return Jl||(Jl=1,Object.defineProperty(Es,"__esModule",{value:!0})),Es}var Wr={},Kr={},Zl;function Ah(){return Zl||(Zl=1,function(n){(function(e){var t="undefined",r=t!==typeof Buffer&&Buffer,i=t!==typeof Uint8Array&&Uint8Array,o=t!==typeof ArrayBuffer&&ArrayBuffer,a=[0,0,0,0,0,0,0,0],l=Array.isArray||U,d=4294967296,m=16777216,y;A("Uint64BE",!0,!0),A("Int64BE",!0,!1),A("Uint64LE",!1,!0),A("Int64LE",!1,!1);function A(b,g,E){var _=g?0:4,w=g?4:0,C=g?0:3,I=g?1:2,Y=g?2:1,ae=g?3:0,we=g?$:M,Ee=g?G:N,Ie=ue.prototype,je="is"+b,st="_"+je;return Ie.buffer=void 0,Ie.offset=0,Ie[st]=!0,Ie.toNumber=Ve,Ie.toString=ot,Ie.toJSON=Ve,Ie.toArray=k,r&&(Ie.toBuffer=S),i&&(Ie.toArrayBuffer=P),ue[je]=Z,e[b]=ue,ue;function ue(te,Q,J,re){return this instanceof ue?ye(this,te,Q,J,re):new ue(te,Q,J,re)}function Z(te){return!!(te&&te[st])}function ye(te,Q,J,re,de){if(i&&o&&(Q instanceof o&&(Q=new i(Q)),re instanceof o&&(re=new i(re))),!Q&&!J&&!re&&!y){te.buffer=q(a,0);return}if(!B(Q,J)){var ke=y||Array;de=J,re=Q,J=0,Q=y===r?r.alloc(8):new ke(8)}te.buffer=Q,te.offset=J|=0,t!==typeof re&&(typeof re=="string"?Ce(Q,J,re,de||10):B(re,de)?O(Q,J,re,de):typeof de=="number"?(We(Q,J+_,re),We(Q,J+w,de)):re>0?we(Q,J,re):re<0?Ee(Q,J,re):O(Q,J,a,0))}function Ce(te,Q,J,re){var de=0,ke=J.length,Oe=0,Fe=0;J[0]==="-"&&de++;for(var at=de;de<ke;){var ht=parseInt(J[de++],re);if(!(ht>=0))break;Fe=Fe*re+ht,Oe=Oe*re+Math.floor(Fe/d),Fe%=d}at&&(Oe=~Oe,Fe?Fe=d-Fe:Oe++),We(te,Q+_,Oe),We(te,Q+w,Fe)}function Ve(){var te=this.buffer,Q=this.offset,J=Be(te,Q+_),re=Be(te,Q+w);return E||(J|=0),J?J*d+re:re}function ot(te){var Q=this.buffer,J=this.offset,re=Be(Q,J+_),de=Be(Q,J+w),ke="",Oe=!E&&re&2147483648;for(Oe&&(re=~re,de=d-de),te=te||10;;){var Fe=re%te*d+de;if(re=Math.floor(re/te),de=Math.floor(Fe/te),ke=(Fe%te).toString(te)+ke,!re&&!de)break}return Oe&&(ke="-"+ke),ke}function We(te,Q,J){te[Q+ae]=J&255,J=J>>8,te[Q+Y]=J&255,J=J>>8,te[Q+I]=J&255,J=J>>8,te[Q+C]=J&255}function Be(te,Q){return te[Q+C]*m+(te[Q+I]<<16)+(te[Q+Y]<<8)+te[Q+ae]}}function k(b){var g=this.buffer,E=this.offset;return y=null,b!==!1&&l(g)?g.length===8?g:g.slice(E,E+8):q(g,E)}function S(b){var g=this.buffer,E=this.offset;return y=r,b!==!1&&r.isBuffer(g)?g.length===8?g:g.slice(E,E+8):r.from(P.call(this,b))}function P(b){var g=this.buffer,E=this.offset,_=g.buffer;if(y=i,b!==!1&&!g.offset&&_ instanceof o)return _.byteLength===8?_:_.slice(E,E+8);var w=new i(8);return O(w,0,g,E),w.buffer}function B(b,g){var E=b&&b.length;return g|=0,E&&g+8<=E&&typeof b[g]!="string"}function O(b,g,E,_){g|=0,_|=0;for(var w=0;w<8;w++)b[g++]=E[_++]&255}function q(b,g){return Array.prototype.slice.call(b,g,g+8)}function $(b,g,E){for(var _=g+8;_>g;)b[--_]=E&255,E/=256}function G(b,g,E){var _=g+8;for(E++;_>g;)b[--_]=-E&255^255,E/=256}function M(b,g,E){for(var _=g+8;g<_;)b[g++]=E&255,E/=256}function N(b,g,E){var _=g+8;for(E++;g<_;)b[g++]=-E&255^255,E/=256}function U(b){return!!b&&Object.prototype.toString.call(b)=="[object Array]"}})(typeof n.nodeName!="string"?n:Kr||{})}(Kr)),Kr}var Ts={},Qr={},Jn={},ec;function Ch(){return ec||(ec=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.byEbmlID=void 0,Jn.byEbmlID={128:{name:"ChapterDisplay",level:4,type:"m",multiple:!0,minver:1,webm:!0,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:!0,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:!0,minver:1,webm:!0,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:!0,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:!0,multiple:!0,minver:1,webm:!1,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:!0,minver:1,webm:!0,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:!1,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:!0,minver:2,webm:!1,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:!0,webm:!1,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:!1,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:!0,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:!0,minver:1,webm:!1,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:!1,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:!1,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:!0,minver:1,webm:!1,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:!0,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:!1,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:!1,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:!1,minver:3,webm:!0,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:!1,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:!0,webm:!1,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:!0,minver:1,webm:!1,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:!0,minver:1,webm:!1,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:!0,minver:1,webm:!1,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:!0,minver:1,webm:!1,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:!0,minver:1,webm:!1,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:!1,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:!0,minver:1,webm:!1,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:!0,minver:1,webm:!1,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:!1,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:!1,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:!0,minver:1,webm:!1,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:!0,minver:1,webm:!1,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:!1,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:!0,minver:1,webm:!1,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:!0,multiple:!0,minver:1,webm:!0,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:!1,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:!1,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:!1,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:!1,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:!0,minver:1,webm:!0,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:!1,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:!1,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!0,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:!0,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:!0,minver:1,webm:!1,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:!1,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:!1,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:!1,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:!1,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:!0,minver:2,webm:!1,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:!1,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:!1,minver:4,webm:!1,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:!0,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:!1,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:!1,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:!1,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:!1,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:!1,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:!0,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:!0,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:!0,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:!0,multiple:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:!0,minver:3,webm:!1,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:!0,minver:3,webm:!1,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:!0,multiple:!0,minver:3,webm:!1,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:!1,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:!1,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:!1,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:!0,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:!0,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:!1,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:!1,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:!0,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:!1,divx:!1,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:!0,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:!0,minver:2,webm:!0,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:!0,multiple:!1,default:0,minver:4,webm:!0,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:!1,default:0,minver:4,webm:!0,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:!0,minver:2,webm:!1,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:!0,webm:!1,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:!1,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:!1,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:!0,minver:1,maxver:"3",webm:!1,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:`The period in nanoseconds (not scaled by TimcodeScale)
between two successive fields at the output of the decoding process (see the notes)`},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:!1,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:!0,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:!0,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:!0,minver:2,webm:!0,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:!0,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:!0,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:!0,webm:!1,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:!1,mandatory:!0,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:!1,minver:0,webm:!1,divx:!0,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:!1,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:!0,minver:1,divx:!1,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:!1,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:!0,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:!1,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:!1,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:!0,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:!0,minver:1,webm:!1,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:!0,minver:1,webm:!1,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:!0,minver:1,webm:!1,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:!0,multiple:!0,minver:1,webm:!1,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:!1,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:!1,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:!0,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:!0,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:!0,minver:2,webm:!0,divx:!0,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:!1,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:!0,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:!0,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:!0,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:!1,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:!0,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:!0,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:!0,minver:1,webm:!1,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:!0,minver:1,webm:!1,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:!0,minver:1,webm:!1,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:!1,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:!1,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:!1,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:!0,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:!0,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:!0,multiple:!0,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:!0,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:!0,webm:!1,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:!1,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:!1,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:!1,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:!1,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:!1,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:!0,webm:!1,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:!1,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:!0},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:!0,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:!0,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:!0,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:!0,multiple:!0,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."},21936:{name:"Colour",level:"4",type:"m",mandatory:!0,multiple:!0,description:"Settings describing the colour format."},21937:{name:"MatrixCoefficients",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The Matrix Coefficients of the video used to derive luma and chroma values from red, green, and blue color primaries. For clarity, the value and meanings for MatrixCoefficients are adopted from Table 4 of ISO/IEC 23001-8:2016 or ITU-T H.273."},21945:{name:"Range",level:"5",type:"u",mandatory:!0,multiple:!0,description:"Clipping of the color ranges."},21946:{name:"TransferCharacteristics",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The transfer characteristics of the video."},21947:{name:"Primaries",level:"5",type:"u",mandatory:!0,multiple:!0,description:"The colour primaries of the video. For clarity, the value and meanings for Primaries are adopted from Table 2 of ISO/IEC 23091-4 or ITU-T H.273."}}),Jn}var tc;function Sh(){if(tc)return Qr;tc=1,Object.defineProperty(Qr,"__esModule",{value:!0});var n=rn(),e=rn(),t=Ch(),r=function(){function i(){this._schema=t.byEbmlID,this._buffers=[],this._stack=[]}return i.prototype.encode=function(o){var a=this;return n.concat(o.reduce(function(l,d){return l.concat(a.encodeChunk(d))},[])).buffer},i.prototype.encodeChunk=function(o){return o.type==="m"?o.isEnd?this.endTag(o):this.startTag(o):(o.data=e.Buffer.from(o.data),this.writeTag(o)),this.flush()},i.prototype.flush=function(){var o=this._buffers;return this._buffers=[],o},i.prototype.getSchemaInfo=function(o){for(var a=Object.keys(this._schema).map(Number),l=0;l<a.length;l++){var d=a[l];if(this._schema[d].name===o)return new e.Buffer(d.toString(16),"hex")}return null},i.prototype.writeTag=function(o){var a=o.name,l=this.getSchemaInfo(a),d=o.data;if(l==null)throw new Error("No schema entry found for "+a);var m=n.encodeTag(l,d);if(this._stack.length>0){var y=this._stack[this._stack.length-1];y.children.push({tagId:l,elm:o,children:[],data:m});return}this._buffers=this._buffers.concat(m)},i.prototype.startTag=function(o){var a=o.name,l=this.getSchemaInfo(a);if(l==null)throw new Error("No schema entry found for "+a);if(o.unknownSize){var d=n.encodeTag(l,new e.Buffer(0),o.unknownSize);this._buffers=this._buffers.concat(d);return}var m={tagId:l,elm:o,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(m),this._stack.push(m)},i.prototype.endTag=function(o){o.name;var a=this._stack.pop();if(a==null)throw new Error("EBML structure is broken");if(a.elm.name!==o.name)throw new Error("EBML structure is broken");var l=a.children.reduce(function(m,y){if(y.data===null)throw new Error("EBML structure is broken");return m.concat(y.data)},[]),d=n.concat(l);a.elm.type==="m"?a.data=n.encodeTag(a.tagId,d,a.elm.unknownSize):a.data=n.encodeTag(a.tagId,d),this._stack.length<1&&(this._buffers=this._buffers.concat(a.data))},i}();return Qr.default=r,Qr}var ws={},Zn={},nc;function Ny(){if(nc)return Zn;nc=1,Zn.byteLength=l,Zn.toByteArray=m,Zn.fromByteArray=k;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=r.length;i<o;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function a(S){var P=S.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var B=S.indexOf("=");B===-1&&(B=P);var O=B===P?0:4-B%4;return[B,O]}function l(S){var P=a(S),B=P[0],O=P[1];return(B+O)*3/4-O}function d(S,P,B){return(P+B)*3/4-B}function m(S){var P,B=a(S),O=B[0],q=B[1],$=new t(d(S,O,q)),G=0,M=q>0?O-4:O,N;for(N=0;N<M;N+=4)P=e[S.charCodeAt(N)]<<18|e[S.charCodeAt(N+1)]<<12|e[S.charCodeAt(N+2)]<<6|e[S.charCodeAt(N+3)],$[G++]=P>>16&255,$[G++]=P>>8&255,$[G++]=P&255;return q===2&&(P=e[S.charCodeAt(N)]<<2|e[S.charCodeAt(N+1)]>>4,$[G++]=P&255),q===1&&(P=e[S.charCodeAt(N)]<<10|e[S.charCodeAt(N+1)]<<4|e[S.charCodeAt(N+2)]>>2,$[G++]=P>>8&255,$[G++]=P&255),$}function y(S){return n[S>>18&63]+n[S>>12&63]+n[S>>6&63]+n[S&63]}function A(S,P,B){for(var O,q=[],$=P;$<B;$+=3)O=(S[$]<<16&16711680)+(S[$+1]<<8&65280)+(S[$+2]&255),q.push(y(O));return q.join("")}function k(S){for(var P,B=S.length,O=B%3,q=[],$=16383,G=0,M=B-O;G<M;G+=$)q.push(A(S,G,G+$>M?M:G+$));return O===1?(P=S[B-1],q.push(n[P>>2]+n[P<<4&63]+"==")):O===2&&(P=(S[B-2]<<8)+S[B-1],q.push(n[P>>10]+n[P>>4&63]+n[P<<2&63]+"=")),q.join("")}return Zn}var Xr={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var rc;function Ly(){return rc||(rc=1,Xr.read=function(n,e,t,r,i){var o,a,l=i*8-r-1,d=(1<<l)-1,m=d>>1,y=-7,A=t?i-1:0,k=t?-1:1,S=n[e+A];for(A+=k,o=S&(1<<-y)-1,S>>=-y,y+=l;y>0;o=o*256+n[e+A],A+=k,y-=8);for(a=o&(1<<-y)-1,o>>=-y,y+=r;y>0;a=a*256+n[e+A],A+=k,y-=8);if(o===0)o=1-m;else{if(o===d)return a?NaN:(S?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-m}return(S?-1:1)*a*Math.pow(2,o-r)},Xr.write=function(n,e,t,r,i,o){var a,l,d,m=o*8-i-1,y=(1<<m)-1,A=y>>1,k=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=r?0:o-1,P=r?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=y):(a=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-a))<1&&(a--,d*=2),a+A>=1?e+=k/d:e+=k*Math.pow(2,1-A),e*d>=2&&(a++,d/=2),a+A>=y?(l=0,a=y):a+A>=1?(l=(e*d-1)*Math.pow(2,i),a=a+A):(l=e*Math.pow(2,A-1)*Math.pow(2,i),a=0));i>=8;n[t+S]=l&255,S+=P,l/=256,i-=8);for(a=a<<i|l,m+=i;m>0;n[t+S]=a&255,S+=P,a/=256,m-=8);n[t+S-P]|=B*128}),Xr}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var ic;function My(){return ic||(ic=1,function(n){const e=Ny(),t=Ly(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=$,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,l.TYPED_ARRAY_SUPPORT=o(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{const p=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(p,u),p.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function a(p){if(p>i)throw new RangeError('The value "'+p+'" is invalid for option "size"');const u=new Uint8Array(p);return Object.setPrototypeOf(u,l.prototype),u}function l(p,u,h){if(typeof p=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return A(p)}return d(p,u,h)}l.poolSize=8192;function d(p,u,h){if(typeof p=="string")return k(p,u);if(ArrayBuffer.isView(p))return P(p);if(p==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p);if(rt(p,ArrayBuffer)||p&&rt(p.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(rt(p,SharedArrayBuffer)||p&&rt(p.buffer,SharedArrayBuffer)))return B(p,u,h);if(typeof p=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const T=p.valueOf&&p.valueOf();if(T!=null&&T!==p)return l.from(T,u,h);const R=O(p);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof p[Symbol.toPrimitive]=="function")return l.from(p[Symbol.toPrimitive]("string"),u,h);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p)}l.from=function(p,u,h){return d(p,u,h)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function m(p){if(typeof p!="number")throw new TypeError('"size" argument must be of type number');if(p<0)throw new RangeError('The value "'+p+'" is invalid for option "size"')}function y(p,u,h){return m(p),p<=0?a(p):u!==void 0?typeof h=="string"?a(p).fill(u,h):a(p).fill(u):a(p)}l.alloc=function(p,u,h){return y(p,u,h)};function A(p){return m(p),a(p<0?0:q(p)|0)}l.allocUnsafe=function(p){return A(p)},l.allocUnsafeSlow=function(p){return A(p)};function k(p,u){if((typeof u!="string"||u==="")&&(u="utf8"),!l.isEncoding(u))throw new TypeError("Unknown encoding: "+u);const h=G(p,u)|0;let T=a(h);const R=T.write(p,u);return R!==h&&(T=T.slice(0,R)),T}function S(p){const u=p.length<0?0:q(p.length)|0,h=a(u);for(let T=0;T<u;T+=1)h[T]=p[T]&255;return h}function P(p){if(rt(p,Uint8Array)){const u=new Uint8Array(p);return B(u.buffer,u.byteOffset,u.byteLength)}return S(p)}function B(p,u,h){if(u<0||p.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(p.byteLength<u+(h||0))throw new RangeError('"length" is outside of buffer bounds');let T;return u===void 0&&h===void 0?T=new Uint8Array(p):h===void 0?T=new Uint8Array(p,u):T=new Uint8Array(p,u,h),Object.setPrototypeOf(T,l.prototype),T}function O(p){if(l.isBuffer(p)){const u=q(p.length)|0,h=a(u);return h.length===0||p.copy(h,0,0,u),h}if(p.length!==void 0)return typeof p.length!="number"||Ht(p.length)?a(0):S(p);if(p.type==="Buffer"&&Array.isArray(p.data))return S(p.data)}function q(p){if(p>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return p|0}function $(p){return+p!=p&&(p=0),l.alloc(+p)}l.isBuffer=function(u){return u!=null&&u._isBuffer===!0&&u!==l.prototype},l.compare=function(u,h){if(rt(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),rt(h,Uint8Array)&&(h=l.from(h,h.offset,h.byteLength)),!l.isBuffer(u)||!l.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(u===h)return 0;let T=u.length,R=h.length;for(let D=0,L=Math.min(T,R);D<L;++D)if(u[D]!==h[D]){T=u[D],R=h[D];break}return T<R?-1:R<T?1:0},l.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(u,h){if(!Array.isArray(u))throw new TypeError('"list" argument must be an Array of Buffers');if(u.length===0)return l.alloc(0);let T;if(h===void 0)for(h=0,T=0;T<u.length;++T)h+=u[T].length;const R=l.allocUnsafe(h);let D=0;for(T=0;T<u.length;++T){let L=u[T];if(rt(L,Uint8Array))D+L.length>R.length?(l.isBuffer(L)||(L=l.from(L)),L.copy(R,D)):Uint8Array.prototype.set.call(R,L,D);else if(l.isBuffer(L))L.copy(R,D);else throw new TypeError('"list" argument must be an Array of Buffers');D+=L.length}return R};function G(p,u){if(l.isBuffer(p))return p.length;if(ArrayBuffer.isView(p)||rt(p,ArrayBuffer))return p.byteLength;if(typeof p!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof p);const h=p.length,T=arguments.length>2&&arguments[2]===!0;if(!T&&h===0)return 0;let R=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":return at(p).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h*2;case"hex":return h>>>1;case"base64":return dt(p).length;default:if(R)return T?-1:at(p).length;u=(""+u).toLowerCase(),R=!0}}l.byteLength=G;function M(p,u,h){let T=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0,u>>>=0,h<=u))return"";for(p||(p="utf8");;)switch(p){case"hex":return je(this,u,h);case"utf8":case"utf-8":return Y(this,u,h);case"ascii":return Ee(this,u,h);case"latin1":case"binary":return Ie(this,u,h);case"base64":return I(this,u,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return st(this,u,h);default:if(T)throw new TypeError("Unknown encoding: "+p);p=(p+"").toLowerCase(),T=!0}}l.prototype._isBuffer=!0;function N(p,u,h){const T=p[u];p[u]=p[h],p[h]=T}l.prototype.swap16=function(){const u=this.length;if(u%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<u;h+=2)N(this,h,h+1);return this},l.prototype.swap32=function(){const u=this.length;if(u%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<u;h+=4)N(this,h,h+3),N(this,h+1,h+2);return this},l.prototype.swap64=function(){const u=this.length;if(u%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<u;h+=8)N(this,h,h+7),N(this,h+1,h+6),N(this,h+2,h+5),N(this,h+3,h+4);return this},l.prototype.toString=function(){const u=this.length;return u===0?"":arguments.length===0?Y(this,0,u):M.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(u){if(!l.isBuffer(u))throw new TypeError("Argument must be a Buffer");return this===u?!0:l.compare(this,u)===0},l.prototype.inspect=function(){let u="";const h=n.INSPECT_MAX_BYTES;return u=this.toString("hex",0,h).replace(/(.{2})/g,"$1 ").trim(),this.length>h&&(u+=" ... "),"<Buffer "+u+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(u,h,T,R,D){if(rt(u,Uint8Array)&&(u=l.from(u,u.offset,u.byteLength)),!l.isBuffer(u))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof u);if(h===void 0&&(h=0),T===void 0&&(T=u?u.length:0),R===void 0&&(R=0),D===void 0&&(D=this.length),h<0||T>u.length||R<0||D>this.length)throw new RangeError("out of range index");if(R>=D&&h>=T)return 0;if(R>=D)return-1;if(h>=T)return 1;if(h>>>=0,T>>>=0,R>>>=0,D>>>=0,this===u)return 0;let L=D-R,ie=T-h;const _e=Math.min(L,ie),ve=this.slice(R,D),be=u.slice(h,T);for(let fe=0;fe<_e;++fe)if(ve[fe]!==be[fe]){L=ve[fe],ie=be[fe];break}return L<ie?-1:ie<L?1:0};function U(p,u,h,T,R){if(p.length===0)return-1;if(typeof h=="string"?(T=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,Ht(h)&&(h=R?0:p.length-1),h<0&&(h=p.length+h),h>=p.length){if(R)return-1;h=p.length-1}else if(h<0)if(R)h=0;else return-1;if(typeof u=="string"&&(u=l.from(u,T)),l.isBuffer(u))return u.length===0?-1:b(p,u,h,T,R);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(p,u,h):Uint8Array.prototype.lastIndexOf.call(p,u,h):b(p,[u],h,T,R);throw new TypeError("val must be string, number or Buffer")}function b(p,u,h,T,R){let D=1,L=p.length,ie=u.length;if(T!==void 0&&(T=String(T).toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(p.length<2||u.length<2)return-1;D=2,L/=2,ie/=2,h/=2}function _e(be,fe){return D===1?be[fe]:be.readUInt16BE(fe*D)}let ve;if(R){let be=-1;for(ve=h;ve<L;ve++)if(_e(p,ve)===_e(u,be===-1?0:ve-be)){if(be===-1&&(be=ve),ve-be+1===ie)return be*D}else be!==-1&&(ve-=ve-be),be=-1}else for(h+ie>L&&(h=L-ie),ve=h;ve>=0;ve--){let be=!0;for(let fe=0;fe<ie;fe++)if(_e(p,ve+fe)!==_e(u,fe)){be=!1;break}if(be)return ve}return-1}l.prototype.includes=function(u,h,T){return this.indexOf(u,h,T)!==-1},l.prototype.indexOf=function(u,h,T){return U(this,u,h,T,!0)},l.prototype.lastIndexOf=function(u,h,T){return U(this,u,h,T,!1)};function g(p,u,h,T){h=Number(h)||0;const R=p.length-h;T?(T=Number(T),T>R&&(T=R)):T=R;const D=u.length;T>D/2&&(T=D/2);let L;for(L=0;L<T;++L){const ie=parseInt(u.substr(L*2,2),16);if(Ht(ie))return L;p[h+L]=ie}return L}function E(p,u,h,T){return vt(at(u,p.length-h),p,h,T)}function _(p,u,h,T){return vt(ht(u),p,h,T)}function w(p,u,h,T){return vt(dt(u),p,h,T)}function C(p,u,h,T){return vt(un(u,p.length-h),p,h,T)}l.prototype.write=function(u,h,T,R){if(h===void 0)R="utf8",T=this.length,h=0;else if(T===void 0&&typeof h=="string")R=h,T=this.length,h=0;else if(isFinite(h))h=h>>>0,isFinite(T)?(T=T>>>0,R===void 0&&(R="utf8")):(R=T,T=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const D=this.length-h;if((T===void 0||T>D)&&(T=D),u.length>0&&(T<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");R||(R="utf8");let L=!1;for(;;)switch(R){case"hex":return g(this,u,h,T);case"utf8":case"utf-8":return E(this,u,h,T);case"ascii":case"latin1":case"binary":return _(this,u,h,T);case"base64":return w(this,u,h,T);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,u,h,T);default:if(L)throw new TypeError("Unknown encoding: "+R);R=(""+R).toLowerCase(),L=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(p,u,h){return u===0&&h===p.length?e.fromByteArray(p):e.fromByteArray(p.slice(u,h))}function Y(p,u,h){h=Math.min(p.length,h);const T=[];let R=u;for(;R<h;){const D=p[R];let L=null,ie=D>239?4:D>223?3:D>191?2:1;if(R+ie<=h){let _e,ve,be,fe;switch(ie){case 1:D<128&&(L=D);break;case 2:_e=p[R+1],(_e&192)===128&&(fe=(D&31)<<6|_e&63,fe>127&&(L=fe));break;case 3:_e=p[R+1],ve=p[R+2],(_e&192)===128&&(ve&192)===128&&(fe=(D&15)<<12|(_e&63)<<6|ve&63,fe>2047&&(fe<55296||fe>57343)&&(L=fe));break;case 4:_e=p[R+1],ve=p[R+2],be=p[R+3],(_e&192)===128&&(ve&192)===128&&(be&192)===128&&(fe=(D&15)<<18|(_e&63)<<12|(ve&63)<<6|be&63,fe>65535&&fe<1114112&&(L=fe))}}L===null?(L=65533,ie=1):L>65535&&(L-=65536,T.push(L>>>10&1023|55296),L=56320|L&1023),T.push(L),R+=ie}return we(T)}const ae=4096;function we(p){const u=p.length;if(u<=ae)return String.fromCharCode.apply(String,p);let h="",T=0;for(;T<u;)h+=String.fromCharCode.apply(String,p.slice(T,T+=ae));return h}function Ee(p,u,h){let T="";h=Math.min(p.length,h);for(let R=u;R<h;++R)T+=String.fromCharCode(p[R]&127);return T}function Ie(p,u,h){let T="";h=Math.min(p.length,h);for(let R=u;R<h;++R)T+=String.fromCharCode(p[R]);return T}function je(p,u,h){const T=p.length;(!u||u<0)&&(u=0),(!h||h<0||h>T)&&(h=T);let R="";for(let D=u;D<h;++D)R+=Fn[p[D]];return R}function st(p,u,h){const T=p.slice(u,h);let R="";for(let D=0;D<T.length-1;D+=2)R+=String.fromCharCode(T[D]+T[D+1]*256);return R}l.prototype.slice=function(u,h){const T=this.length;u=~~u,h=h===void 0?T:~~h,u<0?(u+=T,u<0&&(u=0)):u>T&&(u=T),h<0?(h+=T,h<0&&(h=0)):h>T&&(h=T),h<u&&(h=u);const R=this.subarray(u,h);return Object.setPrototypeOf(R,l.prototype),R};function ue(p,u,h){if(p%1!==0||p<0)throw new RangeError("offset is not uint");if(p+u>h)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(u,h,T){u=u>>>0,h=h>>>0,T||ue(u,h,this.length);let R=this[u],D=1,L=0;for(;++L<h&&(D*=256);)R+=this[u+L]*D;return R},l.prototype.readUintBE=l.prototype.readUIntBE=function(u,h,T){u=u>>>0,h=h>>>0,T||ue(u,h,this.length);let R=this[u+--h],D=1;for(;h>0&&(D*=256);)R+=this[u+--h]*D;return R},l.prototype.readUint8=l.prototype.readUInt8=function(u,h){return u=u>>>0,h||ue(u,1,this.length),this[u]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(u,h){return u=u>>>0,h||ue(u,2,this.length),this[u]|this[u+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(u,h){return u=u>>>0,h||ue(u,2,this.length),this[u]<<8|this[u+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),(this[u]|this[u+1]<<8|this[u+2]<<16)+this[u+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]*16777216+(this[u+1]<<16|this[u+2]<<8|this[u+3])},l.prototype.readBigUInt64LE=lt(function(u){u=u>>>0,de(u,"offset");const h=this[u],T=this[u+7];(h===void 0||T===void 0)&&ke(u,this.length-8);const R=h+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24,D=this[++u]+this[++u]*2**8+this[++u]*2**16+T*2**24;return BigInt(R)+(BigInt(D)<<BigInt(32))}),l.prototype.readBigUInt64BE=lt(function(u){u=u>>>0,de(u,"offset");const h=this[u],T=this[u+7];(h===void 0||T===void 0)&&ke(u,this.length-8);const R=h*2**24+this[++u]*2**16+this[++u]*2**8+this[++u],D=this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+T;return(BigInt(R)<<BigInt(32))+BigInt(D)}),l.prototype.readIntLE=function(u,h,T){u=u>>>0,h=h>>>0,T||ue(u,h,this.length);let R=this[u],D=1,L=0;for(;++L<h&&(D*=256);)R+=this[u+L]*D;return D*=128,R>=D&&(R-=Math.pow(2,8*h)),R},l.prototype.readIntBE=function(u,h,T){u=u>>>0,h=h>>>0,T||ue(u,h,this.length);let R=h,D=1,L=this[u+--R];for(;R>0&&(D*=256);)L+=this[u+--R]*D;return D*=128,L>=D&&(L-=Math.pow(2,8*h)),L},l.prototype.readInt8=function(u,h){return u=u>>>0,h||ue(u,1,this.length),this[u]&128?(255-this[u]+1)*-1:this[u]},l.prototype.readInt16LE=function(u,h){u=u>>>0,h||ue(u,2,this.length);const T=this[u]|this[u+1]<<8;return T&32768?T|4294901760:T},l.prototype.readInt16BE=function(u,h){u=u>>>0,h||ue(u,2,this.length);const T=this[u+1]|this[u]<<8;return T&32768?T|4294901760:T},l.prototype.readInt32LE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]|this[u+1]<<8|this[u+2]<<16|this[u+3]<<24},l.prototype.readInt32BE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),this[u]<<24|this[u+1]<<16|this[u+2]<<8|this[u+3]},l.prototype.readBigInt64LE=lt(function(u){u=u>>>0,de(u,"offset");const h=this[u],T=this[u+7];(h===void 0||T===void 0)&&ke(u,this.length-8);const R=this[u+4]+this[u+5]*2**8+this[u+6]*2**16+(T<<24);return(BigInt(R)<<BigInt(32))+BigInt(h+this[++u]*2**8+this[++u]*2**16+this[++u]*2**24)}),l.prototype.readBigInt64BE=lt(function(u){u=u>>>0,de(u,"offset");const h=this[u],T=this[u+7];(h===void 0||T===void 0)&&ke(u,this.length-8);const R=(h<<24)+this[++u]*2**16+this[++u]*2**8+this[++u];return(BigInt(R)<<BigInt(32))+BigInt(this[++u]*2**24+this[++u]*2**16+this[++u]*2**8+T)}),l.prototype.readFloatLE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),t.read(this,u,!0,23,4)},l.prototype.readFloatBE=function(u,h){return u=u>>>0,h||ue(u,4,this.length),t.read(this,u,!1,23,4)},l.prototype.readDoubleLE=function(u,h){return u=u>>>0,h||ue(u,8,this.length),t.read(this,u,!0,52,8)},l.prototype.readDoubleBE=function(u,h){return u=u>>>0,h||ue(u,8,this.length),t.read(this,u,!1,52,8)};function Z(p,u,h,T,R,D){if(!l.isBuffer(p))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>R||u<D)throw new RangeError('"value" argument is out of bounds');if(h+T>p.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(u,h,T,R){if(u=+u,h=h>>>0,T=T>>>0,!R){const ie=Math.pow(2,8*T)-1;Z(this,u,h,T,ie,0)}let D=1,L=0;for(this[h]=u&255;++L<T&&(D*=256);)this[h+L]=u/D&255;return h+T},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(u,h,T,R){if(u=+u,h=h>>>0,T=T>>>0,!R){const ie=Math.pow(2,8*T)-1;Z(this,u,h,T,ie,0)}let D=T-1,L=1;for(this[h+D]=u&255;--D>=0&&(L*=256);)this[h+D]=u/L&255;return h+T},l.prototype.writeUint8=l.prototype.writeUInt8=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,1,255,0),this[h]=u&255,h+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,2,65535,0),this[h]=u&255,this[h+1]=u>>>8,h+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,2,65535,0),this[h]=u>>>8,this[h+1]=u&255,h+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,4,4294967295,0),this[h+3]=u>>>24,this[h+2]=u>>>16,this[h+1]=u>>>8,this[h]=u&255,h+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,4,4294967295,0),this[h]=u>>>24,this[h+1]=u>>>16,this[h+2]=u>>>8,this[h+3]=u&255,h+4};function ye(p,u,h,T,R){re(u,T,R,p,h,7);let D=Number(u&BigInt(4294967295));p[h++]=D,D=D>>8,p[h++]=D,D=D>>8,p[h++]=D,D=D>>8,p[h++]=D;let L=Number(u>>BigInt(32)&BigInt(4294967295));return p[h++]=L,L=L>>8,p[h++]=L,L=L>>8,p[h++]=L,L=L>>8,p[h++]=L,h}function Ce(p,u,h,T,R){re(u,T,R,p,h,7);let D=Number(u&BigInt(4294967295));p[h+7]=D,D=D>>8,p[h+6]=D,D=D>>8,p[h+5]=D,D=D>>8,p[h+4]=D;let L=Number(u>>BigInt(32)&BigInt(4294967295));return p[h+3]=L,L=L>>8,p[h+2]=L,L=L>>8,p[h+1]=L,L=L>>8,p[h]=L,h+8}l.prototype.writeBigUInt64LE=lt(function(u,h=0){return ye(this,u,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=lt(function(u,h=0){return Ce(this,u,h,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(u,h,T,R){if(u=+u,h=h>>>0,!R){const _e=Math.pow(2,8*T-1);Z(this,u,h,T,_e-1,-_e)}let D=0,L=1,ie=0;for(this[h]=u&255;++D<T&&(L*=256);)u<0&&ie===0&&this[h+D-1]!==0&&(ie=1),this[h+D]=(u/L>>0)-ie&255;return h+T},l.prototype.writeIntBE=function(u,h,T,R){if(u=+u,h=h>>>0,!R){const _e=Math.pow(2,8*T-1);Z(this,u,h,T,_e-1,-_e)}let D=T-1,L=1,ie=0;for(this[h+D]=u&255;--D>=0&&(L*=256);)u<0&&ie===0&&this[h+D+1]!==0&&(ie=1),this[h+D]=(u/L>>0)-ie&255;return h+T},l.prototype.writeInt8=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,1,127,-128),u<0&&(u=255+u+1),this[h]=u&255,h+1},l.prototype.writeInt16LE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,2,32767,-32768),this[h]=u&255,this[h+1]=u>>>8,h+2},l.prototype.writeInt16BE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,2,32767,-32768),this[h]=u>>>8,this[h+1]=u&255,h+2},l.prototype.writeInt32LE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,4,2147483647,-2147483648),this[h]=u&255,this[h+1]=u>>>8,this[h+2]=u>>>16,this[h+3]=u>>>24,h+4},l.prototype.writeInt32BE=function(u,h,T){return u=+u,h=h>>>0,T||Z(this,u,h,4,2147483647,-2147483648),u<0&&(u=4294967295+u+1),this[h]=u>>>24,this[h+1]=u>>>16,this[h+2]=u>>>8,this[h+3]=u&255,h+4},l.prototype.writeBigInt64LE=lt(function(u,h=0){return ye(this,u,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=lt(function(u,h=0){return Ce(this,u,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ve(p,u,h,T,R,D){if(h+T>p.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function ot(p,u,h,T,R){return u=+u,h=h>>>0,R||Ve(p,u,h,4),t.write(p,u,h,T,23,4),h+4}l.prototype.writeFloatLE=function(u,h,T){return ot(this,u,h,!0,T)},l.prototype.writeFloatBE=function(u,h,T){return ot(this,u,h,!1,T)};function We(p,u,h,T,R){return u=+u,h=h>>>0,R||Ve(p,u,h,8),t.write(p,u,h,T,52,8),h+8}l.prototype.writeDoubleLE=function(u,h,T){return We(this,u,h,!0,T)},l.prototype.writeDoubleBE=function(u,h,T){return We(this,u,h,!1,T)},l.prototype.copy=function(u,h,T,R){if(!l.isBuffer(u))throw new TypeError("argument should be a Buffer");if(T||(T=0),!R&&R!==0&&(R=this.length),h>=u.length&&(h=u.length),h||(h=0),R>0&&R<T&&(R=T),R===T||u.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(T<0||T>=this.length)throw new RangeError("Index out of range");if(R<0)throw new RangeError("sourceEnd out of bounds");R>this.length&&(R=this.length),u.length-h<R-T&&(R=u.length-h+T);const D=R-T;return this===u&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(h,T,R):Uint8Array.prototype.set.call(u,this.subarray(T,R),h),D},l.prototype.fill=function(u,h,T,R){if(typeof u=="string"){if(typeof h=="string"?(R=h,h=0,T=this.length):typeof T=="string"&&(R=T,T=this.length),R!==void 0&&typeof R!="string")throw new TypeError("encoding must be a string");if(typeof R=="string"&&!l.isEncoding(R))throw new TypeError("Unknown encoding: "+R);if(u.length===1){const L=u.charCodeAt(0);(R==="utf8"&&L<128||R==="latin1")&&(u=L)}}else typeof u=="number"?u=u&255:typeof u=="boolean"&&(u=Number(u));if(h<0||this.length<h||this.length<T)throw new RangeError("Out of range index");if(T<=h)return this;h=h>>>0,T=T===void 0?this.length:T>>>0,u||(u=0);let D;if(typeof u=="number")for(D=h;D<T;++D)this[D]=u;else{const L=l.isBuffer(u)?u:l.from(u,R),ie=L.length;if(ie===0)throw new TypeError('The value "'+u+'" is invalid for argument "value"');for(D=0;D<T-h;++D)this[D+h]=L[D%ie]}return this};const Be={};function te(p,u,h){Be[p]=class extends h{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${p}]`,this.stack,delete this.name}get code(){return p}set code(R){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:R,writable:!0})}toString(){return`${this.name} [${p}]: ${this.message}`}}}te("ERR_BUFFER_OUT_OF_BOUNDS",function(p){return p?`${p} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),te("ERR_INVALID_ARG_TYPE",function(p,u){return`The "${p}" argument must be of type number. Received type ${typeof u}`},TypeError),te("ERR_OUT_OF_RANGE",function(p,u,h){let T=`The value of "${p}" is out of range.`,R=h;return Number.isInteger(h)&&Math.abs(h)>2**32?R=Q(String(h)):typeof h=="bigint"&&(R=String(h),(h>BigInt(2)**BigInt(32)||h<-(BigInt(2)**BigInt(32)))&&(R=Q(R)),R+="n"),T+=` It must be ${u}. Received ${R}`,T},RangeError);function Q(p){let u="",h=p.length;const T=p[0]==="-"?1:0;for(;h>=T+4;h-=3)u=`_${p.slice(h-3,h)}${u}`;return`${p.slice(0,h)}${u}`}function J(p,u,h){de(u,"offset"),(p[u]===void 0||p[u+h]===void 0)&&ke(u,p.length-(h+1))}function re(p,u,h,T,R,D){if(p>h||p<u){const L=typeof u=="bigint"?"n":"";let ie;throw u===0||u===BigInt(0)?ie=`>= 0${L} and < 2${L} ** ${(D+1)*8}${L}`:ie=`>= -(2${L} ** ${(D+1)*8-1}${L}) and < 2 ** ${(D+1)*8-1}${L}`,new Be.ERR_OUT_OF_RANGE("value",ie,p)}J(T,R,D)}function de(p,u){if(typeof p!="number")throw new Be.ERR_INVALID_ARG_TYPE(u,"number",p)}function ke(p,u,h){throw Math.floor(p)!==p?(de(p,h),new Be.ERR_OUT_OF_RANGE("offset","an integer",p)):u<0?new Be.ERR_BUFFER_OUT_OF_BOUNDS:new Be.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${u}`,p)}const Oe=/[^+/0-9A-Za-z-_]/g;function Fe(p){if(p=p.split("=")[0],p=p.trim().replace(Oe,""),p.length<2)return"";for(;p.length%4!==0;)p=p+"=";return p}function at(p,u){u=u||1/0;let h;const T=p.length;let R=null;const D=[];for(let L=0;L<T;++L){if(h=p.charCodeAt(L),h>55295&&h<57344){if(!R){if(h>56319){(u-=3)>-1&&D.push(239,191,189);continue}else if(L+1===T){(u-=3)>-1&&D.push(239,191,189);continue}R=h;continue}if(h<56320){(u-=3)>-1&&D.push(239,191,189),R=h;continue}h=(R-55296<<10|h-56320)+65536}else R&&(u-=3)>-1&&D.push(239,191,189);if(R=null,h<128){if((u-=1)<0)break;D.push(h)}else if(h<2048){if((u-=2)<0)break;D.push(h>>6|192,h&63|128)}else if(h<65536){if((u-=3)<0)break;D.push(h>>12|224,h>>6&63|128,h&63|128)}else if(h<1114112){if((u-=4)<0)break;D.push(h>>18|240,h>>12&63|128,h>>6&63|128,h&63|128)}else throw new Error("Invalid code point")}return D}function ht(p){const u=[];for(let h=0;h<p.length;++h)u.push(p.charCodeAt(h)&255);return u}function un(p,u){let h,T,R;const D=[];for(let L=0;L<p.length&&!((u-=2)<0);++L)h=p.charCodeAt(L),T=h>>8,R=h%256,D.push(R),D.push(T);return D}function dt(p){return e.toByteArray(Fe(p))}function vt(p,u,h,T){let R;for(R=0;R<T&&!(R+h>=u.length||R>=p.length);++R)u[R+h]=p[R];return R}function rt(p,u){return p instanceof u||p!=null&&p.constructor!=null&&p.constructor.name!=null&&p.constructor.name===u.name}function Ht(p){return p!==p}const Fn=function(){const p="0123456789abcdef",u=new Array(256);for(let h=0;h<16;++h){const T=h*16;for(let R=0;R<16;++R)u[T+R]=p[h]+p[R]}return u}();function lt(p){return typeof BigInt>"u"?Ue:p}function Ue(){throw new Error("BigInt not supported")}}(ws)),ws}var xt={},sc;function Oy(){if(sc)return xt;sc=1;var n=xt&&xt.__assign||function(){return n=Object.assign||function(i){for(var o,a=1,l=arguments.length;a<l;a++){o=arguments[a];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(i[d]=o[d])}return i},n.apply(this,arguments)},e=xt&&xt.__spreadArray||function(i,o,a){if(a||arguments.length===2)for(var l=0,d=o.length,m;l<d;l++)(m||!(l in o))&&(m||(m=Array.prototype.slice.call(o,0,l)),m[l]=o[l]);return i.concat(m||Array.prototype.slice.call(o))};Object.defineProperty(xt,"__esModule",{value:!0});var t=rn(),r=function(){function i(){}return i.readVint=function(o,a){a===void 0&&(a=0);var l=8-Math.floor(Math.log2(o[a]));if(l>8){var d=i.readHexString(o,a,a+l);throw new Error("Unrepresentable length: ".concat(l," ").concat(d))}if(a+l>o.length)return null;for(var m=o[a]&(1<<8-l)-1,y=1;y<l;y+=1){if(y===7&&m>=Math.pow(2,8)&&o[a+7]>0)return{length:l,value:-1};m*=Math.pow(2,8),m+=o[a+y]}return{length:l,value:m}},i.writeVint=function(o){if(o<0||o>Math.pow(2,53))throw new Error("Unrepresentable value: ".concat(o));var a=1;for(a=1;a<=8&&!(o<Math.pow(2,7*a)-1);a+=1);for(var l=t.Buffer.alloc(a),d=o,m=1;m<=a;m+=1){var y=d&255;l[a-m]=y,d-=y,d/=Math.pow(2,8)}return l[0]|=1<<8-a,l},i.concatenate=function(o,a){return!o&&!a?t.Buffer.from([]):!o||o.byteLength===0?a:!a||a.byteLength===0?o:t.Buffer.from(e(e([],o,!0),a,!0))},i.readHexString=function(o,a,l){return a===void 0&&(a=0),l===void 0&&(l=o.byteLength),Array.from(o.slice(a,l)).map(function(d){return Number(d).toString(16)}).reduce(function(d,m){return"".concat(d).concat(m.padStart(2,"0"))},"")},i.readUtf8=function(o){try{return t.Buffer.from(o).toString("utf8")}catch{return null}},i.readUnsigned=function(o){var a=new DataView(o.buffer,o.byteOffset,o.byteLength);switch(o.byteLength){case 1:return a.getUint8(0);case 2:return a.getUint16(0);case 4:return a.getUint32(0)}return o.byteLength<=6?o.reduce(function(l,d){return l*256+d},0):i.readHexString(o,0,o.byteLength)},i.readSigned=function(o){var a=new DataView(o.buffer,o.byteOffset,o.byteLength);switch(o.byteLength){case 1:return a.getInt8(0);case 2:return a.getInt16(0);case 4:return a.getInt32(0);default:return NaN}},i.readFloat=function(o){var a=new DataView(o.buffer,o.byteOffset,o.byteLength);switch(o.byteLength){case 4:return a.getFloat32(0);case 8:return a.getFloat64(0);default:return NaN}},i.readDate=function(o){var a=new DataView(o.buffer,o.byteOffset,o.byteLength);switch(o.byteLength){case 1:return new Date(a.getUint8(0));case 2:return new Date(a.getUint16(0));case 4:return new Date(a.getUint32(0));case 8:return new Date(Number.parseInt(i.readHexString(o),16));default:return new Date(0)}},i.readDataFromTag=function(o,a){var l=o.type,d=o.name,m=o.track,y=o.discardable||!1,A=o.keyframe||!1,k=null,S;switch(l){case"u":S=i.readUnsigned(a);break;case"f":S=i.readFloat(a);break;case"i":S=i.readSigned(a);break;case"s":S=String.fromCharCode.apply(String,a);break;case"8":S=i.readUtf8(a);break;case"d":S=i.readDate(a);break}if(d==="SimpleBlock"||d==="Block"){var P=0,B=i.readVint(a,P),O=B.length,q=B.value;P+=O,m=q,S=i.readSigned(a.subarray(P,P+2)),P+=2,d==="SimpleBlock"&&(A=!!(a[O+2]&128),y=!!(a[O+2]&1)),P+=1,k=a.subarray(P)}return n(n({},o),{data:a,discardable:y,keyframe:A,payload:k,track:m,value:S})},i}();return xt.default=r,xt}var Is,oc;function Fy(){return oc||(oc=1,Is=function(n,e,t){e=e||0;for(var r=1;r<=8&&!(n[e]>=Math.pow(2,8-r));r++);if(r>8)throw new Error("Unrepresentable length: "+r+" "+n.toString("hex",e,e+r));if(e+r>n.length)return null;var i,o=n[e]&(1<<8-r)-1;for(i=1;i<r;i++){if(i===7&&o>=Math.pow(2,45)&&n[e+7]>0)return{length:r,value:-1};o*=Math.pow(2,8),o+=n[e+i]}return t&&(o-=Math.pow(2,r*7-1)-1),{length:r,value:o}}),Is}var bs,ac;function Uy(){if(ac)return bs;ac=1;var n=Fy();function e(t){this.buffer=t,this.offset=0}return e.prototype.nextInt16BE=function(){var t=this.buffer.readInt16BE(this.offset);return this.offset+=2,t},e.prototype.nextUInt8=function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},e.prototype.nextUIntV=function(){var t=n(this.buffer,this.offset);return this.offset+=t.length,t.value},e.prototype.nextIntV=function(){var t=n(this.buffer,this.offset,!0);return this.offset+=t.length,t.value},e.prototype.nextBuffer=function(t){var r=t?this.buffer.slice(this.offset,this.offset+t):this.buffer.slice(this.offset);return this.offset+=t||this.length,r},Object.defineProperty(e.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),bs=e,bs}var As,lc;function zy(){if(lc)return As;lc=1;var n=Uy(),e=1,t=3,r=2;As=function(o){var a={},l=new n(o);a.trackNumber=l.nextUIntV(),a.timecode=l.nextInt16BE();var d=l.nextUInt8();a.invisible=!!(d&8),a.keyframe=!!(d&128),a.discardable=!!(d&1);var m=(d&6)>>1;return a.frames=i(l,m),a};function i(o,a){if(!a)return[o.nextBuffer()];var l,d,m=[],y=o.nextUInt8()+1;if(a===r){if(o.length%y!==0)throw new Error("Fixed-Size Lacing Error");for(d=o.length/y,l=0;l<y;l++)m.push(o.nextBuffer(d));return m}var A=[];if(a===e)for(l=0;l<y-1;l++){var k;d=0;do k=o.nextUInt8(),d+=k;while(k===255);A.push(d)}else if(a===t)for(d=o.nextUIntV(),A.push(d),l=1;l<y-1;l++)d+=o.nextIntV(),A.push(d);for(l=0;l<y-1;l++)m.push(o.nextBuffer(A[l]));return m.push(o.nextBuffer()),m}return As}var cc;function rn(){return cc||(cc=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertEBMLDateToJSDate=n.createFloatBuffer=n.createIntBuffer=n.createUIntBuffer=n.encodeValueToBuffer=n.concat=n.putRefinedMetaData=n.extractElement=n.removeElement=n.makeMetadataSeekable=n.createRIFFChunk=n.VP8BitStreamToRiffWebPBuffer=n.WebPBlockFilter=n.encodeTag=n.readBlock=n.ebmlBlock=n.writeVint=n.readVint=n.Buffer=void 0;var e=Ah(),t=Sh(),r=My(),i=Oy(),o=zy();n.Buffer=r.Buffer,n.readVint=i.default.readVint,n.writeVint=i.default.writeVint,n.ebmlBlock=o;function a(_){return(0,n.ebmlBlock)(new n.Buffer(_))}n.readBlock=a;function l(_,w,C){return C===void 0&&(C=!1),M([_,C?new n.Buffer("01ffffffffffffff","hex"):(0,n.writeVint)(w.length),w])}n.encodeTag=l;function d(_){return _.reduce(function(w,C){if(C.type!=="b"||C.name!=="SimpleBlock")return w;var I=(0,n.ebmlBlock)(C.data),Y=I.frames.some(function(ae){var we=ae.slice(3,6).toString("hex");return we==="9d012a"});return Y?w.concat(C):w},[])}n.WebPBlockFilter=d;function m(_){var w=y("VP8 ",_),C=M([new n.Buffer("WEBP","ascii"),w]);return y("RIFF",C)}n.VP8BitStreamToRiffWebPBuffer=m;function y(_,w){var C=new n.Buffer(4);return C.writeUInt32LE(w.byteLength,0),M([new n.Buffer(_.substr(0,4),"ascii"),C,w,new n.Buffer(w.byteLength%2===0?0:1)])}n.createRIFFChunk=y;function A(_,w,C){var I=S("EBML",_),Y=B(I),ae=Y+12,we=_[_.length-1].dataEnd-ae,Ee=S("Info",_);k("Duration",Ee),Ee.splice(1,0,{name:"Duration",type:"f",data:g(w,8)});for(var Ie=B(Ee),je=S("Tracks",_),st=B(je),ue=47,Z=[],ye=5+C.length*15,Ce=[],Ve=-1,ot=10,We=function(re){var de=ue,ke=de+Ie,Oe=ke+st,Fe=Oe+ye,at=Fe-we;if(Z=[],Z.push({name:"SeekHead",type:"m",isEnd:!1}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([21,73,169,102])}),Z.push({name:"SeekPosition",type:"u",data:U(de)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([22,84,174,107])}),Z.push({name:"SeekPosition",type:"u",data:U(ke)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"Seek",type:"m",isEnd:!1}),Z.push({name:"SeekID",type:"b",data:new n.Buffer([28,83,187,107])}),Z.push({name:"SeekPosition",type:"u",data:U(Oe)}),Z.push({name:"Seek",type:"m",isEnd:!0}),Z.push({name:"SeekHead",type:"m",isEnd:!0}),ue=B(Z),Ce=[],Ce.push({name:"Cues",type:"m",isEnd:!1}),C.forEach(function(ht){var un=ht.CueTrack,dt=ht.CueClusterPosition,vt=ht.CueTime;Ce.push({name:"CuePoint",type:"m",isEnd:!1}),Ce.push({name:"CueTime",type:"u",data:U(vt)}),Ce.push({name:"CueTrackPositions",type:"m",isEnd:!1}),Ce.push({name:"CueTrack",type:"u",data:U(un)}),dt-=ae,dt+=at,Ce.push({name:"CueClusterPosition",type:"u",data:U(dt)}),Ce.push({name:"CueTrackPositions",type:"m",isEnd:!0}),Ce.push({name:"CuePoint",type:"m",isEnd:!0})}),Ce.push({name:"Cues",type:"m",isEnd:!0}),ye=B(Ce),Ve!==at){if(Ve=at,re===ot-1)throw new Error("Failed to converge to a stable metadata size")}else return"break"},Be=0;Be<ot;Be++){var te=We(Be);if(te==="break")break}var Q=[].concat.apply([],[I,{name:"Segment",type:"m",isEnd:!1,unknownSize:!0},Z,Ee,je,Ce]),J=new t.default().encode(Q);return J}n.makeMetadataSeekable=A;function k(_,w){for(var C=-1,I=0;I<w.length;I++){var Y=w[I];if(Y.name===_)if(Y.type==="m")if(!Y.isEnd)C=I;else{if(C==-1)throw new Error("Detected ".concat(_," closing element before finding the start"));w.splice(C,I-C+1);return}else{w.splice(I,1);return}}}n.removeElement=k;function S(_,w){for(var C=[],I=-1,Y=0;Y<w.length;Y++){var ae=w[Y];if(ae.name===_)if(ae.type==="m")if(!ae.isEnd)I=Y;else{if(I==-1)throw new Error("Detected ".concat(_," closing element before finding the start"));C=w.slice(I,Y+1);break}else{C.push(w[Y]);break}}return C}n.extractElement=S;function P(_,w){Array.isArray(w.cueInfos)&&!Array.isArray(w.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),w.cues=w.cueInfos);for(var C=[],I=[],Y=0;Y<_.length;Y++){var ae=_[Y];if(ae.type==="m"&&ae.name==="Segment"){if(C=_.slice(0,Y),I=_.slice(Y),ae.unknownSize){I.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(I[I.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var we=I[I.length-1].dataEnd,Ee=C[C.length-1].dataEnd,Ie=new t.default().encode(C).byteLength,je=Ie-Ee,st=we-I[0].tagStart;I[0].tagStart-Ee,I[0].tagStart;var ue=new n.Buffer([24,83,128,103]),Z=new n.Buffer("01ffffffffffffff","hex"),ye=ue.byteLength+Z.byteLength,Ce=st,Ve;for(Ve=1;Ve<20;Ve++){var ot=Ee+ye+Ce,We=ot-we,Be=je+We,te=O(I,Be,w),Q=new t.default().encode(te).byteLength;if(Q===Ce)return new t.default().encode([].concat(C,[{type:"m",name:"Segment",isEnd:!1,unknownSize:!0}],te));Ce=Q}throw new Error("unable to refine metadata, stable size could not be found in "+Ve+" iterations!")}n.putRefinedMetaData=P;function B(_){var w=new t.default;return _.reduce(function(C,I){return C.concat(w.encode([I]))},[]).reduce(function(C,I){return C+I.byteLength},0)}function O(_,w,C){var I=C.duration,Y=C.clusterPtrs,ae=C.cues,we=_.slice(0);if(typeof I=="number"){var Ee=!1;we.forEach(function(je){je.type==="f"&&je.name==="Duration"&&(Ee=!0,je.data=g(I,8))}),Ee||G(we,"Info",[{name:"Duration",type:"f",data:g(I,8)}])}Array.isArray(ae)&&G(we,"Cues",$(ae,w));var Ie=[];return Array.isArray(Y)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),Ie=q(Y,w)),G(we,"SeekHead",Ie,!0),we}function q(_,w){var C=[];return _.forEach(function(I){C.push({name:"Seek",type:"m",isEnd:!1}),C.push({name:"SeekID",type:"b",data:new n.Buffer([31,67,182,117])}),C.push({name:"SeekPosition",type:"u",data:U(I+w)}),C.push({name:"Seek",type:"m",isEnd:!0})}),C}function $(_,w){var C=[];return _.forEach(function(I){var Y=I.CueTrack,ae=I.CueClusterPosition,we=I.CueTime;C.push({name:"CuePoint",type:"m",isEnd:!1}),C.push({name:"CueTime",type:"u",data:U(we)}),C.push({name:"CueTrackPositions",type:"m",isEnd:!1}),C.push({name:"CueTrack",type:"u",data:U(Y)}),C.push({name:"CueClusterPosition",type:"u",data:U(ae+w)}),C.push({name:"CueTrackPositions",type:"m",isEnd:!0}),C.push({name:"CuePoint",type:"m",isEnd:!0})}),C}function G(_,w,C,I){I===void 0&&(I=!1);for(var Y=-1,ae=0;ae<_.length;ae++){var we=_[ae];if(we.type==="m"&&we.name===w&&we.isEnd===!1){Y=ae;break}}Y>=0?Array.prototype.splice.apply(_,[Y+1,0].concat(C)):I?[].concat([{name:w,type:"m",isEnd:!1}],C,[{name:w,type:"m",isEnd:!0}]).reverse().forEach(function(Ee){_.unshift(Ee)}):(_.push({name:w,type:"m",isEnd:!1}),C.forEach(function(Ee){_.push(Ee)}),_.push({name:w,type:"m",isEnd:!0}))}function M(_){return n.Buffer.concat(_)}n.concat=M;function N(_){var w=new n.Buffer(0);if(_.type==="m")return _;switch(_.type){case"u":w=U(_.value);break;case"i":w=b(_.value);break;case"f":w=g(_.value);break;case"s":w=new n.Buffer(_.value,"ascii");break;case"8":w=new n.Buffer(_.value,"utf8");break;case"b":w=_.value;break;case"d":w=new e.Int64BE(_.value.getTime().toString()).toBuffer();break}return Object.assign({},_,{data:w})}n.encodeValueToBuffer=N;function U(_){for(var w=1;_>=Math.pow(2,8*w);w++);if(w>=7)return console.warn("7bit or more bigger uint not supported."),new e.Uint64BE(_).toBuffer();var C=new n.Buffer(w);return C.writeUIntBE(_,0,w),C}n.createUIntBuffer=U;function b(_){for(var w=1;_>=Math.pow(2,8*w);w++);if(w>=7)return console.warn("7bit or more bigger uint not supported."),new e.Int64BE(_).toBuffer();var C=new n.Buffer(w);return C.writeIntBE(_,0,w),C}n.createIntBuffer=b;function g(_,w){if(w===void 0&&(w=8),w===8){var C=new n.Buffer(8);return C.writeDoubleBE(_,0),C}else if(w===4){var C=new n.Buffer(4);return C.writeFloatBE(_,0),C}else throw new Error("float type bits must 4bytes or 8bytes")}n.createFloatBuffer=g;function E(_){return _ instanceof Date?_:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(_)/1e3/1e3)}n.convertEBMLDateToJSDate=E}(Ts)),Ts}var uc;function jy(){if(uc)return Wr;uc=1,Object.defineProperty(Wr,"__esModule",{value:!0});var n=Ah(),e=rn(),t=rn(),r=Ch(),i;(function(a){a[a.STATE_TAG=1]="STATE_TAG",a[a.STATE_SIZE=2]="STATE_SIZE",a[a.STATE_CONTENT=3]="STATE_CONTENT"})(i||(i={}));var o=function(){function a(){this._buffer=new e.Buffer(0),this._tag_stack=[],this._state=i.STATE_TAG,this._cursor=0,this._total=0,this._schema=r.byEbmlID,this._result=[]}return a.prototype.decode=function(l){this.readChunk(l);var d=this._result;return this._result=[],d},a.prototype.readChunk=function(l){for(this._buffer=t.concat([this._buffer,new e.Buffer(l)]);this._cursor<this._buffer.length&&!(this._state===i.STATE_TAG&&!this.readTag()||this._state===i.STATE_SIZE&&!this.readSize()||this._state===i.STATE_CONTENT&&!this.readContent()););},a.prototype.getSchemaInfo=function(l){return this._schema[l]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},a.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return!1;var l=(0,e.readVint)(this._buffer,this._cursor);if(l==null)return!1;var d=this._buffer.slice(this._cursor,this._cursor+l.length),m=d.reduce(function(k,S,P,B){return k+S*Math.pow(16,2*(B.length-1-P))},0),y=this.getSchemaInfo(m),A={EBML_ID:m.toString(16),schema:y,type:y.type,name:y.name,level:y.level,tagStart:this._total,tagEnd:this._total+l.length,sizeStart:this._total+l.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(A),this._cursor+=l.length,this._total+=l.length,this._state=i.STATE_SIZE,!0},a.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return!1;var l=(0,e.readVint)(this._buffer,this._cursor);if(l==null)return!1;var d=this._tag_stack[this._tag_stack.length-1];return d.sizeEnd=d.sizeStart+l.length,d.dataStart=d.sizeEnd,d.dataSize=l.value,l.value===-1?(d.dataEnd=-1,d.type==="m"&&(d.unknownSize=!0)):d.dataEnd=d.sizeEnd+l.value,this._cursor+=l.length,this._total+=l.length,this._state=i.STATE_CONTENT,!0},a.prototype.readContent=function(){var l=this._tag_stack[this._tag_stack.length-1];if(l.type==="m"){if(l.isEnd=!1,this._result.push(l),this._state=i.STATE_TAG,l.dataSize===0){var d=Object.assign({},l,{isEnd:!0});this._result.push(d),this._tag_stack.pop()}return!0}if(this._buffer.length<this._cursor+l.dataSize)return!1;var m=this._buffer.slice(this._cursor,this._cursor+l.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+l.dataSize),l.data=m,l.type){case"u":l.value=m.readUIntBE(0,m.length);break;case"i":l.value=m.readIntBE(0,m.length);break;case"f":l.value=l.dataSize===4?m.readFloatBE(0):l.dataSize===8?m.readDoubleBE(0):(console.warn("cannot read ".concat(l.dataSize," octets float. failback to 0")),0);break;case"s":l.value=m.toString("ascii");break;case"8":l.value=m.toString("utf8");break;case"b":l.value=m;break;case"d":l.value=(0,e.convertEBMLDateToJSDate)(new n.Int64BE(m).toNumber());break}if(l.value===null)throw new Error("unknown tag type:"+l.type);for(this._result.push(l),this._total+=l.dataSize,this._state=i.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var y=this._tag_stack[this._tag_stack.length-1];if(y.dataEnd<0)return this._tag_stack.pop(),!0;if(this._total<y.dataEnd)break;if(y.type!=="m")throw new Error("parent element is not master element");var d=Object.assign({},y,{isEnd:!0});this._result.push(d),this._tag_stack.pop()}return!0},a}();return Wr.default=o,Wr}var pn={},Yr={exports:{}},hc;function $y(){if(hc)return Yr.exports;hc=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(N,U,b){return Function.prototype.apply.call(N,U,b)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:t=function(N){return Object.getOwnPropertyNames(N)};function r(M){console&&console.warn&&console.warn(M)}var i=Number.isNaN||function(N){return N!==N};function o(){o.init.call(this)}Yr.exports=o,Yr.exports.once=q,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function l(M){if(typeof M!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(M){if(typeof M!="number"||M<0||i(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");a=M}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(N){if(typeof N!="number"||N<0||i(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this};function d(M){return M._maxListeners===void 0?o.defaultMaxListeners:M._maxListeners}o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(N){for(var U=[],b=1;b<arguments.length;b++)U.push(arguments[b]);var g=N==="error",E=this._events;if(E!==void 0)g=g&&E.error===void 0;else if(!g)return!1;if(g){var _;if(U.length>0&&(_=U[0]),_ instanceof Error)throw _;var w=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw w.context=_,w}var C=E[N];if(C===void 0)return!1;if(typeof C=="function")e(C,this,U);else for(var I=C.length,Y=P(C,I),b=0;b<I;++b)e(Y[b],this,U);return!0};function m(M,N,U,b){var g,E,_;if(l(U),E=M._events,E===void 0?(E=M._events=Object.create(null),M._eventsCount=0):(E.newListener!==void 0&&(M.emit("newListener",N,U.listener?U.listener:U),E=M._events),_=E[N]),_===void 0)_=E[N]=U,++M._eventsCount;else if(typeof _=="function"?_=E[N]=b?[U,_]:[_,U]:b?_.unshift(U):_.push(U),g=d(M),g>0&&_.length>g&&!_.warned){_.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=M,w.type=N,w.count=_.length,r(w)}return M}o.prototype.addListener=function(N,U){return m(this,N,U,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(N,U){return m(this,N,U,!0)};function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(M,N,U){var b={fired:!1,wrapFn:void 0,target:M,type:N,listener:U},g=y.bind(b);return g.listener=U,b.wrapFn=g,g}o.prototype.once=function(N,U){return l(U),this.on(N,A(this,N,U)),this},o.prototype.prependOnceListener=function(N,U){return l(U),this.prependListener(N,A(this,N,U)),this},o.prototype.removeListener=function(N,U){var b,g,E,_,w;if(l(U),g=this._events,g===void 0)return this;if(b=g[N],b===void 0)return this;if(b===U||b.listener===U)--this._eventsCount===0?this._events=Object.create(null):(delete g[N],g.removeListener&&this.emit("removeListener",N,b.listener||U));else if(typeof b!="function"){for(E=-1,_=b.length-1;_>=0;_--)if(b[_]===U||b[_].listener===U){w=b[_].listener,E=_;break}if(E<0)return this;E===0?b.shift():B(b,E),b.length===1&&(g[N]=b[0]),g.removeListener!==void 0&&this.emit("removeListener",N,w||U)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(N){var U,b,g;if(b=this._events,b===void 0)return this;if(b.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):b[N]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete b[N]),this;if(arguments.length===0){var E=Object.keys(b),_;for(g=0;g<E.length;++g)_=E[g],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(U=b[N],typeof U=="function")this.removeListener(N,U);else if(U!==void 0)for(g=U.length-1;g>=0;g--)this.removeListener(N,U[g]);return this};function k(M,N,U){var b=M._events;if(b===void 0)return[];var g=b[N];return g===void 0?[]:typeof g=="function"?U?[g.listener||g]:[g]:U?O(g):P(g,g.length)}o.prototype.listeners=function(N){return k(this,N,!0)},o.prototype.rawListeners=function(N){return k(this,N,!1)},o.listenerCount=function(M,N){return typeof M.listenerCount=="function"?M.listenerCount(N):S.call(M,N)},o.prototype.listenerCount=S;function S(M){var N=this._events;if(N!==void 0){var U=N[M];if(typeof U=="function")return 1;if(U!==void 0)return U.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function P(M,N){for(var U=new Array(N),b=0;b<N;++b)U[b]=M[b];return U}function B(M,N){for(;N+1<M.length;N++)M[N]=M[N+1];M.pop()}function O(M){for(var N=new Array(M.length),U=0;U<N.length;++U)N[U]=M[U].listener||M[U];return N}function q(M,N){return new Promise(function(U,b){function g(_){M.removeListener(N,E),b(_)}function E(){typeof M.removeListener=="function"&&M.removeListener("error",g),U([].slice.call(arguments))}G(M,N,E,{once:!0}),N!=="error"&&$(M,g,{once:!0})})}function $(M,N,U){typeof M.on=="function"&&G(M,"error",N,U)}function G(M,N,U,b){if(typeof M.on=="function")b.once?M.once(N,U):M.on(N,U);else if(typeof M.addEventListener=="function")M.addEventListener(N,function g(E){b.once&&M.removeEventListener(N,g),U(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M)}return Yr.exports}var dc;function qy(){if(dc)return pn;dc=1;var n=pn&&pn.__extends||function(){var i=function(o,a){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(l[m]=d[m])},i(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");i(o,a);function l(){this.constructor=o}o.prototype=a===null?Object.create(a):(l.prototype=a.prototype,new l)}}();Object.defineProperty(pn,"__esModule",{value:!0});var e=$y(),t=rn(),r=function(i){n(o,i);function o(){var a=i.call(this)||this;return a.logGroup="",a.hasLoggingStarted=!1,a.metadataloaded=!1,a.chunks=[],a.stack=[],a.segmentOffset=0,a.last2SimpleBlockVideoTrackTimecode=[0,0],a.last2SimpleBlockAudioTrackTimecode=[0,0],a.lastClusterTimecode=0,a.lastClusterPosition=0,a.timecodeScale=1e6,a.metadataSize=0,a.metadatas=[],a.cues=[],a.firstVideoBlockRead=!1,a.firstAudioBlockRead=!1,a.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},a.trackTypes=[],a.trackDefaultDuration=[],a.trackCodecDelay=[],a.trackInfo={type:"nothing"},a.ended=!1,a.logging=!1,a.use_duration_every_simpleblock=!1,a.use_webp=!1,a.use_segment_info=!0,a.drop_default_duration=!0,a}return o.prototype.stop=function(){for(this.ended=!0,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},o.prototype.emit_segment_info=function(){var a=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var m=this.lastClusterTimecode,y=this.duration,A=this.timecodeScale;this.emit("cluster",{timecode:m,data:a}),this.emit("duration",{timecodeScale:A,duration:y})}else{this.metadataloaded=!0,this.metadatas=a;var l=this.trackTypes.indexOf(1),d=this.trackTypes.indexOf(2);if(this.trackInfo=l>=0&&d>=0?{type:"both",trackNumber:l}:l>=0?{type:"video",trackNumber:l}:d>=0?{type:"audio",trackNumber:d}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:a,metadataSize:this.metadataSize})}},o.prototype.read=function(a){var l=this,d=!1;if(!this.ended){if(a.type==="m")if(a.isEnd)this.stack.pop();else{var m=this.stack[this.stack.length-1];if(m!=null&&m.level>=a.level){this.stack.pop(),this.logging&&console.groupEnd(),m.dataEnd=a.dataEnd,m.dataSize=a.dataEnd-m.dataStart,m.unknownSize=!1;var y=Object.assign({},m,{name:m.name,type:m.type,isEnd:!0});this.chunks.push(y)}this.stack.push(a)}if(a.type==="m"&&a.name=="Segment")this.segmentOffset!=0&&console.warn("Multiple segments detected!"),this.segmentOffset=a.dataStart,this.emit("segment_offset",this.segmentOffset);else if(a.type==="b"&&a.name==="SimpleBlock"){var A=t.ebmlBlock(a.data),k=A.timecode,S=A.trackNumber,P=A.frames;if(this.trackTypes[S]===1){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=!0,this.trackInfo.type==="both"||this.trackInfo.type==="video")){var B=this.lastClusterTimecode+k;this.cues.push({CueTrack:S,CueClusterPosition:this.lastClusterPosition,CueTime:B}),this.emit("cue_info",{CueTrack:S,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:S,CueClusterPosition:this.lastClusterPosition,CueTime:B})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],k]}else if(this.trackTypes[S]===2){if(!this.firstAudioBlockRead&&(this.firstAudioBlockRead=!0,this.trackInfo.type==="audio")){var B=this.lastClusterTimecode+k;this.cues.push({CueTrack:S,CueClusterPosition:this.lastClusterPosition,CueTime:B}),this.emit("cue_info",{CueTrack:S,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:S,CueClusterPosition:this.lastClusterPosition,CueTime:B})}this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],k]}this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&P.forEach(function(O){var q=O.slice(3,6).toString("hex");if(q==="9d012a"){var $=t.VP8BitStreamToRiffWebPBuffer(O),G=new Blob([$],{type:"image/webp"}),M=l.duration;l.emit("webp",{currentTime:M,webp:G})}})}else a.type==="m"&&a.name==="Cluster"&&a.isEnd===!1?(this.firstVideoBlockRead=!1,this.firstAudioBlockRead=!1,this.emit_segment_info(),this.emit("cluster_ptr",a.tagStart),this.lastClusterPosition=a.tagStart):a.type==="u"&&a.name==="Timecode"?this.lastClusterTimecode=a.value:a.type==="u"&&a.name==="TimecodeScale"?this.timecodeScale=a.value:a.type==="m"&&a.name==="TrackEntry"?a.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:a.type==="u"&&a.name==="TrackType"?this.currentTrack.TrackType=a.value:a.type==="u"&&a.name==="TrackNumber"?this.currentTrack.TrackNumber=a.value:a.type==="u"&&a.name==="CodecDelay"?this.currentTrack.CodecDelay=a.value:a.type==="u"&&a.name==="DefaultDuration"?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),d=!0):this.currentTrack.DefaultDuration=a.value:a.name==="unknown"&&console.warn(a);!this.metadataloaded&&a.dataEnd>0&&(this.metadataSize=a.dataEnd),d||this.chunks.push(a),this.logging&&this.put(a)}},Object.defineProperty(o.prototype,"duration",{get:function(){if(this.trackInfo.type==="nothing")return console.warn("no video, no audio track"),0;var a=0,l=0,d=0,m=this.trackDefaultDuration[this.trackInfo.trackNumber];if(typeof m=="number")a=m;else if(this.trackInfo.type==="both")if(this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]){a=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var y=this.trackCodecDelay[this.trackTypes.indexOf(2)];typeof y=="number"&&(l=y),d=this.last2SimpleBlockAudioTrackTimecode[1]}else{a=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var y=this.trackCodecDelay[this.trackTypes.indexOf(1)];typeof y=="number"&&(l=y),d=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="video"){a=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale;var y=this.trackCodecDelay[this.trackInfo.trackNumber];typeof y=="number"&&(l=y),d=this.last2SimpleBlockVideoTrackTimecode[1]}else if(this.trackInfo.type==="audio"){a=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale;var y=this.trackCodecDelay[this.trackInfo.trackNumber];typeof y=="number"&&(l=y),d=this.last2SimpleBlockAudioTrackTimecode[1]}var A=(this.lastClusterTimecode+d)*this.timecodeScale+a-l,k=A/this.timecodeScale;return Math.floor(k)},enumerable:!1,configurable:!0}),o.prototype.addListener=function(a,l){return i.prototype.addListener.call(this,a,l)},o.prototype.put=function(a){this.hasLoggingStarted||(this.hasLoggingStarted=!0,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),a.type==="m"?a.isEnd?console.groupEnd():console.group(a.name+":"+a.tagStart):a.type==="b"?console.log(a.name,a.type):console.log(a.name,a.tagStart,a.type,a.value)},o}(e.EventEmitter);return pn.default=r,pn}var fc;function Hy(){return fc||(fc=1,function(n){var e=Xt&&Xt.__createBinding||(Object.create?function(l,d,m,y){y===void 0&&(y=m),Object.defineProperty(l,y,{enumerable:!0,get:function(){return d[m]}})}:function(l,d,m,y){y===void 0&&(y=m),l[y]=d[m]}),t=Xt&&Xt.__exportStar||function(l,d){for(var m in l)m!=="default"&&!Object.prototype.hasOwnProperty.call(d,m)&&e(d,l,m)};Object.defineProperty(n,"__esModule",{value:!0}),n.tools=n.Reader=n.Encoder=n.Decoder=void 0,t(By(),n);var r=jy();n.Decoder=r.default;var i=Sh();n.Encoder=i.default;var o=qy();n.Reader=o.default;var a=rn();n.tools=a}(Xt)),Xt}var mc;function Gy(){if(mc)return Rt;mc=1;var n=Rt&&Rt.__awaiter||function(i,o,a,l){function d(m){return m instanceof a?m:new a(function(y){y(m)})}return new(a||(a=Promise))(function(m,y){function A(P){try{S(l.next(P))}catch(B){y(B)}}function k(P){try{S(l.throw(P))}catch(B){y(B)}}function S(P){P.done?m(P.value):d(P.value).then(A,k)}S((l=l.apply(i,o||[])).next())})},e=Rt&&Rt.__generator||function(i,o){var a={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},l,d,m,y;return y={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function A(S){return function(P){return k([S,P])}}function k(S){if(l)throw new TypeError("Generator is already executing.");for(;a;)try{if(l=1,d&&(m=S[0]&2?d.return:S[0]?d.throw||((m=d.return)&&m.call(d),0):d.next)&&!(m=m.call(d,S[1])).done)return m;switch(d=0,m&&(S=[S[0]&2,m.value]),S[0]){case 0:case 1:m=S;break;case 4:return a.label++,{value:S[1],done:!1};case 5:a.label++,d=S[1],S=[0];continue;case 7:S=a.ops.pop(),a.trys.pop();continue;default:if(m=a.trys,!(m=m.length>0&&m[m.length-1])&&(S[0]===6||S[0]===2)){a=0;continue}if(S[0]===3&&(!m||S[1]>m[0]&&S[1]<m[3])){a.label=S[1];break}if(S[0]===6&&a.label<m[1]){a.label=m[1],m=S;break}if(m&&a.label<m[2]){a.label=m[2],a.ops.push(S);break}m[2]&&a.ops.pop(),a.trys.pop();continue}S=o.call(i,a)}catch(P){S=[6,P],d=0}finally{l=m=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}};Object.defineProperty(Rt,"__esModule",{value:!0});var t=Hy();function r(i){return n(this,void 0,void 0,function(){var o,a,l,d,m,y,A,k,S,P,B,O;return e(this,function(q){switch(q.label){case 0:if(!i)throw Error("call to fixWebmDuration requires a blob");o=new t.Decoder,a=new t.Reader,l=i.stream(),d=l.getReader(),q.label=1;case 1:return[4,d.read()];case 2:return m=q.sent(),y=m.done,A=m.value,y?(a.stop(),[3,3]):(k=o.decode(A),k=k?.filter(function($){return $.type!=="unknown"}),k.forEach(function($){a.read($)}),A=null,[3,1]);case 3:return S=t.tools.makeMetadataSeekable(a.metadatas,a.duration,a.cues),P=new Blob([S],{type:i.type}),B=i.slice(a.metadataSize),O=new Blob([P,B],{type:i.type}),[2,O]}})})}return Rt.default=r,Rt}var Wy=Gy();const Ky=Vy(Wy);function pc(n){if(Js[n]||sn!=="receiver")return;const e=n==="camera1"?ro:io;if(!e||!e.srcObject){alert(`${n} のビデオストリームが見つかりません。`);return}const t=e.srcObject;bc(n,[]),ai(n,!0);const r=kh(n);try{const i=new MediaRecorder(t,{mimeType:"video/webm; codecs=vp9"});Ic(n,i),i.ondataavailable=o=>{o.data.size>0&&sr[n].push(o.data)},i.onstop=()=>{console.log(`Recording stopped for ${n}. Total chunks:`,sr[n].length),r.startBtn.disabled=!1,r.stopBtn.disabled=!0,r.downloadBtn.disabled=sr[n].length===0,r.status.textContent="録画停止。"},i.start(100),console.log(`Recording started for ${n}.`),r.startBtn.disabled=!0,r.stopBtn.disabled=!1,r.downloadBtn.disabled=!0,r.status.textContent="録画中..."}catch(i){console.error(`Error starting MediaRecorder for ${n}:`,i),alert(`${n} の録画開始に失敗しました。`),ai(n,!1)}}function Vn(n){const e=ir[n];!Js[n]||!e||e.state==="inactive"||(e.stop(),ai(n,!1))}async function gc(n){const e=sr[n];if(e.length===0){alert("ダウンロードする録画データがありません。");return}const t=kh(n);t.status.textContent="動画ファイルを処理中...",t.downloadBtn.disabled=!0;try{const r=new Blob(e,{type:"video/webm"}),i=await Ky(r),o=URL.createObjectURL(i),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=o,a.download=`recording_${n}_${new Date().toISOString().replace(/[:.]/g,"-")}.webm`,a.click(),window.URL.revokeObjectURL(o),document.body.removeChild(a),t.status.textContent=""}catch(r){console.error(`Error fixing or downloading video for ${n}:`,r),alert("動画の処理またはダウンロード中にエラーが発生しました。"),t.status.textContent="エラー"}finally{t.downloadBtn.disabled=!1}}function kh(n){return n==="camera1"?{startBtn:ao,stopBtn:lo,downloadBtn:co,status:Sc}:{startBtn:uo,stopBtn:ho,downloadBtn:fo,status:kc}}function Rh(){const n=new RTCPeerConnection(Ay);return n.onconnectionstatechange=()=>{console.log(`PeerConnection state changed to: ${n.connectionState}`);const e=n.connectionState==="connected";if(Ac.style.display=e?"block":"none",e&&bh(),e&&sn==="receiver"){if(!Vt){const t=setInterval(Ry,1e3);oi(t)}}else Vt&&(clearInterval(Vt),oi(null)),so.style.display="none",oo.style.display="none";e||(Qo(),Vn("camera1"),Vn("camera2"))},n}function Qy(n,e){const t=n.split(`\r
`),r=[];if(t.forEach((l,d)=>{l.startsWith("m=video")&&r.push(d)}),r.length===0)return n;const i=new RegExp(`a=rtpmap:(\\d+) ${e}/90000`,"i"),o=t.find(l=>i.test(l));if(!o)return n;const a=o.match(i)[1];return r.forEach(l=>{const d=t[l].split(" ");if(d.slice(3).includes(a)){const m=[a,...d.slice(3).filter(y=>y!==a)];t[l]=[...d.slice(0,3),...m].join(" ")}}),t.join(`\r
`)}function xh(n,e){n.onicecandidate=t=>{t.candidate&&Ko(jo(e),t.candidate.toJSON())}}function Ph(n){vh(n,e=>{e.docChanges().forEach(t=>{if(t.type==="added"&&ge){const r=new RTCIceCandidate(t.doc.data());ge.addIceCandidate(r).catch(i=>console.error("Error adding ICE candidate:",i))}})})}async function Xy(){Qo(),Vn("camera1"),Vn("camera2"),Vt&&(clearInterval(Vt),oi(null)),Cs&&(Cs.forEach(n=>n.getTracks().forEach(e=>e.stop())),_c([])),ge&&(ge.close(),Zs(null)),Ss&&(await Ty(Ss).catch(n=>console.error("Error deleting document: ",n)),eo(null)),vc({}),Ec({}),mr()}async function Yy(){fr.disabled=!0;const n=ld.value,e=parseInt(cd.value,10),t=ud.value,r=gn.value,i=Yt.value,o={...by[n],frameRate:{ideal:e},pan:!0,tilt:!0,zoom:!0},a={video:{deviceId:{exact:r},...o},audio:!1},l={video:{deviceId:{exact:i},...o},audio:!1};try{const d=await navigator.mediaDevices.getUserMedia(a),m=await navigator.mediaDevices.getUserMedia(l);_c([d,m]),ui.srcObject=d,hi.srcObject=m,ui.style.display="block",hi.style.display="block";const y={camera1:d.getVideoTracks()[0],camera2:m.getVideoTracks()[0]};vc(y);const A=Rh();Zs(A),d.getTracks().forEach(q=>ge.addTrack(q,d)),m.getTracks().forEach(q=>ge.addTrack(q,m)),Sy();const k=jo(hr(wh,"calls"));eo(k);const S=hr(k,"offerCandidates"),P=hr(k,"answerCandidates");xh(ge,S),Ph(P);const B=await ge.createOffer(),O=Qy(B.sdp,t);await ge.setLocalDescription({type:B.type,sdp:O}),await Ko(k,{offer:{type:B.type,sdp:O}}),Vi.textContent=k.id,no.style.display="block",vh(k,q=>{const $=q.data();$?.answer&&ge&&!ge.currentRemoteDescription&&ge.setRemoteDescription(new RTCSessionDescription($.answer))})}catch(d){console.error("Error starting camera or creating call:",d),alert("カメラへのアクセスに失敗しました。利用可能か、また権限が許可されているか確認してください。"),mr()}}async function Jy(){const n=Cc.value.trim();if(!n){alert("Call ID を入力してください。");return}ci.disabled=!0;try{const e=jo(wh,"calls",n);eo(e);const t=await Ey(e);if(!t.exists()||!t.data().offer){alert("無効なCall IDです。"),mr();return}const r=t.data().offer,i=Rh();Zs(i);const o=hr(e,"offerCandidates"),a=hr(e,"answerCandidates"),l=[ro,io],d=[di,fi],m=[so,oo],y={};let A=0;const k=["camera1","camera2"];ge.ontrack=P=>{if(P.track.kind==="video"&&A<l.length){l[A].srcObject=P.streams[0],d[A].style.display="inline-block";const B=k[A];y[P.track.id]={displayElement:m[A],name:B},A++}},Ec(y),ge.ondatachannel=ky,xh(ge,a),Ph(o),await ge.setRemoteDescription(new RTCSessionDescription(r));const S=await ge.createAnswer();await ge.setLocalDescription(S),await Ko(e,{answer:S},{merge:!0}),Vi.textContent=e.id,no.style.display="block"}catch(e){console.error("Error joining call:",e),alert("通話への参加中にエラーが発生しました。Call IDを確認してください。"),mr()}finally{ci.disabled=!1}}function Zy(){sd.forEach(t=>{t.addEventListener("change",r=>Rc(r.target.value))}),Jr.addEventListener("click",async()=>{const t=Vi.textContent.trim();if(t)try{await navigator.clipboard.writeText(t),Jr.textContent="コピー済み",setTimeout(()=>{Jr.textContent="コピー"},1500)}catch(r){alert("コピーに失敗しました。"),console.error("Failed to copy Call ID: ",r)}}),fr.addEventListener("click",Yy),ci.addEventListener("click",Jy),hd.addEventListener("click",Xy),Bi.addEventListener("click",bh),Ni.addEventListener("click",Qo),Li.addEventListener("click",Dy),ao.addEventListener("click",()=>pc("camera1")),lo.addEventListener("click",()=>Vn("camera1")),co.addEventListener("click",()=>gc("camera1")),uo.addEventListener("click",()=>pc("camera2")),ho.addEventListener("click",()=>Vn("camera2")),fo.addEventListener("click",()=>gc("camera2")),wd.forEach(t=>{t.addEventListener("change",r=>{r.target.checked&&Ih(r.target.value)})});const n=t=>parseFloat(document.getElementById(`${t}Slider`).value),e=()=>Pi[Di]||{};dd.addEventListener("click",()=>{const t=e();t.zoom&&xe("zoom",n("zoom")+t.zoom.step)}),fd.addEventListener("click",()=>{const t=e();t.zoom&&xe("zoom",n("zoom")-t.zoom.step)}),md.addEventListener("input",()=>xe("zoom",n("zoom"))),pd.addEventListener("click",()=>{const t=e();t.tilt&&xe("tilt",n("tilt")+t.tilt.step)}),gd.addEventListener("click",()=>{const t=e();t.tilt&&xe("tilt",n("tilt")-t.tilt.step)}),yd.addEventListener("input",()=>xe("tilt",n("tilt"))),vd.addEventListener("click",()=>{const t=e();t.pan&&xe("pan",n("pan")+t.pan.step)}),_d.addEventListener("click",()=>{const t=e();t.pan&&xe("pan",n("pan")-t.pan.step)}),Ed.addEventListener("input",()=>xe("pan",n("pan"))),Td.addEventListener("click",()=>{const t=e();t.zoom&&xe("zoom",t.zoom.min),t.tilt&&xe("tilt",0),t.pan&&xe("pan",0)}),window.addEventListener("keydown",t=>{if(sn!=="receiver"||li.style.display==="none"||["INPUT","SELECT","TEXTAREA"].includes(document.activeElement.tagName))return;let r=!1;const i=e();switch(t.key){case"ArrowUp":i.tilt&&(xe("tilt",n("tilt")+i.tilt.step),r=!0);break;case"ArrowDown":i.tilt&&(xe("tilt",n("tilt")-i.tilt.step),r=!0);break;case"ArrowLeft":i.pan&&(xe("pan",n("pan")-i.pan.step),r=!0);break;case"ArrowRight":i.pan&&(xe("pan",n("pan")+i.pan.step),r=!0);break;case"+":case"PageUp":i.zoom&&(xe("zoom",n("zoom")+i.zoom.step),r=!0);break;case"-":case"PageDown":i.zoom&&(xe("zoom",n("zoom")-i.zoom.step),r=!0);break;case"r":case"R":i.zoom&&xe("zoom",i.zoom.min),i.tilt&&xe("tilt",0),i.pan&&xe("pan",0),r=!0;break}r&&t.preventDefault()}),za.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():di.requestFullscreen().catch(t=>{alert(`フルスクリーンにできませんでした: ${t.message} (${t.name})`)})}),ja.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():fi.requestFullscreen().catch(t=>{alert(`フルスクリーンにできませんでした: ${t.message} (${t.name})`)})}),document.addEventListener("fullscreenchange",()=>{const t=!!document.fullscreenElement;za.textContent=t&&document.fullscreenElement===di?"通常表示":"フルスクリーン",ja.textContent=t&&document.fullscreenElement===fi?"通常表示":"フルスクリーン"})}Rc(document.querySelector('input[name="role"]:checked').value);Zy();Id();
